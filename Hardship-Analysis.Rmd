---
title: "Household-level Impacts of COVID-19 in Ethiopia: Household Hardships"
author: "Jonathan Muir"
date: "Spring 2022"
output: html_document
---

**Analytics**

**Descriptive Statistics with Chi-square**

*Dependent Variable: Dichotomous Food Insecurity outcome variable*

```{r}
#Categorical Socio-demographic Variables
# Age Category
CrossTable(data$`Age (Household Head)`, data$`Urbanicity (Household)`, prop.r=FALSE, prop.c=FALSE,
           prop.t=FALSE, chisq = TRUE, format="SAS")

```

```{r}
#Categorical Socio-demographic Variables
# Age Category
CrossTable(data$`Sex (Household Head)`, data$`Urbanicity (Household)`, prop.r=FALSE, prop.c=FALSE,
           prop.t=FALSE, chisq = TRUE, format="SAS")

```

```{r}
#Categorical Socio-demographic Variables
# Age Category
CrossTable(data$`Ethnicity (Household Head)`, data$`Urbanicity (Household)`, prop.r=FALSE, prop.c=FALSE,
           prop.t=FALSE, chisq = TRUE, format="SAS")

```

```{r}
#Categorical Socio-demographic Variables
# Age Category
CrossTable(data$`Education (Household Head)`, data$`Urbanicity (Household)`, prop.r=FALSE, prop.c=FALSE,
           prop.t=FALSE, chisq = TRUE, format="SAS")

```

```{r}
#Categorical Socio-demographic Variables
# Age Category
CrossTable(data$`Occupation (Household Head)`, data$`Urbanicity (Household)`, prop.r=FALSE, prop.c=FALSE,
           prop.t=FALSE, chisq = TRUE, format="SAS")

```

```{r}
#Categorical Socio-demographic Variables
# Age Category
CrossTable(data$`Household Size`, data$`Urbanicity (Household)`, prop.r=FALSE, prop.c=FALSE,
           prop.t=FALSE, chisq = TRUE, format="SAS")

```

```{r}
#Categorical Socio-demographic Variables
# Age Category
CrossTable(data$`Children Under Age 5 (Household)`, data$`Urbanicity (Household)`, prop.r=FALSE, prop.c=FALSE,
           prop.t=FALSE, chisq = TRUE, format="SAS")

```

```{r}
#Categorical Socio-demographic Variables
# Age Category
CrossTable(data$`Adults Over Age 60 (Household)`, data$`Urbanicity (Household)`, prop.r=FALSE, prop.c=FALSE,
           prop.t=FALSE, chisq = TRUE, format="SAS")

```

```{r}
#Categorical Socio-demographic Variables
# Age Category
CrossTable(data$`Income (Household)`, data$`Urbanicity (Household)`, prop.r=FALSE, prop.c=FALSE,
           prop.t=FALSE, chisq = TRUE, format="SAS")

```

```{r}
#Categorical Socio-demographic Variables
# Age Category
CrossTable(data$`Wealth Index (Household)`, data$`Urbanicity (Household)`, prop.r=FALSE, prop.c=FALSE,
           prop.t=FALSE, chisq = TRUE, format="SAS")

```

```{r}
#Categorical Socio-demographic Variables
# Age Category
CrossTable(data$`Lockdown (Covid Response)`, data$`Urbanicity (Household)`, prop.r=FALSE, prop.c=FALSE,
           prop.t=FALSE, chisq = TRUE, format="SAS")

```

```{r}
#Categorical Socio-demographic Variables
# Age Category
CrossTable(data$`Business Closures (Covid Response)`, data$`Urbanicity (Household)`, prop.r=FALSE, prop.c=FALSE,
           prop.t=FALSE, chisq = TRUE, format="SAS")

```

```{r}
#Categorical Socio-demographic Variables
# Age Category
CrossTable(data$`Travel Restrictions (Covid Response)`, data$`Urbanicity (Household)`, prop.r=FALSE, prop.c=FALSE,
           prop.t=FALSE, chisq = TRUE, format="SAS")

```

```{r}
#Categorical Socio-demographic Variables
# Age Category
CrossTable(data$`Isolation Centers (Covid Response)`, data$`Urbanicity (Household)`, prop.r=FALSE, prop.c=FALSE,
           prop.t=FALSE, chisq = TRUE, format="SAS")

```

*Unadjusted associations with Hardships*

```{r}
#Categorical Socio-demographic Variables
# Age Category
Model1 <- glm(formula = HardshipIndex ~ `Age (Household Head)`,
             family = 'quasipoisson',
             data = data)
cat("Regression model:\n")
summary(Model1) 
Model1 
odds.ratios <- as.matrix(exp(coef(Model1)))
odds.ratios
plot1 <- forest_model(Model1)
plot1
```

```{r}
#Categorical Socio-demographic Variables
# Age Category
Model2 <- glm(formula = HardshipIndex ~ `Sex (Household Head)`,
             family = 'quasipoisson',
             data = data)
cat("Regression model:\n")
summary(Model2) 
odds.ratios <- as.matrix(exp(coef(Model2)))
odds.ratios
plot2 <- forest_model(Model2)
plot2
```

```{r}
#continuous socio-demographic variables
# Age
Model3 <- glm(formula = HardshipIndex ~ `Ethnicity (Household Head)`,
             family = 'quasipoisson',
             data = data)
cat("Regression model:\n")
summary(Model3) 
odds.ratios <- as.matrix(exp(coef(Model3)))
odds.ratios
plot3 <- forest_model(Model3)
plot3
```

```{r}
# Sex
Model4 <- glm(formula = HardshipIndex ~ `Religion (Household Head)`,
             family = 'quasipoisson',
             data = data)
cat("Regression model:\n")
summary(Model4) 
odds.ratios <- as.matrix(exp(coef(Model4)))
odds.ratios
plot4 <- forest_model(Model4)
plot4
```

```{r}
# Occupation
Model5 <- glm(formula = HardshipIndex ~ `Education (Household Head)`,
             family = 'quasipoisson',
             data = data)
cat("Regression model:\n")
summary(Model5)
odds.ratios <- as.matrix(exp(coef(Model5)))
odds.ratios
plot5 <- forest_model(Model5)
plot5
```

```{r}
# Education Level
Model6 <- glm(formula = HardshipIndex ~ `Occupation (Household Head)`,
             family = 'quasipoisson',
             data = data)
cat("Regression model:\n")
summary(Model6) 
odds.ratios <- as.matrix(exp(coef(Model6)))
odds.ratios
plot6 <- forest_model(Model6)
plot6
```


```{r}
# Urban Residence
Model7 <- glm(formula = HardshipIndex ~ `Residence (Household)`,
             family = 'quasipoisson',
             data = data)
cat("Regression model:\n")
summary(Model7) 
odds.ratios <- as.matrix(exp(coef(Model7)))
odds.ratios
plot7 <- forest_model(Model7)
plot7
```

```{r}
# HDSS Site
Model8 <- glm(formula = HardshipIndex ~ `Urbanicity (Household)`,
             family = 'quasipoisson',
             data = data)
cat("Regression model:\n")
summary(Model8) 
odds.ratios <- as.matrix(exp(coef(Model8)))
odds.ratios
plot8 <- forest_model(Model8)
plot8
```

```{r}
# Family number
Model9 <- glm(formula = HardshipIndex ~ `Household Size`,
             family = 'quasipoisson',
             data = data)
cat("Regression model:\n")
summary(Model9)
odds.ratios <- as.matrix(exp(coef(Model9)))
odds.ratios
plot9 <- forest_model(Model9)
plot9
```

```{r}
# Number of children under 5
Model10 <- glm(formula = HardshipIndex ~ `Children Under Age 5 (Household)`,
             family = 'quasipoisson',
             data = data)
cat("Regression model:\n")
summary(Model10) 
odds.ratios <- as.matrix(exp(coef(Model10)))
odds.ratios
plot10 <- forest_model(Model10)
plot10
```

```{r}
# Number of elderly people
Model11 <- glm(formula = HardshipIndex ~ `Adults Over Age 60 (Household)`,
             family = 'quasipoisson',
             data = data)
cat("Regression model:\n")
summary(Model11) 
odds.ratios <- as.matrix(exp(coef(Model11)))
odds.ratios
plot11 <- forest_model(Model11)
plot11
```

```{r, echo=FALSE, results='hide'}
# PreCOVID Food Insecurity
Model12 <- glm(formula = HardshipIndex ~ `Dependents (Household)`,
             family = 'quasipoisson',
             data = data)
cat("Regression model:\n")
summary(Model12) 
odds.ratios <- as.matrix(exp(coef(Model12)))
odds.ratios
plot12 <- forest_model(Model12)
```

```{r}
# Household Monthly Income
Model13<- glm(formula = HardshipIndex ~ HH_Monthly_Income,
             family = 'quasipoisson',
             data = data)
cat("Regression model:\n")
summary(Model13) 
odds.ratios <- as.matrix(exp(coef(Model13)))
odds.ratios
plot13 <- forest_model(Model13)
plot13
```

```{r}
# Household Monthly Income
Model13<- glm(formula = HardshipIndex ~ `Income (Household)`,
             family = 'quasipoisson',
             data = data)
cat("Regression model:\n")
summary(Model13) 
odds.ratios <- as.matrix(exp(coef(Model13)))
odds.ratios
plot13 <- forest_model(Model13)
plot13
```

```{r}
# Household Monthly Income
Model14 <- glm(formula = HardshipIndex ~ `Wealth Index (Household)`,
             family = 'quasipoisson',
             data = data)
cat("Regression model:\n")
summary(Model14) 
odds.ratios <- as.matrix(exp(coef(Model14)))
odds.ratios
plot14 <- forest_model(Model14)
plot14
```

```{r}
# Household Monthly Income
Model15 <- glm(formula = HardshipIndex ~ `Agricultural Land Ownership (Household)`,
             family = 'quasipoisson',
             data = data)
cat("Regression model:\n")
summary(Model15) 
odds.ratios <- as.matrix(exp(coef(Model15)))
odds.ratios
plot15 <- forest_model(Model15)
plot15
```

```{r}
# Household Monthly Income
Model15 <- glm(formula = HardshipIndex ~ `Lockdown (Covid Response)`,
             family = 'quasipoisson',
             data = data)
cat("Regression model:\n")
summary(Model15) 
odds.ratios <- as.matrix(exp(coef(Model15)))
odds.ratios
plot15 <- forest_model(Model15)
plot15
```

```{r}
# Household Monthly Income
Model16 <- glm(formula = HardshipIndex ~ `Travel Restrictions (Covid Response)`,
             family = 'quasipoisson',
             data = data)
cat("Regression model:\n")
summary(Model16) 
odds.ratios <- as.matrix(exp(coef(Model16)))
odds.ratios
plot16 <- forest_model(Model16)
plot16
```

```{r}
# Household Monthly Income
Model17 <- glm(formula = HardshipIndex ~ `Business Closures (Covid Response)`,
             family = 'quasipoisson',
             data = data)
cat("Regression model:\n")
summary(Model17) 
odds.ratios <- as.matrix(exp(coef(Model17)))
odds.ratios
plot17 <- forest_model(Model17)
plot17
```

```{r}
# Household Monthly Income
Model18 <- glm(formula = HardshipIndex ~ `Isolation Centers (Covid Response)`,
             family = 'quasipoisson',
             data = data)
cat("Regression model:\n")
summary(Model18) 
odds.ratios <- as.matrix(exp(coef(Model18)))
odds.ratios
plot18 <- forest_model(Model18)
plot18
```

```{r, echo=FALSE, results='hide'}
panels <- list(
  list(width = 0.01),
  list(width = 0.20, display = ~variable, fontface = "bold", heading = "Variable"),
  list(width = 0.18, display = ~level),
  list(width = 0.05, display = ~n, hjust = 1, heading = "n"),
  list(width = 0.01, item = "vline", hjust = 0.5),
  list(width = 0.30, item = "forest", hjust = 0.5, heading = "IRR", linetype = "dotted", color = "red", line_x = 0),
  list(width = 0.01, item = "vline", hjust = 0.5),
  list(width = 0.15, display = ~ ifelse(reference, "Reference", sprintf("%0.2f (%0.2f, %0.2f)", trans(estimate), trans(conf.low), trans(conf.high))), display_na = NA),
  #list(width = 0.05, display = ~ ifelse(reference, "", format.pval(p.value, digits = 1, eps = 0.001)), display_na = NA, hjust = 1, heading = "p"),
  list(width = 0.01)
)
```

```{r, echo=FALSE}
# Produce forest plots
model_list <- list(Model1, Model2, Model3, Model5, Model6, Model8, Model9, Model10, Model11, Model13, Model14, Model15, Model16, Model17, Model18)
bivariate_plots <- forest_model(model_list = model_list, exponentiate = TRUE, format_options = forest_model_format_options(colour = "black", color = NULL, shape = 18, text_size = 12, point_size = 1.25, banded = TRUE), panels = panels, merge_models = TRUE, factor_separate_line = TRUE, recalculate_width = FALSE, recalculate_height = TRUE, breaks = c(-0.69314718056, -0.28768207245, 0, 0.4054651081, 0.69314718056)) 
bivariate_plots <- bivariate_plots + theme(text = element_text(size = 6))
bivariate_plots <- bivariate_plots + geom_segment(x = 0, y = 0, xend = 0, yend = 60.4, linetype="solid", color = "darkred", size=0.5)
bivariate_plots
```

```{r, echo=FALSE, results='hide'}
pdf("../Figures/Odds Ratios/Unadjusted_Plots.pdf", width = 3.5, height = 4.75)
bivariate_plots
dev.off()
```

*What would be the best model to estimate household vulnerability to experiencing COVID-related hardship based on the given data on hand?*
```{r}

# all covariates
FinalModel1 <- glm(formula = HardshipIndex ~`Age (Household Head)` +
                                            `Sex (Household Head)`+
                                            `Ethnicity (Household Head)`+
                                            `Residence (Household)`+ 
                                            `Urbanicity (Household)`, family = 'quasipoisson', data = data)
 
# Print the regression model
summary(FinalModel1) 

```

```{r}
# all covariates
FinalModel2 <- glm(formula = HardshipIndex ~`Age (Household Head)` +
                                            `Sex (Household Head)` +
                                            `Ethnicity (Household Head)` +
                                            `Occupation (Household Head)`+ 
                                            `Education (Household Head)`+ 
                                            `Wealth Index (Household)` +
                                            `Income (Household)`, family = 'quasipoisson', data = data)
 
# Print the regression model
summary(FinalModel2) 
#dispersiontest(FinalModel2)

```

```{r}
# all covariates
FinalModel3 <- glm(formula = HardshipIndex ~  `Age (Household Head)` +
                                              `Sex (Household Head)` +
                                              `Ethnicity (Household Head)` +
                                              `Education (Household Head)` +
                                              `Occupation (Household Head)` + 
                                              `Urbanicity (Household)` +
                                              `Household Size` +
                                              `Adults Over Age 60 (Household)` +
                                              `Children Under Age 5 (Household)` +
                                              `Income (Household)`+
                                              `Wealth Index (Household)`, family = 'quasipoisson', data = data)
 
# Print the regression model
summary(FinalModel3) 
```

```{r}
# all covariates
FinalModel4 <- glm(formula = HardshipIndex ~  `Age (Household Head)` +
                                              `Sex (Household Head)` +
                                              `Ethnicity (Household Head)` +
                                              `Education (Household Head)` +
                                              `Occupation (Household Head)` + 
                                              #`Residence (Household)`+ 
                                              `Urbanicity (Household)` +
                                              `Household Size` +
                                              #`Dependents (Household)` +
                                              `Children Under Age 5 (Household)` +
                                              `Adults Over Age 60 (Household)` +
                                              `Income (Household)`+
                                              `Wealth Index (Household)`+
                                              `Lockdown (Covid Response)` +
                                              `Business Closures (Covid Response)` +
                                              `Travel Restrictions (Covid Response)` +
                                              `Isolation Centers (Covid Response)`, family = 'quasipoisson', data = data)
                                           
 
# Print the regression model
summary(FinalModel4)

```

```{r, echo=FALSE, results='hide'}
panels <- list(
  list(width = 0.01),
  list(width = 0.22, display = ~variable, fontface = "bold", heading = "Variable"),
  list(width = 0.16, display = ~level),
  #list(width = 0.05, display = ~n, hjust = 1, heading = "n"),
  list(width = 0.01, item = "vline", hjust = 0.5),
  list(width = 0.30, item = "forest", hjust = 0.5, heading = "AIRR", linetype = "dotted", color = "red", line_x = 0),
  list(width = 0.01, item = "vline", hjust = 0.5),
  list(width = 0.12, display = ~ ifelse(reference, "Reference", sprintf("%0.2f (%0.2f, %0.2f)", trans(estimate), trans(conf.low), trans(conf.high))), display_na = NA),
  #list(width = 0.05, display = ~ ifelse(reference, "", format.pval(p.value, digits = 1, eps = 0.001)), display_na = NA, hjust = 1, heading = "p"),
  list(width = 0.01)
)
```

```{r}
# Produce forest plots
model_list <- list(FinalModel4)
multivariate_plots <- forest_model(model_list = model_list, exponentiate = TRUE, format_options = forest_model_format_options(colour = "black", color = NULL, shape = 18, text_size = 12, point_size = 1.25, banded = TRUE), panels = panels, merge_models = TRUE, factor_separate_line = TRUE, recalculate_width = FALSE, recalculate_height = TRUE, breaks = c(-0.69314718056, -0.28768207245, 0, 0.4054651081, 0.69314718056)) 
multivariate_plots <- multivariate_plots + theme(text = element_text(size = 6))
multivariate_plots <- multivariate_plots + geom_segment(x = 0, y = 0, xend = 0, yend = 60.4, linetype="solid", color = "darkred", size=0.5)
multivariate_plots

cairo_pdf("../Figures/Odds Ratios/Adjusted_Plot.pdf", 
      width  = 3.35, 
      height = 4.75,
      fallback_resolution = 300,
      family = "serif"
      )
multivariate_plots
dev.off()

agg_tiff("../Figures/Odds Ratios/Adjusted_Plot.tiff", units="mm", width=85, height=120, res=300)
multivariate_plots
dev.off()

```

```{r}
# all covariates
FinalModel4 <- glm(formula = `Disruption Index` ~   `Age (Household Head)` +
                                              `Sex (Household Head)` +
                                              `Ethnicity (Household Head)` +
                                              `Education (Household Head)` +
                                              `Occupation (Household Head)` + 
                                              #`Residence (Household)`+ 
                                              `Urbanicity (Household)` +
                                              `Household Size` +
                                              #`Dependents (Household)` +
                                              `Children Under Age 5 (Household)` +
                                              `Adults Over Age 60 (Household)` +
                                              `Income (Household)`+
                                              `Wealth Index (Household)`+
                                              `Lockdown (Covid Response)` +
                                              `Business Closures (Covid Response)` +
                                              `Travel Restrictions (Covid Response)` +
                                              `Isolation Centers (Covid Response)`, family = 'quasipoisson', data = data)
 
# Print the regression model
summary(FinalModel4)

```

```{r}
# Produce forest plots
model_list <- list(FinalModel4)
multivariate_plots <- forest_model(model_list = model_list, exponentiate = TRUE, format_options = forest_model_format_options(colour = "black", color = NULL, shape = 18, text_size = 12, point_size = 1.25, banded = TRUE), panels = panels, merge_models = TRUE, factor_separate_line = TRUE, recalculate_width = FALSE, recalculate_height = TRUE, breaks = c(-1.38629436112, -0.69314718056, 0, 0.69314718056, 1.38629436112)) 
multivariate_plots <- multivariate_plots + theme(text = element_text(size = 6))
multivariate_plots <- multivariate_plots + geom_segment(x = 0, y = 0, xend = 0, yend = 60.4, linetype="solid", color = "darkred", size=0.5)
multivariate_plots

#pdf("../Figures/Odds Ratios/Disruption_Adjusted_Plot.pdf", width = 3.5, height = 4.75)
#multivariate_plots
#dev.off()

cairo_pdf("../Figures/Odds Ratios/Disruption_Adjusted_Plot.pdf", 
      width  = 3.35, 
      height = 4.75,
      fallback_resolution = 300,
      family = "serif"
      )
multivariate_plots
dev.off()

agg_tiff("../Figures/Odds Ratios/Disruption_Adjusted_Plot.tiff", units="mm", width=85, height=120, res=300)
multivariate_plots
dev.off()
```

```{r}
# all covariates
FinalModel4 <- glm(formula = `Inflation Index` ~    `Age (Household Head)` +
                                              `Sex (Household Head)` +
                                              `Ethnicity (Household Head)` +
                                              `Education (Household Head)` +
                                              `Occupation (Household Head)` + 
                                              #`Residence (Household)`+ 
                                              `Urbanicity (Household)` +
                                              `Household Size` +
                                              #`Dependents (Household)` +
                                              `Adults Over Age 60 (Household)` +
                                              `Children Under Age 5 (Household)` +
                                              `Income (Household)`+
                                              `Wealth Index (Household)`+
                                              `Lockdown (Covid Response)` +
                                              `Business Closures (Covid Response)` +
                                              `Travel Restrictions (Covid Response)` +
                                              `Isolation Centers (Covid Response)`, family = 'quasipoisson', data = data)
 
# Print the regression model
summary(FinalModel4)

```

```{r}
# Produce forest plots
model_list <- list(FinalModel4)
multivariate_plots <- forest_model(model_list = model_list, exponentiate = TRUE, format_options = forest_model_format_options(colour = "black", color = NULL, shape = 18, text_size = 12, point_size = 1.25, banded = TRUE), panels = panels, merge_models = TRUE, factor_separate_line = TRUE, recalculate_width = FALSE, recalculate_height = TRUE) 
multivariate_plots <- multivariate_plots + theme(text = element_text(size = 6))
multivariate_plots <- multivariate_plots + geom_segment(x = 0, y = 0, xend = 0, yend = 44.5, linetype="solid", color = "darkred", size=0.5)
multivariate_plots

pdf("../Figures/Odds Ratios/Inflation Multivariate_Plot.pdf", width = 3.25, height = 4.755)
multivariate_plots
dev.off()
```

*Multivariate Associations of Food Insecurity*

```{r, echo=FALSE, results='hide'}
panels <- list(
  list(width = 0.01),
  list(width = 0.20, display = ~variable, fontface = "bold", heading = "Variable"),
  list(width = 0.18, display = ~level),
  list(width = 0.05, display = ~n, hjust = 1, heading = "n"),
  list(width = 0.01, item = "vline", hjust = 0.5),
  list(width = 0.30, item = "forest", hjust = 0.5, heading = "AIRR", linetype = "dotted", color = "red", line_x = 0),
  list(width = 0.01, item = "vline", hjust = 0.5),
  list(width = 0.15, display = ~ ifelse(reference, "Reference", sprintf("%0.2f (%0.2f, %0.2f)", trans(estimate), trans(conf.low), trans(conf.high))), display_na = NA),
  #list(width = 0.05, display = ~ ifelse(reference, "", format.pval(p.value, digits = 1, eps = 0.001)), display_na = NA, hjust = 1, heading = "p"),
  list(width = 0.01)
)
```

```{r}
# all covariates
FinalModel4 <- glm(formula = COVID_Food_Insecurity ~    `Age (Household Head)` +
                                                        `Sex (Household Head)` +
                                                        `Ethnicity (Household Head)` +
                                                        `Education (Household Head)` +
                                                        `Occupation (Household Head)` + 
                                                        `Urbanicity (Household)` +
                                                        `Household Size` +
                                                        `Dependents (Household)` +
                                                        `Income (Household)`+
                                                        `Wealth Index (Household)`+
                                                        `Job Loss (Household)` +
                                              `Lockdown (Covid Response)` +
                                              `Business Closures (Covid Response)` +
                                              `Travel Restrictions (Covid Response)` +
                                              `Isolation Centers (Covid Response)`, family = binomial, data = data)
 
# Print the regression model
summary(FinalModel4)
```

```{r}
# Produce forest plots
model_list <- list(FinalModel4)
multivariate_plots <- forest_model(model_list = model_list, exponentiate = TRUE, format_options = forest_model_format_options(colour = "black", color = NULL, shape = 18, text_size = 12, point_size = 1.25, banded = TRUE), panels = panels, merge_models = TRUE, factor_separate_line = TRUE, recalculate_width = FALSE, recalculate_height = TRUE) 
multivariate_plots <- multivariate_plots + theme(text = element_text(size = 6))
multivariate_plots <- multivariate_plots + geom_segment(x = 0, y = 0, xend = 0, yend = 54.4, linetype="solid", color = "darkred", size=0.5)
multivariate_plots

pdf("../Figures/Odds Ratios/Multivariate Food Security Check_Plot.pdf", width = 3.5, height = 4.75)
multivariate_plots
dev.off()
```

```{r}
# all covariates
FinalModel4 <- glm(formula = Food_Price_Increase   ~    `Age (Household Head)` +
                                              `Sex (Household Head)` +
                                              `Ethnicity (Household Head)` +
                                              `Education (Household Head)` +
                                              `Occupation (Household Head)` + 
                                              #`Residence (Household)`+ 
                                              `Urbanicity (Household)` +
                                              `Household Size` +
                                              #`Dependents (Household)` +
                                              `Adults Over Age 60 (Household)` +
                                              `Children Under Age 5 (Household)` +
                                              `Income (Household)`+
                                              `Wealth Index (Household)`+
                                              `Lockdown (Covid Response)` +
                                              `Business Closures (Covid Response)` +
                                              `Travel Restrictions (Covid Response)` +
                                              `Isolation Centers (Covid Response)`, family = binomial, data = data)
 
# Print the regression model
summary(FinalModel4)
```

```{r}
# Produce forest plots
model_list <- list(FinalModel4)
multivariate_plots <- forest_model(model_list = model_list, exponentiate = TRUE, format_options = forest_model_format_options(colour = "black", color = NULL, shape = 18, text_size = 12, point_size = 1.25, banded = TRUE), panels = panels, merge_models = TRUE, factor_separate_line = TRUE, recalculate_width = FALSE, recalculate_height = TRUE) 
multivariate_plots <- multivariate_plots + theme(text = element_text(size = 6))
multivariate_plots <- multivariate_plots + geom_segment(x = 0, y = 0, xend = 0, yend = 54.4, linetype="solid", color = "darkred", size=0.5)
multivariate_plots

pdf("../Figures/Odds Ratios/Multivariate Food Price Increase_Plot.pdf", width = 3.5, height = 4.75)
multivariate_plots
dev.off()
```

```{r}
# all covariates
FinalModel4 <- glm(formula = Job_Loss              ~    `Age (Household Head)` +
                                              `Sex (Household Head)` +
                                              `Ethnicity (Household Head)` +
                                              `Education (Household Head)` +
                                              `Occupation (Household Head)` + 
                                              #`Residence (Household)`+ 
                                              `Urbanicity (Household)` +
                                              `Household Size` +
                                              #`Dependents (Household)` +
                                              `Adults Over Age 60 (Household)` +
                                              `Children Under Age 5 (Household)` +
                                              `Income (Household)`+
                                              `Wealth Index (Household)`+
                                              `Lockdown (Covid Response)` +
                                              `Business Closures (Covid Response)` +
                                              `Travel Restrictions (Covid Response)` +
                                              `Isolation Centers (Covid Response)`, family = binomial, data = data)
 
# Print the regression model
summary(FinalModel4)
```

```{r}
# Produce forest plots
model_list <- list(FinalModel4)
multivariate_plots <- forest_model(model_list = model_list, exponentiate = TRUE, format_options = forest_model_format_options(colour = "black", color = NULL, shape = 18, text_size = 12, point_size = 1.25, banded = TRUE), panels = panels, merge_models = TRUE, factor_separate_line = TRUE, recalculate_width = FALSE, recalculate_height = TRUE) 
multivariate_plots <- multivariate_plots + theme(text = element_text(size = 6))
multivariate_plots <- multivariate_plots + geom_segment(x = 0, y = 0, xend = 0, yend = 54.4, linetype="solid", color = "darkred", size=0.5)
multivariate_plots

pdf("../Figures/Odds Ratios/Multivariate Job Loss_Plot.pdf", width = 3.5, height = 4.75)
multivariate_plots
dev.off()
```

```{r}
# all covariates
FinalModel4 <- glm(formula = Nonfarm_Business_Closure ~ `Age (Household Head)` +
                                              `Sex (Household Head)` +
                                              `Ethnicity (Household Head)` +
                                              `Education (Household Head)` +
                                              `Occupation (Household Head)` + 
                                              #`Residence (Household)`+ 
                                              `Urbanicity (Household)` +
                                              `Household Size` +
                                              #`Dependents (Household)` +
                                              `Adults Over Age 60 (Household)` +
                                              `Children Under Age 5 (Household)` +
                                              `Income (Household)`+
                                              `Wealth Index (Household)`+
                                              `Lockdown (Covid Response)` +
                                              `Business Closures (Covid Response)` +
                                              `Travel Restrictions (Covid Response)` +
                                              `Isolation Centers (Covid Response)`, family = binomial, data = data)
 
# Print the regression model
summary(FinalModel4)
```

```{r}
# Produce forest plots
model_list <- list(FinalModel4)
multivariate_plots <- forest_model(model_list = model_list, exponentiate = TRUE, format_options = forest_model_format_options(colour = "black", color = NULL, shape = 18, text_size = 12, point_size = 1.25, banded = TRUE), panels = panels, merge_models = TRUE, factor_separate_line = TRUE, recalculate_width = FALSE, recalculate_height = TRUE) 
multivariate_plots <- multivariate_plots + theme(text = element_text(size = 6))
multivariate_plots <- multivariate_plots + geom_segment(x = 0, y = 0, xend = 0, yend = 54.4, linetype="solid", color = "darkred", size=0.5)
multivariate_plots

pdf("../Figures/Odds Ratios/Multivariate Business Closure_Plot.pdf", width = 3.5, height = 4.75)
multivariate_plots
dev.off()
```

```{r}
# all covariates
FinalModel4 <- glm(formula = Farm_Disruption    ~       `Age (Household Head)` +
                                              `Sex (Household Head)` +
                                              `Ethnicity (Household Head)` +
                                              `Education (Household Head)` +
                                              `Occupation (Household Head)` + 
                                              #`Residence (Household)`+ 
                                              `Urbanicity (Household)` +
                                              `Household Size` +
                                              #`Dependents (Household)` +
                                              `Adults Over Age 60 (Household)` +
                                              `Children Under Age 5 (Household)` +
                                              `Income (Household)`+
                                              `Wealth Index (Household)`+
                                              `Lockdown (Covid Response)` +
                                              `Business Closures (Covid Response)` +
                                              `Travel Restrictions (Covid Response)` +
                                              `Isolation Centers (Covid Response)`, family = binomial, data = data)
 
# Print the regression model
summary(FinalModel4)
```

```{r}
# Produce forest plots
model_list <- list(FinalModel4)
multivariate_plots <- forest_model(model_list = model_list, exponentiate = TRUE, format_options = forest_model_format_options(colour = "black", color = NULL, shape = 18, text_size = 12, point_size = 1.25, banded = TRUE), panels = panels, merge_models = TRUE, factor_separate_line = TRUE, recalculate_width = FALSE, recalculate_height = TRUE) 
multivariate_plots <- multivariate_plots + theme(text = element_text(size = 6))
multivariate_plots <- multivariate_plots + geom_segment(x = 0, y = 0, xend = 0, yend = 54.4, linetype="solid", color = "darkred", size=0.5)
multivariate_plots

pdf("../Figures/Odds Ratios/Multivariate Farm Disruption_Plot.pdf", width = 3.5, height = 4.75)
multivariate_plots
dev.off()
```

```{r}
# all covariates
FinalModel4 <- glm(formula = Livestock_Disruption    ~  `Age (Household Head)` +
                                              `Sex (Household Head)` +
                                              `Ethnicity (Household Head)` +
                                              `Education (Household Head)` +
                                              `Occupation (Household Head)` + 
                                              #`Residence (Household)`+ 
                                              `Urbanicity (Household)` +
                                              `Household Size` +
                                              #`Dependents (Household)` +
                                              `Adults Over Age 60 (Household)` +
                                              `Children Under Age 5 (Household)` +
                                              `Income (Household)`+
                                              `Wealth Index (Household)`+
                                              `Lockdown (Covid Response)` +
                                              `Business Closures (Covid Response)` +
                                              `Travel Restrictions (Covid Response)` +
                                              `Isolation Centers (Covid Response)`, family = binomial, data = data)
 
# Print the regression model
summary(FinalModel4)
```

```{r}
# Produce forest plots
model_list <- list(FinalModel4)
multivariate_plots <- forest_model(model_list = model_list, exponentiate = TRUE, format_options = forest_model_format_options(colour = "black", color = NULL, shape = 18, text_size = 12, point_size = 1.25, banded = TRUE), panels = panels, merge_models = TRUE, factor_separate_line = TRUE, recalculate_width = FALSE, recalculate_height = TRUE) 
multivariate_plots <- multivariate_plots + theme(text = element_text(size = 6))
multivariate_plots <- multivariate_plots + geom_segment(x = 0, y = 0, xend = 0, yend = 54.4, linetype="solid", color = "darkred", size=0.5)
multivariate_plots

pdf("../Figures/Odds Ratios/Multivariate Livestock Disruption_Plot.pdf", width = 3.5, height = 4.75)
multivariate_plots
dev.off()
```

```{r}
# all covariates
FinalModel4 <- glm(formula = Fishing_Disruption    ~    `Age (Household Head)` +
                                              `Sex (Household Head)` +
                                              `Ethnicity (Household Head)` +
                                              `Education (Household Head)` +
                                              `Occupation (Household Head)` + 
                                              #`Residence (Household)`+ 
                                              `Urbanicity (Household)` +
                                              `Household Size` +
                                              #`Dependents (Household)` +
                                              `Adults Over Age 60 (Household)` +
                                              `Children Under Age 5 (Household)` +
                                              `Income (Household)`+
                                              `Wealth Index (Household)`+
                                              `Lockdown (Covid Response)` +
                                              `Business Closures (Covid Response)` +
                                              `Travel Restrictions (Covid Response)` +
                                              `Isolation Centers (Covid Response)`, family = binomial, data = data)
 
# Print the regression model
summary(FinalModel4)
```

```{r}
# Produce forest plots
model_list <- list(FinalModel4)
multivariate_plots <- forest_model(model_list = model_list, exponentiate = TRUE, format_options = forest_model_format_options(colour = "black", color = NULL, shape = 18, text_size = 12, point_size = 1.25, banded = TRUE), panels = panels, merge_models = TRUE, factor_separate_line = TRUE, recalculate_width = FALSE, recalculate_height = TRUE) 
multivariate_plots <- multivariate_plots + theme(text = element_text(size = 6))
multivariate_plots <- multivariate_plots + geom_segment(x = 0, y = 0, xend = 0, yend = 54.4, linetype="solid", color = "darkred", size=0.5)
multivariate_plots

pdf("../Figures/Odds Ratios/Multivariate Fishing Disruption_Plot.pdf", width = 3.5, height = 4.75)
multivariate_plots
dev.off()
```

```{r}
# all covariates
FinalModel4 <- glm(formula = Input_Inflation    ~       `Age (Household Head)` +
                                              `Sex (Household Head)` +
                                              `Ethnicity (Household Head)` +
                                              `Education (Household Head)` +
                                              `Occupation (Household Head)` + 
                                              #`Residence (Household)`+ 
                                              `Urbanicity (Household)` +
                                              `Household Size` +
                                              #`Dependents (Household)` +
                                              `Adults Over Age 60 (Household)` +
                                              `Children Under Age 5 (Household)` +
                                              `Income (Household)`+
                                              `Wealth Index (Household)`+
                                              `Lockdown (Covid Response)` +
                                              `Business Closures (Covid Response)` +
                                              `Travel Restrictions (Covid Response)` +
                                              `Isolation Centers (Covid Response)`, family = binomial, data = data)
 
# Print the regression model
summary(FinalModel4)
```

```{r}
# Produce forest plots
model_list <- list(FinalModel4)
multivariate_plots <- forest_model(model_list = model_list, exponentiate = TRUE, format_options = forest_model_format_options(colour = "black", color = NULL, shape = 18, text_size = 12, point_size = 1.25, banded = TRUE), panels = panels, merge_models = TRUE, factor_separate_line = TRUE, recalculate_width = FALSE, recalculate_height = TRUE) 
multivariate_plots <- multivariate_plots + theme(text = element_text(size = 6))
multivariate_plots <- multivariate_plots + geom_segment(x = 0, y = 0, xend = 0, yend = 54.4, linetype="solid", color = "darkred", size=0.5)
multivariate_plots

pdf("../Figures/Odds Ratios/Multivariate Input Inflation_Plot.pdf", width = 3.5, height = 4.75)
multivariate_plots
dev.off()
```

```{r}
# all covariates
FinalModel4 <- glm(formula = Output_Deflation    ~      `Age (Household Head)` +
                                              `Sex (Household Head)` +
                                              `Ethnicity (Household Head)` +
                                              `Education (Household Head)` +
                                              `Occupation (Household Head)` + 
                                              #`Residence (Household)`+ 
                                              `Urbanicity (Household)` +
                                              `Household Size` +
                                              #`Dependents (Household)` +
                                              `Adults Over Age 60 (Household)` +
                                              `Children Under Age 5 (Household)` +
                                              `Income (Household)`+
                                              `Wealth Index (Household)`+
                                              `Lockdown (Covid Response)` +
                                              `Business Closures (Covid Response)` +
                                              `Travel Restrictions (Covid Response)` +
                                              `Isolation Centers (Covid Response)`, family = binomial, data = data)
 
# Print the regression model
summary(FinalModel4)
```

```{r}
# Produce forest plots
model_list <- list(FinalModel4)
multivariate_plots <- forest_model(model_list = model_list, exponentiate = TRUE, format_options = forest_model_format_options(colour = "black", color = NULL, shape = 18, text_size = 12, point_size = 1.25, banded = TRUE), panels = panels, merge_models = TRUE, factor_separate_line = TRUE, recalculate_width = FALSE, recalculate_height = TRUE) 
multivariate_plots <- multivariate_plots + theme(text = element_text(size = 6))
multivariate_plots <- multivariate_plots + geom_segment(x = 0, y = 0, xend = 0, yend = 54.4, linetype="solid", color = "darkred", size=0.5)
multivariate_plots

pdf("../Figures/Odds Ratios/Multivariate Output Deflation_Plot.pdf", width = 3.5, height = 4.75)
multivariate_plots
dev.off()
```

```{r}
# Check interaction models - effect modification

InteractionModel <- glm(formula = HardshipIndex ~ `Age (Household Head)` +
                                                  `Sex (Household Head)` +
                                                  `Ethnicity (Household Head)` +
                                                  `Education (Household Head)` +
                                                  `Occupation (Household Head)` + 
                                                  `Urbanicity (Household)` +
                                                  `Household Size` +
                                                  `Dependents (Household)` +
                                                  `Income (Household)`+
                                                  `Wealth Index (Household)` +
                                                  `Lockdown (Covid Response)` +
                                                  `Business Closures (Covid Response)` +
                                                  `Travel Restrictions (Covid Response)` +
                                                  `Isolation Centers (Covid Response)` +
                                                  `Age (Household Head)`*`Urbanicity (Household)`, family = 'quasipoisson', data = data)

# Print the regression model
summary(InteractionModel)

InteractionModel <- glm(formula = HardshipIndex ~ `Age (Household Head)` +
                                                  `Sex (Household Head)` +
                                                  `Ethnicity (Household Head)` +
                                                  `Education (Household Head)` +
                                                  `Occupation (Household Head)` + 
                                                  `Urbanicity (Household)` +
                                                  `Household Size` +
                                                  `Dependents (Household)` +
                                                  `Income (Household)`+
                                                  `Wealth Index (Household)` +
                                                  `Lockdown (Covid Response)` +
                                                  `Business Closures (Covid Response)` +
                                                  `Travel Restrictions (Covid Response)` +
                                                  `Isolation Centers (Covid Response)` +
                                                  `Sex (Household Head)`*`Urbanicity (Household)`, family = 'quasipoisson', data = data)

# Print the regression model
summary(InteractionModel)

InteractionModel <- glm(formula = HardshipIndex ~ `Age (Household Head)` +
                                                  `Sex (Household Head)` +
                                                  `Ethnicity (Household Head)` +
                                                  `Education (Household Head)` +
                                                  `Occupation (Household Head)` + 
                                                  `Urbanicity (Household)` +
                                                  `Household Size` +
                                                  `Dependents (Household)` +
                                                  `Income (Household)`+
                                                  `Wealth Index (Household)` +
                                                  `Lockdown (Covid Response)` +
                                                  `Business Closures (Covid Response)` +
                                                  `Travel Restrictions (Covid Response)` +
                                                  `Isolation Centers (Covid Response)` +
                                                  `Ethnicity (Household Head)`*`Urbanicity (Household)`, family = 'quasipoisson', data = data)

# Print the regression model
summary(InteractionModel)

InteractionModel <- glm(formula = HardshipIndex ~ `Age (Household Head)` +
                                                  `Sex (Household Head)` +
                                                  `Ethnicity (Household Head)` +
                                                  `Education (Household Head)` +
                                                  `Occupation (Household Head)` + 
                                                  `Urbanicity (Household)` +
                                                  `Household Size` +
                                                  `Dependents (Household)` +
                                                  `Income (Household)`+
                                                  `Wealth Index (Household)` +
                                                  `Lockdown (Covid Response)` +
                                                  `Business Closures (Covid Response)` +
                                                  `Travel Restrictions (Covid Response)` +
                                                  `Isolation Centers (Covid Response)` +
                                                  `Education (Household Head)`*`Urbanicity (Household)`, family = 'quasipoisson', data = data)

# Print the regression model
summary(InteractionModel)

InteractionModel <- glm(formula = HardshipIndex ~ `Age (Household Head)` +
                                                  `Sex (Household Head)` +
                                                  `Ethnicity (Household Head)` +
                                                  `Education (Household Head)` +
                                                  `Occupation (Household Head)` + 
                                                  `Urbanicity (Household)` +
                                                  `Household Size` +
                                                  `Dependents (Household)` +
                                                  `Income (Household)`+
                                                  `Wealth Index (Household)` +
                                                  `Lockdown (Covid Response)` +
                                                  `Business Closures (Covid Response)` +
                                                  `Travel Restrictions (Covid Response)` +
                                                  `Isolation Centers (Covid Response)` +
                                                  `Occupation (Household Head)`*`Urbanicity (Household)`, family = 'quasipoisson', data = data)

# Print the regression model
summary(InteractionModel)

InteractionModel <- glm(formula = HardshipIndex ~ `Age (Household Head)` +
                                                  `Sex (Household Head)` +
                                                  `Ethnicity (Household Head)` +
                                                  `Education (Household Head)` +
                                                  `Occupation (Household Head)` + 
                                                  `Urbanicity (Household)` +
                                                  `Household Size` +
                                                  `Dependents (Household)` +
                                                  `Income (Household)`+
                                                  `Wealth Index (Household)` +
                                                  `Lockdown (Covid Response)` +
                                                  `Business Closures (Covid Response)` +
                                                  `Travel Restrictions (Covid Response)` +
                                                  `Isolation Centers (Covid Response)` +
                                                  `Household Size`*`Urbanicity (Household)`, family = 'quasipoisson', data = data)

# Print the regression model
summary(InteractionModel)

InteractionModel <- glm(formula = HardshipIndex ~ `Age (Household Head)` +
                                                  `Sex (Household Head)` +
                                                  `Ethnicity (Household Head)` +
                                                  `Education (Household Head)` +
                                                  `Occupation (Household Head)` + 
                                                  `Urbanicity (Household)` +
                                                  `Household Size` +
                                                  `Dependents (Household)` +
                                                  `Income (Household)`+
                                                  `Wealth Index (Household)` +
                                                  `Lockdown (Covid Response)` +
                                                  `Business Closures (Covid Response)` +
                                                  `Travel Restrictions (Covid Response)` +
                                                  `Isolation Centers (Covid Response)` +
                                                  `Dependents (Household)`*`Urbanicity (Household)`, family = 'quasipoisson', data = data)

# Print the regression model
summary(InteractionModel)

InteractionModel <- glm(formula = HardshipIndex ~ `Age (Household Head)` +
                                                  `Sex (Household Head)` +
                                                  `Ethnicity (Household Head)` +
                                                  `Education (Household Head)` +
                                                  `Occupation (Household Head)` + 
                                                  `Urbanicity (Household)` +
                                                  `Household Size` +
                                                  `Dependents (Household)` +
                                                  `Income (Household)`+
                                                  `Wealth Index (Household)` +
                                                  `Lockdown (Covid Response)` +
                                                  `Business Closures (Covid Response)` +
                                                  `Travel Restrictions (Covid Response)` +
                                                  `Isolation Centers (Covid Response)` +
                                                  `Income (Household)`*`Urbanicity (Household)`, family = 'quasipoisson', data = data)

# Print the regression model
summary(InteractionModel)

InteractionModel <- glm(formula = HardshipIndex ~ `Age (Household Head)` +
                                                  `Sex (Household Head)` +
                                                  `Ethnicity (Household Head)` +
                                                  `Education (Household Head)` +
                                                  `Occupation (Household Head)` + 
                                                  `Urbanicity (Household)` +
                                                  `Household Size` +
                                                  `Dependents (Household)` +
                                                  `Income (Household)`+
                                                  `Wealth Index (Household)` +
                                                  `Lockdown (Covid Response)` +
                                                  `Business Closures (Covid Response)` +
                                                  `Travel Restrictions (Covid Response)` +
                                                  `Isolation Centers (Covid Response)` +
                                                  `Wealth Index (Household)`*`Urbanicity (Household)`, family = 'quasipoisson', data = data)

# Print the regression model
summary(InteractionModel)

InteractionModel <- glm(formula = HardshipIndex ~ `Age (Household Head)` +
                                                  `Sex (Household Head)` +
                                                  `Ethnicity (Household Head)` +
                                                  `Education (Household Head)` +
                                                  `Occupation (Household Head)` + 
                                                  `Urbanicity (Household)` +
                                                  `Household Size` +
                                                  `Dependents (Household)` +
                                                  `Income (Household)`+
                                                  `Wealth Index (Household)` +
                                                  `Lockdown (Covid Response)` +
                                                  `Business Closures (Covid Response)` +
                                                  `Travel Restrictions (Covid Response)` +
                                                  `Isolation Centers (Covid Response)` +
                                                  `Lockdown (Covid Response)`*`Urbanicity (Household)`, family = 'quasipoisson', data = data)

# Print the regression model
summary(InteractionModel)

InteractionModel <- glm(formula = HardshipIndex ~ `Age (Household Head)` +
                                                  `Sex (Household Head)` +
                                                  `Ethnicity (Household Head)` +
                                                  `Education (Household Head)` +
                                                  `Occupation (Household Head)` + 
                                                  `Urbanicity (Household)` +
                                                  `Household Size` +
                                                  `Dependents (Household)` +
                                                  `Income (Household)`+
                                                  `Wealth Index (Household)` +
                                                  `Lockdown (Covid Response)` +
                                                  `Business Closures (Covid Response)` +
                                                  `Travel Restrictions (Covid Response)` +
                                                  `Isolation Centers (Covid Response)` +
                                                  `Business Closures (Covid Response)`*`Urbanicity (Household)`, family = 'quasipoisson', data = data)

# Print the regression model
summary(InteractionModel)

InteractionModel <- glm(formula = HardshipIndex ~ `Age (Household Head)` +
                                                  `Sex (Household Head)` +
                                                  `Ethnicity (Household Head)` +
                                                  `Education (Household Head)` +
                                                  `Occupation (Household Head)` + 
                                                  `Urbanicity (Household)` +
                                                  `Household Size` +
                                                  `Dependents (Household)` +
                                                  `Income (Household)`+
                                                  `Wealth Index (Household)` +
                                                  `Lockdown (Covid Response)` +
                                                  `Business Closures (Covid Response)` +
                                                  `Travel Restrictions (Covid Response)` +
                                                  `Isolation Centers (Covid Response)` +
                                                  `Travel Restrictions (Covid Response)`*`Urbanicity (Household)`, family = 'quasipoisson', data = data)

# Print the regression model
summary(InteractionModel)

InteractionModel <- glm(formula = HardshipIndex ~ `Age (Household Head)` +
                                                  `Sex (Household Head)` +
                                                  `Ethnicity (Household Head)` +
                                                  `Education (Household Head)` +
                                                  `Occupation (Household Head)` + 
                                                  `Urbanicity (Household)` +
                                                  `Household Size` +
                                                  `Dependents (Household)` +
                                                  `Income (Household)`+
                                                  `Wealth Index (Household)` +
                                                  `Lockdown (Covid Response)` +
                                                  `Business Closures (Covid Response)` +
                                                  `Travel Restrictions (Covid Response)` +
                                                  `Isolation Centers (Covid Response)` +
                                                  `Isolation Centers (Covid Response)`*`Urbanicity (Household)`, family = 'quasipoisson', data = data)

# Print the regression model
summary(InteractionModel)
```

*Visualization of Multivariate Associations of Household Hardships with Interactions* 

We need to visualize interactions for Ethnicity, Education, Occupation, Household Size, Income, Wealth, Lockdown, Business Closures.

```{r, echo=FALSE}
tab1(data$HDSS, sort.group = "decreasing", cum.percent = TRUE)
tab1(data$`Urbanicity (Household)`, sort.group = "decreasing", cum.percent = TRUE)

data$HDSS_D <- NULL
data$HDSS_D <- factor(data$HDSS,
                    levels = c(1, 0),
                    labels = c("Urban (Harar)", "Rural (Kersa)"))
```

```{r, echo=FALSE}
VisualizationModel <- glm(formula = HardshipIndex ~ Age_2_V +
                                                    Age_3_V +
                                                    Age_4_V +
                                                    Sex_V +
                                                    Ethnicity_Other_V +
                                                    Education_V +
                                                    Occupation_Professional_V +
                                                    Occupation_Student_V + 
                                                    Occupation_DailyLaborer_V +
                                                    Occupation_OtherWork_V +
                                                    Occupation_Unemployed_V +
                                                    HDSS_D +
                                                    HouseholdSize_2_V +
                                                    HouseholdSize_3_V +
                                                    HouseholdSize_4_V +
                                                    HouseholdSize_5_V +
                                                    Children_Under_5_V +
                                                    Elderly_V +
                                                    Income_2_V +
                                                    Income_3_V +
                                                    Income_4_V +
                                                    WealthIndex_2_V +
                                                    WealthIndex_3_V +
                                                    WealthIndex_4_V +
                                                    WealthIndex_5_V +
                                                    CResponse_Lockdown_V +
                                                    CResponse_BusinessClosures_V +
                                                    CResponse_TravelRestrictions_V +
                                                    CResponse_IsolationCenters_V , family = 'quasipoisson', data = data)
 
# Print the regression model
summary(VisualizationModel)
```

```{r}
# Produce forest plots
model_list <- list(VisualizationModel)
multivariate_plots <- forest_model(model_list = model_list, exponentiate = TRUE, format_options = forest_model_format_options(colour = "black", color = NULL, shape = 18, text_size = 12, point_size = 1.25, banded = TRUE), panels = panels, merge_models = TRUE, factor_separate_line = TRUE, recalculate_width = FALSE, recalculate_height = TRUE) 
multivariate_plots <- multivariate_plots + theme(text = element_text(size = 6))
multivariate_plots <- multivariate_plots + geom_segment(x = 0, y = 0, xend = 0, yend = 54.4, linetype="solid", color = "darkred", size=0.5)
multivariate_plots

```

```{r, echo=FALSE}
# Obtain Predicted Values #
newdata2 <- with(data, data.frame(HardshipIndex,
                                  HDSS_D,
                                  Age_2_V=mean(Age_2_V, na.rm = TRUE),
                                  Age_3_V=mean(Age_3_V, na.rm = TRUE),
                                  Age_4_V=mean(Age_4_V, na.rm = TRUE),
                                  Sex_V=mean(Sex_V, na.rm = TRUE),
                                  Ethnicity_Other_V=mean(Ethnicity_Other_V, na.rm = TRUE),
                                  Education_V=mean(Education_V, na.rm = TRUE),
                                  Occupation_Professional_V=mean(Occupation_Professional_V, na.rm = TRUE),
                                  Occupation_Student_V=mean(Occupation_Student_V, na.rm = TRUE),
                                  Occupation_DailyLaborer_V=mean(Occupation_DailyLaborer_V, na.rm = TRUE),
                                  Occupation_OtherWork_V=mean(Occupation_OtherWork_V, na.rm = TRUE),
                                  Occupation_Unemployed_V=mean(Occupation_Unemployed_V, na.rm = TRUE),
                                  HouseholdSize_2_V=mean(HouseholdSize_2_V, na.rm = TRUE),
                                  HouseholdSize_3_V=mean(HouseholdSize_3_V, na.rm = TRUE),
                                  HouseholdSize_4_V=mean(HouseholdSize_4_V, na.rm = TRUE),
                                  HouseholdSize_5_V=mean(HouseholdSize_5_V, na.rm = TRUE),
                                  Children_Under_5_V=mean(Children_Under_5_V, na.rm = TRUE),
                                  Elderly_V=mean(Elderly_V, na.rm = TRUE),
                                  Income_2_V=mean(Income_2_V, na.rm = TRUE),
                                  Income_3_V=mean(Income_3_V, na.rm = TRUE),
                                  Income_4_V=mean(Income_4_V, na.rm = TRUE),
                                  WealthIndex_2_V=mean(WealthIndex_2_V, na.rm = TRUE),
                                  WealthIndex_3_V=mean(WealthIndex_3_V, na.rm = TRUE),
                                  WealthIndex_4_V=mean(WealthIndex_4_V, na.rm = TRUE),
                                  WealthIndex_5_V=mean(WealthIndex_5_V, na.rm = TRUE),
                                  CResponse_Lockdown_V=mean(CResponse_Lockdown_V, na.rm = TRUE),
                                  CResponse_BusinessClosures_V=mean(CResponse_BusinessClosures_V, na.rm = TRUE),
                                  CResponse_TravelRestrictions_V=mean(CResponse_TravelRestrictions_V, na.rm = TRUE),
                                  CResponse_IsolationCenters_V=mean(CResponse_IsolationCenters_V, na.rm = TRUE)
))

head(newdata2)
```

```{r, echo=FALSE}
newdata3 = NULL
newdata3 <- cbind(newdata2, predict(VisualizationModel, newdata = newdata2, type = c("link"), se.fit = TRUE))

# Obtain Confidence Intervals #
newdata3 <- within(newdata3, {
    PredictedProbability <- exp(fit)
    LL <- exp(fit - (1.96 * se.fit))
    UL <- exp(fit + (1.96 * se.fit))
})

head(newdata3)
newdata3 <- newdata3 %>% 
        drop_na(PredictedProbability)

head(newdata3)

df.HDSS <- newdata3[c("HDSS_D", "PredictedProbability", "LL", "UL")]
df.HDSS$Catchment <- df.HDSS$HDSS_D
df.HDSS$Factor <- "Urbanicity"
df.HDSS$Category <- fct_rev(df.HDSS$HDSS_D)
df.HDSS <- df.HDSS[c("Factor", "Category", "PredictedProbability", "LL", "UL", "Catchment")]
unique(df.HDSS)
```

```{r, echo=FALSE}
VisualizationModel <- glm(formula = HardshipIndex ~ Age_2_V +
                                                    Age_3_V +
                                                    Age_4_V +
                                                    Sex_V +
                                                    Ethnicity +
                                                    Education_V +
                                                    Occupation_Professional_V +
                                                    Occupation_Student_V + 
                                                    Occupation_DailyLaborer_V +
                                                    Occupation_OtherWork_V +
                                                    Occupation_Unemployed_V +
                                                    HDSS_D +
                                                    HouseholdSize_2_V +
                                                    HouseholdSize_3_V +
                                                    HouseholdSize_4_V +
                                                    HouseholdSize_5_V +
                                                    Children_Under_5_V +
                                                    Elderly_V +
                                                    Income_2_V +
                                                    Income_3_V +
                                                    Income_4_V +
                                                    WealthIndex_2_V +
                                                    WealthIndex_3_V +
                                                    WealthIndex_4_V +
                                                    WealthIndex_5_V +
                                                    CResponse_Lockdown_V +
                                                    CResponse_BusinessClosures_V +
                                                    CResponse_TravelRestrictions_V +
                                                    CResponse_IsolationCenters_V +
                                                    HDSS_D*Ethnicity, family = 'quasipoisson', data = data)
 
# Print the regression model
summary(VisualizationModel)
```

```{r, echo=FALSE}
# Obtain Predicted Values #
newdata2 <- with(data, data.frame(HardshipIndex,
                                  HDSS_D,
                                  Age_2_V=mean(Age_2_V, na.rm = TRUE),
                                  Age_3_V=mean(Age_3_V, na.rm = TRUE),
                                  Age_4_V=mean(Age_4_V, na.rm = TRUE),
                                  Sex_V=mean(Sex_V, na.rm = TRUE),
                                  Ethnicity,
                                  Education_V=mean(Education_V, na.rm = TRUE),
                                  Occupation_Professional_V=mean(Occupation_Professional_V, na.rm = TRUE),
                                  Occupation_Student_V=mean(Occupation_Student_V, na.rm = TRUE),
                                  Occupation_DailyLaborer_V=mean(Occupation_DailyLaborer_V, na.rm = TRUE),
                                  Occupation_OtherWork_V=mean(Occupation_OtherWork_V, na.rm = TRUE),
                                  Occupation_Unemployed_V=mean(Occupation_Unemployed_V, na.rm = TRUE),
                                  HouseholdSize_2_V=mean(HouseholdSize_2_V, na.rm = TRUE),
                                  HouseholdSize_3_V=mean(HouseholdSize_3_V, na.rm = TRUE),
                                  HouseholdSize_4_V=mean(HouseholdSize_4_V, na.rm = TRUE),
                                  HouseholdSize_5_V=mean(HouseholdSize_5_V, na.rm = TRUE),
                                  Children_Under_5_V=mean(Children_Under_5_V, na.rm = TRUE),
                                  Elderly_V=mean(Elderly_V, na.rm = TRUE),
                                  Income_2_V=mean(Income_2_V, na.rm = TRUE),
                                  Income_3_V=mean(Income_3_V, na.rm = TRUE),
                                  Income_4_V=mean(Income_4_V, na.rm = TRUE),
                                  WealthIndex_2_V=mean(WealthIndex_2_V, na.rm = TRUE),
                                  WealthIndex_3_V=mean(WealthIndex_3_V, na.rm = TRUE),
                                  WealthIndex_4_V=mean(WealthIndex_4_V, na.rm = TRUE),
                                  WealthIndex_5_V=mean(WealthIndex_5_V, na.rm = TRUE),
                                  CResponse_Lockdown_V=mean(CResponse_Lockdown_V, na.rm = TRUE),
                                  CResponse_BusinessClosures_V=mean(CResponse_BusinessClosures_V, na.rm = TRUE),
                                  CResponse_TravelRestrictions_V=mean(CResponse_TravelRestrictions_V, na.rm = TRUE),
                                  CResponse_IsolationCenters_V=mean(CResponse_IsolationCenters_V, na.rm = TRUE)
))

head(newdata2)
```

```{r, echo=FALSE}
newdata3 = NULL
newdata3 <- cbind(newdata2, predict(VisualizationModel, newdata = newdata2, type = c("link"), se.fit = TRUE))

# Obtain Confidence Intervals #
newdata3 <- within(newdata3, {
    PredictedProbability <- exp(fit)
    LL <- exp(fit - (1.96 * se.fit))
    UL <- exp(fit + (1.96 * se.fit))
})

head(newdata3)
newdata3 <- newdata3 %>% 
        drop_na(PredictedProbability)

head(newdata3)

df.Ethnicity <- newdata3[c("Ethnicity", "HDSS_D", "PredictedProbability", "LL", "UL")]
df.Ethnicity$Catchment <- df.Ethnicity$HDSS_D
df.Ethnicity$Factor <- "Ethnicity"
df.Ethnicity$Category <- fct_rev(df.Ethnicity$Ethnicity)
df.Ethnicity <- df.Ethnicity[c("Factor", "Category", "PredictedProbability", "LL", "UL", "Catchment")]
unique(df.Ethnicity)
```

```{r, echo=FALSE}

data$Education <- factor(data$Education,
                    levels = c(0, 1),
                    labels = c("Some Education", "No Education"))

VisualizationModel <- glm(formula = HardshipIndex ~ Age_2_V +
                                                    Age_3_V +
                                                    Age_4_V +
                                                    Sex_V +
                                                    Ethnicity_Other_V +
                                                    Education +
                                                    Occupation_Professional_V +
                                                    Occupation_Student_V + 
                                                    Occupation_DailyLaborer_V +
                                                    Occupation_OtherWork_V +
                                                    Occupation_Unemployed_V +
                                                    HDSS_D +
                                                    HouseholdSize_2_V +
                                                    HouseholdSize_3_V +
                                                    HouseholdSize_4_V +
                                                    HouseholdSize_5_V +
                                                    Children_Under_5_V +
                                                    Elderly_V +
                                                    Income_2_V +
                                                    Income_3_V +
                                                    Income_4_V +
                                                    WealthIndex_2_V +
                                                    WealthIndex_3_V +
                                                    WealthIndex_4_V +
                                                    WealthIndex_5_V +
                                                    CResponse_Lockdown_V +
                                                    CResponse_BusinessClosures_V +
                                                    CResponse_TravelRestrictions_V +
                                                    CResponse_IsolationCenters_V +
                                                    HDSS_D*Education, family = 'quasipoisson', data = data)
 
# Print the regression model
summary(VisualizationModel)
```

```{r, echo=FALSE}
# Obtain Predicted Values #
newdata2 <- with(data, data.frame(HardshipIndex,
                                  HDSS_D,
                                  Age_2_V=mean(Age_2_V, na.rm = TRUE),
                                  Age_3_V=mean(Age_3_V, na.rm = TRUE),
                                  Age_4_V=mean(Age_4_V, na.rm = TRUE),
                                  Sex_V=mean(Sex_V, na.rm = TRUE),
                                  Ethnicity_Other_V=mean(Ethnicity_Other_V, na.rm = TRUE),
                                  Education,
                                  Occupation_Professional_V=mean(Occupation_Professional_V, na.rm = TRUE),
                                  Occupation_Student_V=mean(Occupation_Student_V, na.rm = TRUE),
                                  Occupation_DailyLaborer_V=mean(Occupation_DailyLaborer_V, na.rm = TRUE),
                                  Occupation_OtherWork_V=mean(Occupation_OtherWork_V, na.rm = TRUE),
                                  Occupation_Unemployed_V=mean(Occupation_Unemployed_V, na.rm = TRUE),
                                  HouseholdSize_2_V=mean(HouseholdSize_2_V, na.rm = TRUE),
                                  HouseholdSize_3_V=mean(HouseholdSize_3_V, na.rm = TRUE),
                                  HouseholdSize_4_V=mean(HouseholdSize_4_V, na.rm = TRUE),
                                  HouseholdSize_5_V=mean(HouseholdSize_5_V, na.rm = TRUE),
                                  Children_Under_5_V=mean(Children_Under_5_V, na.rm = TRUE),
                                  Elderly_V=mean(Elderly_V, na.rm = TRUE),
                                  Income_2_V=mean(Income_2_V, na.rm = TRUE),
                                  Income_3_V=mean(Income_3_V, na.rm = TRUE),
                                  Income_4_V=mean(Income_4_V, na.rm = TRUE),
                                  WealthIndex_2_V=mean(WealthIndex_2_V, na.rm = TRUE),
                                  WealthIndex_3_V=mean(WealthIndex_3_V, na.rm = TRUE),
                                  WealthIndex_4_V=mean(WealthIndex_4_V, na.rm = TRUE),
                                  WealthIndex_5_V=mean(WealthIndex_5_V, na.rm = TRUE),
                                  CResponse_Lockdown_V=mean(CResponse_Lockdown_V, na.rm = TRUE),
                                  CResponse_BusinessClosures_V=mean(CResponse_BusinessClosures_V, na.rm = TRUE),
                                  CResponse_TravelRestrictions_V=mean(CResponse_TravelRestrictions_V, na.rm = TRUE),
                                  CResponse_IsolationCenters_V=mean(CResponse_IsolationCenters_V, na.rm = TRUE)
))

head(newdata2)
```

```{r, echo=FALSE}
newdata3 = NULL
newdata3 <- cbind(newdata2, predict(VisualizationModel, newdata = newdata2, type = c("link"), se.fit = TRUE))

# Obtain Confidence Intervals #
newdata3 <- within(newdata3, {
    PredictedProbability <- exp(fit)
    LL <- exp(fit - (1.96 * se.fit))
    UL <- exp(fit + (1.96 * se.fit))
})

head(newdata3)
newdata3 <- newdata3 %>% 
        drop_na(PredictedProbability)

head(newdata3)

df.Education <- newdata3[c("Education", "HDSS_D", "PredictedProbability", "LL", "UL")]
df.Education$Catchment <- df.Education$HDSS_D
df.Education$Factor <- "Education"
df.Education$Category <- fct_rev(df.Education$Education)
df.Education <- df.Education[c("Factor", "Category", "PredictedProbability", "LL", "UL", "Catchment")]
unique(df.Education)
```

```{r, echo=FALSE}
data$Occupation <- factor(data$Occupation,
                    levels = c(1,2,3,4,5,6),
                    labels = c("Farmer/Domestic", 
                               "Student", 
                               "Professional/Sales",
                               "Daily Laborer",
                               "Other Work",
                               "Unemployed/Retired"))

VisualizationModel <- glm(formula = HardshipIndex ~ Age_2_V +
                                                    Age_3_V +
                                                    Age_4_V +
                                                    Sex_V +
                                                    Ethnicity_Other_V +
                                                    Education_V +
                                                    Occupation +
                                                    HDSS_D +
                                                    HouseholdSize_2_V +
                                                    HouseholdSize_3_V +
                                                    HouseholdSize_4_V +
                                                    HouseholdSize_5_V +
                                                    Children_Under_5_V +
                                                    Elderly_V +
                                                    Income_2_V +
                                                    Income_3_V +
                                                    Income_4_V +
                                                    WealthIndex_2_V +
                                                    WealthIndex_3_V +
                                                    WealthIndex_4_V +
                                                    WealthIndex_5_V +
                                                    CResponse_Lockdown_V +
                                                    CResponse_BusinessClosures_V +
                                                    CResponse_TravelRestrictions_V +
                                                    CResponse_IsolationCenters_V +
                                                    HDSS_D*Occupation, family = 'quasipoisson', data = data)
 
# Print the regression model
summary(VisualizationModel)
```

```{r, echo=FALSE}
# Obtain Predicted Values #
newdata2 <- with(data, data.frame(HardshipIndex,
                                  HDSS_D,
                                  Age_2_V=mean(Age_2_V, na.rm = TRUE),
                                  Age_3_V=mean(Age_3_V, na.rm = TRUE),
                                  Age_4_V=mean(Age_4_V, na.rm = TRUE),
                                  Sex_V=mean(Sex_V, na.rm = TRUE),
                                  Ethnicity_Other_V=mean(Ethnicity_Other_V, na.rm = TRUE),
                                  Education_V=mean(Education_V, na.rm = TRUE),
                                  Occupation,
                                  HouseholdSize_2_V=mean(HouseholdSize_2_V, na.rm = TRUE),
                                  HouseholdSize_3_V=mean(HouseholdSize_3_V, na.rm = TRUE),
                                  HouseholdSize_4_V=mean(HouseholdSize_4_V, na.rm = TRUE),
                                  HouseholdSize_5_V=mean(HouseholdSize_5_V, na.rm = TRUE),
                                  Children_Under_5_V=mean(Children_Under_5_V, na.rm = TRUE),
                                  Elderly_V=mean(Elderly_V, na.rm = TRUE),
                                  Income_2_V=mean(Income_2_V, na.rm = TRUE),
                                  Income_3_V=mean(Income_3_V, na.rm = TRUE),
                                  Income_4_V=mean(Income_4_V, na.rm = TRUE),
                                  WealthIndex_2_V=mean(WealthIndex_2_V, na.rm = TRUE),
                                  WealthIndex_3_V=mean(WealthIndex_3_V, na.rm = TRUE),
                                  WealthIndex_4_V=mean(WealthIndex_4_V, na.rm = TRUE),
                                  WealthIndex_5_V=mean(WealthIndex_5_V, na.rm = TRUE),
                                  CResponse_Lockdown_V=mean(CResponse_Lockdown_V, na.rm = TRUE),
                                  CResponse_BusinessClosures_V=mean(CResponse_BusinessClosures_V, na.rm = TRUE),
                                  CResponse_TravelRestrictions_V=mean(CResponse_TravelRestrictions_V, na.rm = TRUE),
                                  CResponse_IsolationCenters_V=mean(CResponse_IsolationCenters_V, na.rm = TRUE)
))

head(newdata2)
```

```{r, echo=FALSE}
newdata3 = NULL
newdata3 <- cbind(newdata2, predict(VisualizationModel, newdata = newdata2, type = c("link"), se.fit = TRUE))

# Obtain Confidence Intervals #
newdata3 <- within(newdata3, {
    PredictedProbability <- exp(fit)
    LL <- exp(fit - (1.96 * se.fit))
    UL <- exp(fit + (1.96 * se.fit))
})

head(newdata3)
newdata3 <- newdata3 %>% 
        drop_na(PredictedProbability)

head(newdata3)

df.Occupation <- newdata3[c("Occupation", "HDSS_D", "PredictedProbability", "LL", "UL")]
df.Occupation$Catchment <- df.Occupation$HDSS_D
df.Occupation$Factor <- "Occupation"
df.Occupation$Category <- fct_rev(df.Occupation$Occupation)
df.Occupation <- df.Occupation[c("Factor", "Category", "PredictedProbability", "LL", "UL", "Catchment")]
unique(df.Occupation)
```

```{r, echo=FALSE}
data$HouseholdSize <- factor(data$HouseholdSize,
                    levels = c(1,2,3,4,5),
                    labels = c("1-2", "3-4", "5-6", "7-8", "9+"))

VisualizationModel <- glm(formula = HardshipIndex ~ Age_2_V +
                                                    Age_3_V +
                                                    Age_4_V +
                                                    Sex_V +
                                                    Ethnicity_Other_V +
                                                    Education_V +
                                                    Occupation_Professional_V +
                                                    Occupation_Student_V + 
                                                    Occupation_DailyLaborer_V +
                                                    Occupation_OtherWork_V +
                                                    Occupation_Unemployed_V +
                                                    HDSS_D +
                                                    HouseholdSize +
                                                    Elderly_V +
                                                    Income_2_V +
                                                    Income_3_V +
                                                    Income_4_V +
                                                    WealthIndex_2_V +
                                                    WealthIndex_3_V +
                                                    WealthIndex_4_V +
                                                    WealthIndex_5_V +
                                                    CResponse_Lockdown_V +
                                                    CResponse_BusinessClosures_V +
                                                    CResponse_TravelRestrictions_V +
                                                    CResponse_IsolationCenters_V +
                                                    HDSS_D*HouseholdSize, family = 'quasipoisson', data = data)
 
# Print the regression model
summary(VisualizationModel)
```

```{r, echo=FALSE}
# Obtain Predicted Values #
newdata2 <- with(data, data.frame(HardshipIndex,
                                  HDSS_D,
                                  Age_2_V=mean(Age_2_V, na.rm = TRUE),
                                  Age_3_V=mean(Age_3_V, na.rm = TRUE),
                                  Age_4_V=mean(Age_4_V, na.rm = TRUE),
                                  Sex_V=mean(Sex_V, na.rm = TRUE),
                                  Ethnicity_Other_V=mean(Ethnicity_Other_V, na.rm = TRUE),
                                  Education_V=mean(Education_V, na.rm = TRUE),
                                  Occupation_Professional_V=mean(Occupation_Professional_V, na.rm = TRUE),
                                  Occupation_Student_V=mean(Occupation_Student_V, na.rm = TRUE),
                                  Occupation_DailyLaborer_V=mean(Occupation_DailyLaborer_V, na.rm = TRUE),
                                  Occupation_OtherWork_V=mean(Occupation_OtherWork_V, na.rm = TRUE),
                                  Occupation_Unemployed_V=mean(Occupation_Unemployed_V, na.rm = TRUE),
                                  HouseholdSize,
                                  Children_Under_5_V=mean(Children_Under_5_V, na.rm = TRUE),
                                  Elderly_V=mean(Elderly_V, na.rm = TRUE),
                                  Income_2_V=mean(Income_2_V, na.rm = TRUE),
                                  Income_3_V=mean(Income_3_V, na.rm = TRUE),
                                  Income_4_V=mean(Income_4_V, na.rm = TRUE),
                                  WealthIndex_2_V=mean(WealthIndex_2_V, na.rm = TRUE),
                                  WealthIndex_3_V=mean(WealthIndex_3_V, na.rm = TRUE),
                                  WealthIndex_4_V=mean(WealthIndex_4_V, na.rm = TRUE),
                                  WealthIndex_5_V=mean(WealthIndex_5_V, na.rm = TRUE),
                                  CResponse_Lockdown_V=mean(CResponse_Lockdown_V, na.rm = TRUE),
                                  CResponse_BusinessClosures_V=mean(CResponse_BusinessClosures_V, na.rm = TRUE),
                                  CResponse_TravelRestrictions_V=mean(CResponse_TravelRestrictions_V, na.rm = TRUE),
                                  CResponse_IsolationCenters_V=mean(CResponse_IsolationCenters_V, na.rm = TRUE)
))

head(newdata2)
```

```{r, echo=FALSE}
newdata3 = NULL
newdata3 <- cbind(newdata2, predict(VisualizationModel, newdata = newdata2, type = c("link"), se.fit = TRUE))

# Obtain Confidence Intervals #
newdata3 <- within(newdata3, {
    PredictedProbability <- exp(fit)
    LL <- exp(fit - (1.96 * se.fit))
    UL <- exp(fit + (1.96 * se.fit))
})

head(newdata3)
newdata3 <- newdata3 %>% 
        drop_na(PredictedProbability)

head(newdata3)

df.HouseholdSize <- newdata3[c("HouseholdSize", "HDSS_D", "PredictedProbability", "LL", "UL")]
df.HouseholdSize$Catchment <- df.HouseholdSize$HDSS_D
df.HouseholdSize$Factor <- "Household \nSize"
df.HouseholdSize$Category <- fct_rev(df.HouseholdSize$HouseholdSize)
df.HouseholdSize <- df.HouseholdSize[c("Factor", "Category", "PredictedProbability", "LL", "UL", "Catchment")]
unique(df.HouseholdSize)
```


```{r, echo=FALSE}
VisualizationModel <- glm(formula = HardshipIndex ~ Age_2_V +
                                                    Age_3_V +
                                                    Age_4_V +
                                                    Sex_V +
                                                    Ethnicity_Other_V +
                                                    Education_V +
                                                    Occupation_Professional_V +
                                                    Occupation_Student_V + 
                                                    Occupation_DailyLaborer_V +
                                                    Occupation_OtherWork_V +
                                                    Occupation_Unemployed_V +
                                                    HDSS_D +
                                                    HouseholdSize_2_V +
                                                    HouseholdSize_3_V +
                                                    HouseholdSize_4_V +
                                                    HouseholdSize_5_V +
                                                    Elderly_V +
                                                    Income +
                                                    WealthIndex_2_V +
                                                    WealthIndex_3_V +
                                                    WealthIndex_4_V +
                                                    WealthIndex_5_V +
                                                    CResponse_Lockdown_V +
                                                    CResponse_BusinessClosures_V +
                                                    CResponse_TravelRestrictions_V +
                                                    CResponse_IsolationCenters_V +
                                                    HDSS_D*Income, family = 'quasipoisson', data = data)
 
# Print the regression model
summary(VisualizationModel)
```

```{r, echo=FALSE}
# Obtain Predicted Values #
newdata2 <- with(data, data.frame(HardshipIndex,
                                  HDSS_D,
                                  Age_2_V=mean(Age_2_V, na.rm = TRUE),
                                  Age_3_V=mean(Age_3_V, na.rm = TRUE),
                                  Age_4_V=mean(Age_4_V, na.rm = TRUE),
                                  Sex_V=mean(Sex_V, na.rm = TRUE),
                                  Ethnicity_Other_V=mean(Ethnicity_Other_V, na.rm = TRUE),
                                  Education_V=mean(Education_V, na.rm = TRUE),
                                  Occupation_Professional_V=mean(Occupation_Professional_V, na.rm = TRUE),
                                  Occupation_Student_V=mean(Occupation_Student_V, na.rm = TRUE),
                                  Occupation_DailyLaborer_V=mean(Occupation_DailyLaborer_V, na.rm = TRUE),
                                  Occupation_OtherWork_V=mean(Occupation_OtherWork_V, na.rm = TRUE),
                                  Occupation_Unemployed_V=mean(Occupation_Unemployed_V, na.rm = TRUE),
                                  HouseholdSize_2_V=mean(HouseholdSize_2_V, na.rm = TRUE),
                                  HouseholdSize_3_V=mean(HouseholdSize_3_V, na.rm = TRUE),
                                  HouseholdSize_4_V=mean(HouseholdSize_4_V, na.rm = TRUE),
                                  HouseholdSize_5_V=mean(HouseholdSize_5_V, na.rm = TRUE),
                                  Children_Under_5_V=mean(Children_Under_5_V, na.rm = TRUE),
                                  Elderly_V=mean(Elderly_V, na.rm = TRUE),
                                  Income,
                                  WealthIndex_2_V=mean(WealthIndex_2_V, na.rm = TRUE),
                                  WealthIndex_3_V=mean(WealthIndex_3_V, na.rm = TRUE),
                                  WealthIndex_4_V=mean(WealthIndex_4_V, na.rm = TRUE),
                                  WealthIndex_5_V=mean(WealthIndex_5_V, na.rm = TRUE),
                                  CResponse_Lockdown_V=mean(CResponse_Lockdown_V, na.rm = TRUE),
                                  CResponse_BusinessClosures_V=mean(CResponse_BusinessClosures_V, na.rm = TRUE),
                                  CResponse_TravelRestrictions_V=mean(CResponse_TravelRestrictions_V, na.rm = TRUE),
                                  CResponse_IsolationCenters_V=mean(CResponse_IsolationCenters_V, na.rm = TRUE)
))

head(newdata2)
```

```{r, echo=FALSE}
newdata3 = NULL
newdata3 <- cbind(newdata2, predict(VisualizationModel, newdata = newdata2, type = c("link"), se.fit = TRUE))

# Obtain Confidence Intervals #
newdata3 <- within(newdata3, {
    PredictedProbability <- exp(fit)
    LL <- exp(fit - (1.96 * se.fit))
    UL <- exp(fit + (1.96 * se.fit))
})

head(newdata3)
newdata3 <- newdata3 %>% 
        drop_na(PredictedProbability)

head(newdata3)

df.Income <- newdata3[c("Income", "HDSS_D", "PredictedProbability", "LL", "UL")]
df.Income$Catchment <- df.Income$HDSS_D
df.Income$Factor <- "Income"
df.Income$Category <- fct_rev(df.Income$Income)
df.Income <- df.Income[c("Factor", "Category", "PredictedProbability", "LL", "UL", "Catchment")]
unique(df.Income)
```

```{r, echo=FALSE}
VisualizationModel <- glm(formula = HardshipIndex ~ Age_2_V +
                                                    Age_3_V +
                                                    Age_4_V +
                                                    Sex_V +
                                                    Ethnicity_Other_V +
                                                    Education_V +
                                                    Occupation_Professional_V +
                                                    Occupation_Student_V + 
                                                    Occupation_DailyLaborer_V +
                                                    Occupation_OtherWork_V +
                                                    Occupation_Unemployed_V +
                                                    HDSS_D +
                                                    HouseholdSize_2_V +
                                                    HouseholdSize_3_V +
                                                    HouseholdSize_4_V +
                                                    HouseholdSize_5_V +
                                                    Children_Under_5_V +
                                                    Elderly_V +
                                                    Income_2_V +
                                                    Income_3_V +
                                                    Income_4_V +
                                                    WealthIndex +
                                                    CResponse_Lockdown_V +
                                                    CResponse_BusinessClosures_V +
                                                    CResponse_TravelRestrictions_V +
                                                    CResponse_IsolationCenters_V +
                                                    HDSS_D*WealthIndex, family = 'quasipoisson', data = data)
 
# Print the regression model
summary(VisualizationModel)
```

```{r, echo=FALSE}
# Obtain Predicted Values #
newdata2 <- with(data, data.frame(HardshipIndex,
                                  HDSS_D,
                                  Age_2_V=mean(Age_2_V, na.rm = TRUE),
                                  Age_3_V=mean(Age_3_V, na.rm = TRUE),
                                  Age_4_V=mean(Age_4_V, na.rm = TRUE),
                                  Sex_V=mean(Sex_V, na.rm = TRUE),
                                  Ethnicity_Other_V=mean(Ethnicity_Other_V, na.rm = TRUE),
                                  Education_V=mean(Education_V, na.rm = TRUE),
                                  Occupation_Professional_V=mean(Occupation_Professional_V, na.rm = TRUE),
                                  Occupation_Student_V=mean(Occupation_Student_V, na.rm = TRUE),
                                  Occupation_DailyLaborer_V=mean(Occupation_DailyLaborer_V, na.rm = TRUE),
                                  Occupation_OtherWork_V=mean(Occupation_OtherWork_V, na.rm = TRUE),
                                  Occupation_Unemployed_V=mean(Occupation_Unemployed_V, na.rm = TRUE),
                                  HouseholdSize_2_V=mean(HouseholdSize_2_V, na.rm = TRUE),
                                  HouseholdSize_3_V=mean(HouseholdSize_3_V, na.rm = TRUE),
                                  HouseholdSize_4_V=mean(HouseholdSize_4_V, na.rm = TRUE),
                                  HouseholdSize_5_V=mean(HouseholdSize_5_V, na.rm = TRUE),
                                  Children_Under_5_V=mean(Children_Under_5_V, na.rm = TRUE),
                                  Elderly_V=mean(Elderly_V, na.rm = TRUE),
                                  Income_2_V=mean(Income_2_V, na.rm = TRUE),
                                  Income_3_V=mean(Income_3_V, na.rm = TRUE),
                                  Income_4_V=mean(Income_4_V, na.rm = TRUE),
                                  WealthIndex,
                                  CResponse_Lockdown_V=mean(CResponse_Lockdown_V, na.rm = TRUE),
                                  CResponse_BusinessClosures_V=mean(CResponse_BusinessClosures_V, na.rm = TRUE),
                                  CResponse_TravelRestrictions_V=mean(CResponse_TravelRestrictions_V, na.rm = TRUE),
                                  CResponse_IsolationCenters_V=mean(CResponse_IsolationCenters_V, na.rm = TRUE)
))

head(newdata2)
```

```{r, echo=FALSE}
newdata3 = NULL
newdata3 <- cbind(newdata2, predict(VisualizationModel, newdata = newdata2, type = c("link"), se.fit = TRUE))

# Obtain Confidence Intervals #
newdata3 <- within(newdata3, {
    PredictedProbability <- exp(fit)
    LL <- exp(fit - (1.96 * se.fit))
    UL <- exp(fit + (1.96 * se.fit))
})

head(newdata3)
newdata3 <- newdata3 %>% 
        drop_na(PredictedProbability)

head(newdata3)

df.Wealth <- newdata3[c("WealthIndex", "HDSS_D", "PredictedProbability", "LL", "UL")]
df.Wealth$Catchment <- df.Wealth$HDSS_D
df.Wealth$Factor <- "Wealth \nIndex"
df.Wealth$Category <- fct_rev(df.Wealth$WealthIndex)
df.Wealth <- df.Wealth[c("Factor", "Category", "PredictedProbability", "LL", "UL", "Catchment")]
unique(df.Wealth)
```

```{r, echo=FALSE}
data$CResponse_Lockdown <- factor(data$CResponse_Lockdown,
                    levels = c(0,1),
                    labels = c("No", "Yes"))

VisualizationModel <- glm(formula = HardshipIndex ~ Age_2_V +
                                                    Age_3_V +
                                                    Age_4_V +
                                                    Sex_V +
                                                    Ethnicity_Other_V +
                                                    Education_V +
                                                    Occupation_Professional_V +
                                                    Occupation_Student_V + 
                                                    Occupation_DailyLaborer_V +
                                                    Occupation_OtherWork_V +
                                                    Occupation_Unemployed_V +
                                                    HDSS_D +
                                                    HouseholdSize_2_V +
                                                    HouseholdSize_3_V +
                                                    HouseholdSize_4_V +
                                                    HouseholdSize_5_V +
                                                    Children_Under_5_V +
                                                    Elderly_V +
                                                    Income_2_V +
                                                    Income_3_V +
                                                    Income_4_V +
                                                    WealthIndex_2_V +
                                                    WealthIndex_3_V +
                                                    WealthIndex_4_V +
                                                    WealthIndex_5_V +
                                                    CResponse_Lockdown +
                                                    CResponse_BusinessClosures_V +
                                                    CResponse_TravelRestrictions_V +
                                                    CResponse_IsolationCenters_V +
                                                    HDSS_D*CResponse_Lockdown, family = 'quasipoisson', data = data)
 
# Print the regression model
summary(VisualizationModel)

```

```{r, echo=FALSE}
# Obtain Predicted Values #
newdata2 <- with(data, data.frame(HardshipIndex,
                                  HDSS_D,
                                  Age_2_V=mean(Age_2_V, na.rm = TRUE),
                                  Age_3_V=mean(Age_3_V, na.rm = TRUE),
                                  Age_4_V=mean(Age_4_V, na.rm = TRUE),
                                  Sex_V=mean(Sex_V, na.rm = TRUE),
                                  Ethnicity_Other_V=mean(Ethnicity_Other_V, na.rm = TRUE),
                                  Education_V=mean(Education_V, na.rm = TRUE),
                                  Occupation_Professional_V=mean(Occupation_Professional_V, na.rm = TRUE),
                                  Occupation_Student_V=mean(Occupation_Student_V, na.rm = TRUE),
                                  Occupation_DailyLaborer_V=mean(Occupation_DailyLaborer_V, na.rm = TRUE),
                                  Occupation_OtherWork_V=mean(Occupation_OtherWork_V, na.rm = TRUE),
                                  Occupation_Unemployed_V=mean(Occupation_Unemployed_V, na.rm = TRUE),
                                  HouseholdSize_2_V=mean(HouseholdSize_2_V, na.rm = TRUE),
                                  HouseholdSize_3_V=mean(HouseholdSize_3_V, na.rm = TRUE),
                                  HouseholdSize_4_V=mean(HouseholdSize_4_V, na.rm = TRUE),
                                  HouseholdSize_5_V=mean(HouseholdSize_5_V, na.rm = TRUE),
                                  Children_Under_5_V=mean(Children_Under_5_V, na.rm = TRUE),
                                  Elderly_V=mean(Elderly_V, na.rm = TRUE),
                                  Income_2_V=mean(Income_2_V, na.rm = TRUE),
                                  Income_3_V=mean(Income_3_V, na.rm = TRUE),
                                  Income_4_V=mean(Income_4_V, na.rm = TRUE),
                                  WealthIndex_2_V=mean(WealthIndex_2_V, na.rm = TRUE),
                                  WealthIndex_3_V=mean(WealthIndex_3_V, na.rm = TRUE),
                                  WealthIndex_4_V=mean(WealthIndex_4_V, na.rm = TRUE),
                                  WealthIndex_5_V=mean(WealthIndex_5_V, na.rm = TRUE),
                                  CResponse_Lockdown,
                                  CResponse_BusinessClosures_V=mean(CResponse_BusinessClosures_V, na.rm = TRUE),
                                  CResponse_TravelRestrictions_V=mean(CResponse_TravelRestrictions_V, na.rm = TRUE),
                                  CResponse_IsolationCenters_V=mean(CResponse_IsolationCenters_V, na.rm = TRUE)
))

head(newdata2)
```

```{r, echo=FALSE}
newdata3 = NULL
newdata3 <- cbind(newdata2, predict(VisualizationModel, newdata = newdata2, type = c("link"), se.fit = TRUE))

# Obtain Confidence Intervals #
newdata3 <- within(newdata3, {
    PredictedProbability <- exp(fit)
    LL <- exp(fit - (1.96 * se.fit))
    UL <- exp(fit + (1.96 * se.fit))
})

head(newdata3)
newdata3 <- newdata3 %>% 
        drop_na(PredictedProbability)

head(newdata3)

df.CResponse_Lockdown <- newdata3[c("CResponse_Lockdown", "HDSS_D", "PredictedProbability", "LL", "UL")]
df.CResponse_Lockdown$Catchment <- df.CResponse_Lockdown$HDSS_D
df.CResponse_Lockdown$Factor <- "Lockdowns"
df.CResponse_Lockdown$Category <- fct_rev(df.CResponse_Lockdown$CResponse_Lockdown)
df.CResponse_Lockdown <- df.CResponse_Lockdown[c("Factor", "Category", "PredictedProbability", "LL", "UL", "Catchment")]
unique(df.CResponse_Lockdown)
```


```{r, echo=FALSE}
data$CResponse_BusinessClosures <- factor(data$CResponse_BusinessClosures,
                    levels = c(0,1),
                    labels = c("No", "Yes"))

VisualizationModel <- glm(formula = HardshipIndex ~ Age_2_V +
                                                    Age_3_V +
                                                    Age_4_V +
                                                    Sex_V +
                                                    Ethnicity_Other_V +
                                                    Education_V +
                                                    Occupation_Professional_V +
                                                    Occupation_Student_V + 
                                                    Occupation_DailyLaborer_V +
                                                    Occupation_OtherWork_V +
                                                    Occupation_Unemployed_V +
                                                    HDSS_D +
                                                    HouseholdSize_2_V +
                                                    HouseholdSize_3_V +
                                                    HouseholdSize_4_V +
                                                    HouseholdSize_5_V +
                                                    Children_Under_5_V +
                                                    Elderly_V +
                                                    Income_2_V +
                                                    Income_3_V +
                                                    Income_4_V +
                                                    WealthIndex_2_V +
                                                    WealthIndex_3_V +
                                                    WealthIndex_4_V +
                                                    WealthIndex_5_V +
                                                    CResponse_Lockdown_V +
                                                    CResponse_BusinessClosures +
                                                    CResponse_TravelRestrictions_V +
                                                    CResponse_IsolationCenters_V +
                                                    HDSS_D*CResponse_BusinessClosures, family = 'quasipoisson', data = data)
 
# Print the regression model
summary(VisualizationModel)

```

```{r, echo=FALSE}
# Obtain Predicted Values #
newdata2 <- with(data, data.frame(HardshipIndex,
                                  HDSS_D,
                                  Age_2_V=mean(Age_2_V, na.rm = TRUE),
                                  Age_3_V=mean(Age_3_V, na.rm = TRUE),
                                  Age_4_V=mean(Age_4_V, na.rm = TRUE),
                                  Sex_V=mean(Sex_V, na.rm = TRUE),
                                  Ethnicity_Other_V=mean(Ethnicity_Other_V, na.rm = TRUE),
                                  Education_V=mean(Education_V, na.rm = TRUE),
                                  Occupation_Professional_V=mean(Occupation_Professional_V, na.rm = TRUE),
                                  Occupation_Student_V=mean(Occupation_Student_V, na.rm = TRUE),
                                  Occupation_DailyLaborer_V=mean(Occupation_DailyLaborer_V, na.rm = TRUE),
                                  Occupation_OtherWork_V=mean(Occupation_OtherWork_V, na.rm = TRUE),
                                  Occupation_Unemployed_V=mean(Occupation_Unemployed_V, na.rm = TRUE),
                                  HouseholdSize_2_V=mean(HouseholdSize_2_V, na.rm = TRUE),
                                  HouseholdSize_3_V=mean(HouseholdSize_3_V, na.rm = TRUE),
                                  HouseholdSize_4_V=mean(HouseholdSize_4_V, na.rm = TRUE),
                                  HouseholdSize_5_V=mean(HouseholdSize_5_V, na.rm = TRUE),
                                  Children_Under_5_V=mean(Children_Under_5_V, na.rm = TRUE),
                                  Elderly_V=mean(Elderly_V, na.rm = TRUE),
                                  Income_2_V=mean(Income_2_V, na.rm = TRUE),
                                  Income_3_V=mean(Income_3_V, na.rm = TRUE),
                                  Income_4_V=mean(Income_4_V, na.rm = TRUE),
                                  WealthIndex_2_V=mean(WealthIndex_2_V, na.rm = TRUE),
                                  WealthIndex_3_V=mean(WealthIndex_3_V, na.rm = TRUE),
                                  WealthIndex_4_V=mean(WealthIndex_4_V, na.rm = TRUE),
                                  WealthIndex_5_V=mean(WealthIndex_5_V, na.rm = TRUE),
                                  CResponse_Lockdown_V=mean(CResponse_Lockdown_V, na.rm = TRUE),
                                  CResponse_BusinessClosures,
                                  CResponse_TravelRestrictions_V=mean(CResponse_TravelRestrictions_V, na.rm = TRUE),
                                  CResponse_IsolationCenters_V=mean(CResponse_IsolationCenters_V, na.rm = TRUE)
))

head(newdata2)
```

```{r, echo=FALSE}
newdata3 = NULL
newdata3 <- cbind(newdata2, predict(VisualizationModel, newdata = newdata2, type = c("link"), se.fit = TRUE))

# Obtain Confidence Intervals #
newdata3 <- within(newdata3, {
    PredictedProbability <- exp(fit)
    LL <- exp(fit - (1.96 * se.fit))
    UL <- exp(fit + (1.96 * se.fit))
})

head(newdata3)
newdata3 <- newdata3 %>% 
        drop_na(PredictedProbability)

head(newdata3)

df.CResponse_BusinessClosures <- newdata3[c("CResponse_BusinessClosures", "HDSS_D", "PredictedProbability", "LL", "UL")]
df.CResponse_BusinessClosures$Catchment <- df.CResponse_BusinessClosures$HDSS_D
df.CResponse_BusinessClosures$Factor <- "Business \nClosures"
df.CResponse_BusinessClosures$Category <- fct_rev(df.CResponse_BusinessClosures$CResponse_BusinessClosures)
df.CResponse_BusinessClosures <- df.CResponse_BusinessClosures[c("Factor", "Category", "PredictedProbability", "LL", "UL", "Catchment")]
unique(df.CResponse_BusinessClosures)
```

```{r, echo=FALSE}
df <- rbind(df.HDSS, df.Ethnicity, df.Education, df.Occupation, df.HouseholdSize, df.Income, df.Wealth, df.CResponse_Lockdown, df.CResponse_BusinessClosures)
```

```{r, echo=FALSE}

df$Factor <- factor(df$Factor,              
                    levels =  c("Urbanicity", "Ethnicity", "Education", "Occupation", "Household \nSize", "Income", "Wealth \nIndex", "Lockdowns", "Business \nClosures"))

Figure <- ggplot(df, aes(x = Category, y = PredictedProbability, color = Catchment, fill = Catchment)) + 
            #geom_linerange(aes(ymin=LL, ymax=UL), color = "black", width=1, size=3, position = position_dodge(width = 0.90)) +
            geom_linerange(aes(ymin=LL, ymax=UL), width = 1, size = 0.75, position = position_dodge(width = 0.50)) +
            #geom_point(shape = 23, size = 4, color = "black", stroke = 1, position = position_dodge(width = 0.90)) +
            geom_point(shape = 23, size = 1.0, stroke = 0.5, position = position_dodge(width = 0.50)) +
            #geom_point(size = .5, color = "black", position = position_dodge(width = 0.90))
            facet_grid(Factor~Catchment, scales = "free", space = "free", switch = "y", shrink = FALSE)
```

```{r, echo=FALSE}
Figure <- Figure + theme(legend.title.align=0.5)
Figure <- Figure + scale_y_continuous(name="Predicted Number of Hardships", breaks=seq(0, 5, 1))
Figure <- Figure + scale_x_discrete(name="")
Figure <- Figure + theme(legend.position="top")
Figure <- Figure + theme(plot.title = element_text(hjust = 0.5))
Figure <- Figure + theme(text = element_text(size = 9))
Figure <- Figure + scale_color_viridis(name="HDSS Catchment", discrete=TRUE, begin = 0.45, end = 1) 
Figure <- Figure + scale_fill_viridis(name="HDSS Catchment", discrete=TRUE, begin = 0.45, end = 1) 
#Figure <- Figure + theme(legend.position="top")
Figure <- Figure + theme(legend.position="none")
Figure <- Figure + theme(axis.text.x  = element_text(size = 9, color = "black"),
                         axis.text.y  = element_text(size = 9, color = "black"),
                         axis.title.y = element_text(size = 9, color = "black"),
                         axis.title.x = element_text(size = 9, color = "black")) 
#Figure <- Figure + theme(panel.grid.major = element_line(colour = "black", size = .2, linetype = "dashed"))
#Figure <- Figure + theme(panel.grid.minor = element_line(colour = "black", size = .2, linetype = "dashed"))
#Figure <- Figure + theme(axis.line = element_line(colour = "black", size = .75, linetype = "solid"))
#Figure <- Figure + theme(panel.background = element_rect(fill = "white", colour="white"))
Figure <- Figure + annotate("rect", xmin = 1, xmax = 2, ymin = 0, ymax = 5,  alpha = 0)
Figure <- Figure + coord_flip()
Figure <- Figure + theme_dark()
Figure <- Figure + theme(strip.text.y.left = element_text(angle = 0))
Figure

cairo_pdf("../Figures/Predicted Probabilities/Adjusted-Hardship-Catchment-Interactions.pdf", 
      width  = 3.35, 
      height = 4.75,
      fallback_resolution = 300,
      family = "serif"
      )
Figure
dev.off()

agg_tiff("../Figures/Predicted Probabilities/Adjusted-Hardship-Catchment-Interactions.tiff", units="mm", width=85, height=120, res=300)
Figure
dev.off()
```


```{r, echo=FALSE}

Figure <- ggplot(df, aes(x = Category, y = PredictedProbability, color = Catchment, fill = Catchment)) + 
            #geom_linerange(aes(ymin=LL, ymax=UL), color = "black", width=1, size=3, position = position_dodge(width = 0.90)) +
            geom_linerange(aes(ymin=LL, ymax=UL), width = 1, size = 1, position = position_dodge(width = 1)) +
            #geom_point(shape = 23, size = 4, color = "black", stroke = 1, position = position_dodge(width = 0.90)) +
            geom_point(shape = 23, size = 1.25, stroke = 0.5, position = position_dodge(width = 1)) +
            #geom_point(size = .5, color = "black", position = position_dodge(width = 0.90))
            facet_grid(Factor~., scales = "free", space = "free", switch = "y", shrink = FALSE)
```

```{r, echo=FALSE}
Figure <- Figure + theme(legend.title.align=0.5)
Figure <- Figure + scale_y_continuous(name="Predicted Number of Hardships", breaks=seq(0, 5, 1))
Figure <- Figure + scale_x_discrete(name="")
Figure <- Figure + theme(legend.position="top")
Figure <- Figure + theme(plot.title = element_text(hjust = 0.5))
Figure <- Figure + theme(text = element_text(size = 9))
Figure <- Figure + scale_color_viridis(name="", discrete=TRUE, begin = 0.7, end = 1) 
Figure <- Figure + scale_fill_viridis(name="", discrete=TRUE, begin = 0.7, end = 1) 
#Figure <- Figure + theme(legend.position="none")
Figure <- Figure + theme(axis.text.x  = element_text(size = 9, color = "black", family="Roboto Condensed"),
                         axis.text.y  = element_text(size = 9, color = "black", family="Roboto Condensed"),
                         axis.title.y = element_text(size = 9, color = "black", family="Roboto Condensed"),
                         axis.title.x = element_text(size = 9, color = "black", family="Roboto Condensed")) 
#Figure <- Figure + theme(panel.grid.major = element_line(colour = "black", size = .2, linetype = "dashed"))
#Figure <- Figure + theme(panel.grid.minor = element_line(colour = "black", size = .2, linetype = "dashed"))
#Figure <- Figure + theme(axis.line = element_line(colour = "black", size = .75, linetype = "solid"))
#Figure <- Figure + theme(panel.background = element_rect(fill = "white", colour="white"))
Figure <- Figure + annotate("rect", xmin = 1, xmax = 2, ymin = 0, ymax = 5,  alpha = 0)
Figure <- Figure + coord_flip()
Figure <- Figure + theme_dark()
Figure <- Figure + theme(legend.position="none")
Figure <- Figure + theme(strip.text.y.left = element_text(angle = 0))
Figure

cairo_pdf("../Figures/Predicted Probabilities/Adjusted-Hardship-Catchment-Interactions-2.pdf", 
      width  = 3.35, 
      height = 4.75,
      fallback_resolution = 300,
      family = "serif"
      )
Figure
dev.off()

agg_tiff("../Figures/Predicted Probabilities/Adjusted-Hardship-Catchment-Interactions-2.tiff", units="mm", width=85, height=120, res=300)
Figure
dev.off()

```

```{r, echo=FALSE}
Figure <- Figure + theme(legend.title.align=0.5)
Figure <- Figure + scale_y_continuous(name="Predicted Number of Hardships", breaks=seq(0, 5, 1))
Figure <- Figure + scale_x_discrete(name="")
Figure <- Figure + theme(legend.position="top")
Figure <- Figure + theme(plot.title = element_text(hjust = 0.5))
Figure <- Figure + theme(text = element_text(size = 12))
Figure <- Figure + scale_color_viridis(name="", discrete=TRUE, begin = 0.0, end = .5) 
Figure <- Figure + scale_fill_viridis(name="", discrete=TRUE, begin = 0.0, end = .5) 
#Figure <- Figure + theme(legend.position="none")
Figure <- Figure + theme(axis.text.x  = element_text(size = 12, color = "black", family="Roboto Condensed"),
                         axis.text.y  = element_text(size = 12, color = "black", family="Roboto Condensed"),
                         axis.title.y = element_text(size = 12, color = "black", family="Roboto Condensed"),
                         axis.title.x = element_text(size = 12, color = "black", family="Roboto Condensed")) 
#Figure <- Figure + theme(panel.grid.major = element_line(colour = "black", size = .2, linetype = "dashed"))
#Figure <- Figure + theme(panel.grid.minor = element_line(colour = "black", size = .2, linetype = "dashed"))
#Figure <- Figure + theme(axis.line = element_line(colour = "black", size = .75, linetype = "solid"))
#Figure <- Figure + theme(panel.background = element_rect(fill = "white", colour="white"))
Figure <- Figure + annotate("rect", xmin = 1, xmax = 2, ymin = 0, ymax = 5,  alpha = 0)
Figure <- Figure + coord_flip()
Figure <- Figure + theme_bw()
Figure <- Figure + theme(legend.position="none")
Figure <- Figure + theme(strip.text.y.left = element_text(angle = 0))
Figure <- Figure+ theme(plot.margin = margin(2, 2, 2, -2, "mm"))
Figure

cairo_pdf("../Figures/Predicted Probabilities/Adjusted-Hardship-Catchment-Interactions-3.pdf", 
      width  = 6.5, 
      height = 8.5,
      fallback_resolution = 300,
      family = "serif"
      )
Figure
dev.off()

agg_tiff("../Figures/Predicted Probabilities/Adjusted-Hardship-Catchment-Interactions-3.tiff", units="mm", width=85, height=120, res=300, scaling = .75)
Figure
dev.off()

```

                Covid_HH_Response_GOV_Help = govthelp
                
```{r, echo=FALSE}

data$CHHResponse_Sell_Assets <- NULL
data$CHHResponse_Sell_Assets[data$Covid_HH_Response_Sell_Assets == 1]  <- 1
data$CHHResponse_Sell_Assets[data$Covid_HH_Response_Sell_Assets == 0]  <- 0
data$`Sell Assets (Covid Household Response)` <- factor(data$CHHResponse_Sell_Assets,
                    levels = c(0,1),
                    labels = c("No", "Yes"))

tab1(data$`Sell Assets (Covid Household Response)`, sort.group = "decreasing", cum.percent = TRUE)

data$CHHResponse_Sell_Assets_V <- data$CHHResponse_Sell_Assets

data$CHHResponse_Generate_Income <- NULL
data$CHHResponse_Generate_Income[data$Covid_HH_Response_Generate_Income == 1]  <- 1
data$CHHResponse_Generate_Income[data$Covid_HH_Response_Generate_Income == 0]  <- 0
data$`Generate Income (Covid Household Response)` <- factor(data$CHHResponse_Generate_Income,
                    levels = c(0,1),
                    labels = c("No", "Yes"))

tab1(data$`Generate Income (Covid Household Response)`, sort.group = "decreasing", cum.percent = TRUE)

data$CHHResponse_Generate_Income_V <- data$CHHResponse_Generate_Income

data$CHHResponse_FF_Help <- NULL
data$CHHResponse_FF_Help[data$Covid_HH_Response_FF_Help == 1]  <- 1
data$CHHResponse_FF_Help[data$Covid_HH_Response_FF_Help == 0]  <- 0
data$`Family/Friend Help (Covid Household Response)` <- factor(data$CHHResponse_FF_Help,
                    levels = c(0,1),
                    labels = c("No", "Yes"))

tab1(data$`Family/Friend Help (Covid Household Response)`, sort.group = "decreasing", cum.percent = TRUE)

data$CHHResponse_FF_Help_V <- data$CHHResponse_FF_Help

data$CHHResponse_Borrow_Family <- NULL
data$CHHResponse_Borrow_Family[data$Covid_HH_Response_Borrow_Family == 1]  <- 1
data$CHHResponse_Borrow_Family[data$Covid_HH_Response_Borrow_Family == 0]  <- 0
data$`Borrow from Family/Friends (Covid Household Response)` <- factor(data$CHHResponse_Borrow_Family,
                    levels = c(0,1),
                    labels = c("No", "Yes"))

tab1(data$`Borrow from Family/Friends (Covid Household Response)`, sort.group = "decreasing", cum.percent = TRUE)

data$CHHResponse_Borrow_Family_V <- data$CHHResponse_Borrow_Family

data$CHHResponse_Took_Loan <- NULL
data$CHHResponse_Took_Loan[data$Covid_HH_Response_Took_Loan == 1]  <- 1
data$CHHResponse_Took_Loan[data$Covid_HH_Response_Took_Loan == 0]  <- 0
data$`Took Loan (Covid Household Response)` <- factor(data$CHHResponse_Took_Loan,
                    levels = c(0,1),
                    labels = c("No", "Yes"))

tab1(data$`Took Loan (Covid Household Response)`, sort.group = "decreasing", cum.percent = TRUE)

data$CHHResponse_Took_Loan_V <- data$CHHResponse_Took_Loan

data$CHHResponse_Delay_Payment <- NULL
data$CHHResponse_Delay_Payment[data$Covid_HH_Response_Delay_Payment == 1]  <- 1
data$CHHResponse_Delay_Payment[data$Covid_HH_Response_Delay_Payment == 0]  <- 0
data$`Delayed Payments (Covid Household Response)` <- factor(data$CHHResponse_Delay_Payment,
                    levels = c(0,1),
                    labels = c("No", "Yes"))

tab1(data$`Delayed Payments (Covid Household Response)`, sort.group = "decreasing", cum.percent = TRUE)

data$CHHResponse_Delay_Payment_V <- data$CHHResponse_Delay_Payment

data$CHHResponse_Sold_Harvest <- NULL
data$CHHResponse_Sold_Harvest[data$Covid_HH_Response_Sold_Harvest == 1]  <- 1
data$CHHResponse_Sold_Harvest[data$Covid_HH_Response_Sold_Harvest == 0]  <- 0
data$`Sold Harvest (Covid Household Response)` <- factor(data$CHHResponse_Sold_Harvest,
                    levels = c(0,1),
                    labels = c("No", "Yes"))

tab1(data$`Sold Harvest (Covid Household Response)`, sort.group = "decreasing", cum.percent = TRUE)

data$CHHResponse_CHHResponse_Sold_Harvest_V <- data$CHHResponse_CHHResponse_Sold_Harvest

data$CHHResponse_Reduce_Food_Consumption <- NULL
data$CHHResponse_Reduce_Food_Consumption[data$Covid_HH_Response_Reduce_Food_Consumption == 1]  <- 1
data$CHHResponse_Reduce_Food_Consumption[data$Covid_HH_Response_Reduce_Food_Consumption == 0]  <- 0
data$`Reduced Food Consumption (Covid Household Response)` <- factor(data$CHHResponse_Reduce_Food_Consumption,
                    levels = c(0,1),
                    labels = c("No", "Yes"))

tab1(data$`Reduced Food Consumption (Covid Household Response)`, sort.group = "decreasing", cum.percent = TRUE)

data$CHHResponse_Reduce_Food_Consumption_V <- data$CHHResponse_Reduce_Food_Consumption

data$CHHResponse_Reduce_Consumption <- NULL
data$CHHResponse_Reduce_Consumption[data$Covid_HH_Response_Reduce_Consumption == 1]  <- 1
data$CHHResponse_Reduce_Consumption[data$Covid_HH_Response_Reduce_Consumption == 0]  <- 0
data$`Reduced Consumption (Covid Household Response)` <- factor(data$CHHResponse_Reduce_Consumption,
                    levels = c(0,1),
                    labels = c("No", "Yes"))

tab1(data$`Reduced Consumption (Covid Household Response)`, sort.group = "decreasing", cum.percent = TRUE)

data$CHHResponse_Reduce_Consumption_V <- data$CHHResponse_Reduce_Consumption

data$CHHResponse_Relied_Savings <- NULL
data$CHHResponse_Relied_Savings[data$Covid_HH_Response_Relied_Savings == 1]  <- 1
data$CHHResponse_Relied_Savings[data$Covid_HH_Response_Relied_Savings == 0]  <- 0
data$`Relied on Savings (Covid Household Response)` <- factor(data$CHHResponse_Relied_Savings,
                    levels = c(0,1),
                    labels = c("No", "Yes"))

tab1(data$`Relied on Savings (Covid Household Response)`, sort.group = "decreasing", cum.percent = TRUE)

data$CHHResponse_Relied_Savings_V <- data$CHHResponse_Relied_Savings

data$CHHResponse_NGO_Help <- NULL
data$CHHResponse_NGO_Help[data$Covid_HH_Response_NGO_Help== 1]  <- 1
data$CHHResponse_NGO_Help[data$Covid_HH_Response_GOV_Help== 1]  <- 1
data$CHHResponse_NGO_Help[data$Covid_HH_Response_NGO_Help == 0]  <- 0
data$`NGO/GOV Help (Covid Household Response)` <- factor(data$CHHResponse_NGO_Help,
                    levels = c(0,1),
                    labels = c("No", "Yes"))

tab1(data$`NGO/GOV Help (Covid Household Response)`, sort.group = "decreasing", cum.percent = TRUE)

data$CHHResponse_NGO_Help_V <- data$CHHResponse_NGO_Help

data$CHHResponse_GOV_Help <- NULL
data$CHHResponse_GOV_Help[data$Covid_HH_Response_GOV_Help== 1]  <- 1
data$CHHResponse_GOV_Help[data$Covid_HH_Response_GOV_Help == 0]  <- 0
data$`GOV Help (Covid Household Response)` <- factor(data$CHHResponse_GOV_Help,
                    levels = c(0,1),
                    labels = c("No", "Yes"))

tab1(data$`GOV Help (Covid Household Response)`, sort.group = "decreasing", cum.percent = TRUE)

data$CHHResponse_GOV_Help_V <- data$CHHResponse_GOV_Help

data$CHHResponse_Pay_Advance <- NULL
data$CHHResponse_Pay_Advance[data$Covid_HH_Response_Pay_Advance== 1]  <- 1
data$CHHResponse_Pay_Advance[data$Covid_HH_Response_Pay_Advance == 0]  <- 0
data$`Pay Advance (Covid Household Response)` <- factor(data$CHHResponse_Pay_Advance,
                    levels = c(0,1),
                    labels = c("No", "Yes"))

tab1(data$`Pay Advance (Covid Household Response)`, sort.group = "decreasing", cum.percent = TRUE)

data$CHHResponse_Pay_Advance_V <- data$CHHResponse_Pay_Advance

data$CHHResponse_Other <- NULL
data$CHHResponse_Other[data$Covid_HH_Response_Other== 1]  <- 1
data$CHHResponse_Other[data$Covid_HH_Response_Other == 0]  <- 0
data$`Other (Covid Household Response)` <- factor(data$CHHResponse_Other,
                    levels = c(0,1),
                    labels = c("No", "Yes"))

tab1(data$`Other (Covid Household Response)`, sort.group = "decreasing", cum.percent = TRUE)

data$CHHResponse_Other_V <- data$CHHResponse_Other
```

```{r}
data <- data %>% #specify dply::select because MASS also has a select that will give you an error
  dplyr::relocate(c("CHHResponse_Sell_Assets",
                    "CHHResponse_Generate_Income",
                    "CHHResponse_FF_Help",
                    "CHHResponse_Borrow_Family",
                    "CHHResponse_Took_Loan",
                    "CHHResponse_Delay_Payment",
                    "CHHResponse_Sold_Harvest",
                    "CHHResponse_Reduce_Food_Consumption",
                    "CHHResponse_Reduce_Consumption",
                    "CHHResponse_Relied_Savings",
                    "CHHResponse_NGO_Help",
                    "CHHResponse_GOV_Help",
                    "CHHResponse_Pay_Advance",
                    "CHHResponse_Other"), .after=last_col())

dim(data)    
head(data[5, 293:306])

#creating an additive Hardship Index variable- factor
data$CHHResponse <-rowSums(data[,c(293:306)])          
descr(data$CHHResponse)
table(data$CHHResponse)
```

*Adjusted associations with Hardships*

```{r, echo=FALSE, results='hide'}
panels <- list(
  list(width = 0.01),
  list(width = 0.22, display = ~variable, fontface = "bold", heading = "Variable"),
  list(width = 0.15, display = ~level),
  #list(width = 0.05, display = ~n, hjust = 1, heading = "n"),
  list(width = 0.01, item = "vline", hjust = 0.5),
  list(width = 0.32, item = "forest", hjust = 0.5, heading = "Adjusted Odds Ratios", linetype = "dotted", color = "red", line_x = 0),
  list(width = 0.01, item = "vline", hjust = 0.5),
  list(width = 0.12, display = ~ ifelse(reference, "Reference", sprintf("%0.2f (%0.2f, %0.2f)", trans(estimate), trans(conf.low), trans(conf.high))), display_na = NA),
  #list(width = 0.05, display = ~ ifelse(reference, "", format.pval(p.value, digits = 1, eps = 0.001)), display_na = NA, hjust = 1, heading = "p"),
  list(width = 0.01)
)
```

```{r}
write.csv(data, "../Data/Ethiopia Analysis Data.csv")
```

```{r}
data <-data[data$HardshipIndex != 0,]
str(data)
table(data$HardshipIndex)
```

```{r}
# all covariates
FinalModel <- glm(formula = `Sell Assets (Covid Household Response)` ~  `Age (Household Head)` +
                                                                        `Sex (Household Head)` +
                                                                        `Ethnicity (Household Head)` +
                                                                        `Education (Household Head)` +
                                                                        `Occupation (Household Head)` + 
                                                                        #`Residence (Household)`+ 
                                                                        `Urbanicity (Household)` +
                                                                        `Household Size` +
                                                                         #`Dependents (Household)` +
                                                                        `Adults Over Age 60 (Household)` +
                                                                        `Children Under Age 5 (Household)` +
                                                                        `Income (Household)`+
                                                                        `Wealth Index (Household)`+
                                                                        `Job Loss (Household)`+
                                                                        `Nonfarm Business Closure (Household)` +
                                                                        `Farm Disruption (Household)` +
                                                                        `Livestock Disruption (Household)`+
                                                                        `Fishing Disruption (Household)`+
                                                                        `Input Inflation (Household)`+
                                                                        `Output Deflation (Household)`+
                                                                        `Food Price Increase (Household)`+
                                                                        `Illness/Death (Household)`, family = binomial, data = data)
 
# Print the regression model
summary(FinalModel)
```

```{r}
# Produce forest plots
model_list <- list(FinalModel)
multivariate_plots <- forest_model(model_list = model_list, exponentiate = TRUE, format_options = forest_model_format_options(colour = "black", color = NULL, shape = 18, text_size = 12, point_size = 1.25, banded = TRUE), panels = panels, merge_models = TRUE, factor_separate_line = TRUE, recalculate_width = FALSE, recalculate_height = TRUE) 
multivariate_plots <- multivariate_plots + theme(text = element_text(size = 6))
multivariate_plots <- multivariate_plots + geom_segment(x = 0, y = 0, xend = 0, yend = 75.4, linetype="solid", color = "darkred", size=0.5)
multivariate_plots

cairo_pdf("../Figures/Odds Ratios/Responses/Adjusted_Plot_Sell_Assets.pdf", 
      width  = 3.35, 
      height = 4.75,
      fallback_resolution = 300,
      family = "serif"
      )
multivariate_plots
dev.off()

agg_tiff("../Figures/Odds Ratios/Responses/Adjusted_Plot_Sell_Assets.tiff", units="mm", width=85, height=120, res=300)
multivariate_plots
dev.off()

```

```{r}
# all covariates
FinalModel <- glm(formula = `Generate Income (Covid Household Response)` ~  `Age (Household Head)` +
                                                                        `Sex (Household Head)` +
                                                                        `Ethnicity (Household Head)` +
                                                                        `Education (Household Head)` +
                                                                        `Occupation (Household Head)` + 
                                                                        #`Residence (Household)`+ 
                                                                        `Urbanicity (Household)` +
                                                                        `Household Size` +
                                                                         #`Dependents (Household)` +
                                                                        `Adults Over Age 60 (Household)` +
                                                                        `Children Under Age 5 (Household)` +
                                                                        `Income (Household)`+
                                                                        `Wealth Index (Household)`+
                                                                        `Job Loss (Household)`+
                                                                        `Nonfarm Business Closure (Household)` +
                                                                        `Farm Disruption (Household)` +
                                                                        `Livestock Disruption (Household)`+
                                                                        `Fishing Disruption (Household)`+
                                                                        `Input Inflation (Household)`+
                                                                        `Output Deflation (Household)`+
                                                                        `Food Price Increase (Household)`+
                                                                        `Illness/Death (Household)`, family = binomial, data = data)
 
# Print the regression model
summary(FinalModel)
```

```{r}
# Produce forest plots
model_list <- list(FinalModel)
multivariate_plots <- forest_model(model_list = model_list, exponentiate = TRUE, format_options = forest_model_format_options(colour = "black", color = NULL, shape = 18, text_size = 12, point_size = 1.25, banded = TRUE), panels = panels, merge_models = TRUE, factor_separate_line = TRUE, recalculate_width = FALSE, recalculate_height = TRUE, breaks = c(-2.99573227355, -1.38629436112, 0, 1.60943791243, 3.21887582487, 3.91202300543)) 
multivariate_plots <- multivariate_plots + theme(text = element_text(size = 6))
multivariate_plots <- multivariate_plots + geom_segment(x = 0, y = 0, xend = 0, yend = 75.4, linetype="solid", color = "darkred", size=0.5)
multivariate_plots

cairo_pdf("../Figures/Odds Ratios/Responses/Adjusted_Plot_Generate_Income.pdf", 
      width  = 3.35, 
      height = 4.75,
      fallback_resolution = 300,
      family = "serif"
      )
multivariate_plots
dev.off()

agg_tiff("../Figures/Odds Ratios/Responses/Adjusted_Plot_Generate_Income.tiff", units="mm", width=85, height=120, res=300)
multivariate_plots
dev.off()

```


```{r}
# all covariates
FinalModel <- glm(formula = `Family/Friend Help (Covid Household Response)` ~  `Age (Household Head)` +
                                                                        `Sex (Household Head)` +
                                                                        `Ethnicity (Household Head)` +
                                                                        `Education (Household Head)` +
                                                                        `Occupation (Household Head)` + 
                                                                        #`Residence (Household)`+ 
                                                                        `Urbanicity (Household)` +
                                                                        `Household Size` +
                                                                         #`Dependents (Household)` +
                                                                        `Adults Over Age 60 (Household)` +
                                                                        `Children Under Age 5 (Household)` +
                                                                        `Income (Household)`+
                                                                        `Wealth Index (Household)`+
                                                                        `Job Loss (Household)`+
                                                                        `Nonfarm Business Closure (Household)` +
                                                                        `Farm Disruption (Household)` +
                                                                        `Livestock Disruption (Household)`+
                                                                        `Fishing Disruption (Household)`+
                                                                        `Input Inflation (Household)`+
                                                                        `Output Deflation (Household)`+
                                                                        `Food Price Increase (Household)`+
                                                                        `Illness/Death (Household)`, family = binomial, data = data)
 
# Print the regression model
summary(FinalModel)
```

```{r}
# Produce forest plots
model_list <- list(FinalModel)
multivariate_plots <- forest_model(model_list = model_list, exponentiate = TRUE, format_options = forest_model_format_options(colour = "black", color = NULL, shape = 18, text_size = 12, point_size = 1.25, banded = TRUE), panels = panels, merge_models = TRUE, factor_separate_line = TRUE, recalculate_width = FALSE, recalculate_height = TRUE) 
multivariate_plots <- multivariate_plots + theme(text = element_text(size = 6))
multivariate_plots <- multivariate_plots + geom_segment(x = 0, y = 0, xend = 0, yend = 75.4, linetype="solid", color = "darkred", size=0.5)
multivariate_plots

cairo_pdf("../Figures/Odds Ratios/Responses/Adjusted_Plot_FF_Help.pdf", 
      width  = 3.35, 
      height = 4.75,
      fallback_resolution = 300,
      family = "serif"
      )
multivariate_plots
dev.off()

agg_tiff("../Figures/Odds Ratios/Responses/Adjusted_Plot_FF_Help.tiff", units="mm", width=85, height=120, res=300)
multivariate_plots
dev.off()

```

```{r}
# all covariates
FinalModel <- glm(formula = `Borrow from Family/Friends (Covid Household Response)` ~  `Age (Household Head)` +
                                                                        `Sex (Household Head)` +
                                                                        `Ethnicity (Household Head)` +
                                                                        `Education (Household Head)` +
                                                                        `Occupation (Household Head)` + 
                                                                        #`Residence (Household)`+ 
                                                                        `Urbanicity (Household)` +
                                                                        `Household Size` +
                                                                         #`Dependents (Household)` +
                                                                        `Adults Over Age 60 (Household)` +
                                                                        `Children Under Age 5 (Household)` +
                                                                        `Income (Household)`+
                                                                        `Wealth Index (Household)`+
                                                                        `Job Loss (Household)`+
                                                                        `Nonfarm Business Closure (Household)` +
                                                                        `Farm Disruption (Household)` +
                                                                        `Livestock Disruption (Household)`+
                                                                        `Fishing Disruption (Household)`+
                                                                        `Input Inflation (Household)`+
                                                                        `Output Deflation (Household)`+
                                                                        `Food Price Increase (Household)`+
                                                                        `Illness/Death (Household)`, family = binomial, data = data)
 
# Print the regression model
summary(FinalModel)
```

```{r}
# Produce forest plots
model_list <- list(FinalModel)
multivariate_plots <- forest_model(model_list = model_list, exponentiate = TRUE, format_options = forest_model_format_options(colour = "black", color = NULL, shape = 18, text_size = 12, point_size = 1.25, banded = TRUE), panels = panels, merge_models = TRUE, factor_separate_line = TRUE, recalculate_width = FALSE, recalculate_height = TRUE) 
multivariate_plots <- multivariate_plots + theme(text = element_text(size = 6))
multivariate_plots <- multivariate_plots + geom_segment(x = 0, y = 0, xend = 0, yend = 75.4, linetype="solid", color = "darkred", size=0.5)
multivariate_plots

cairo_pdf("../Figures/Odds Ratios/Responses/Adjusted_Plot_FF_Borrow.pdf", 
      width  = 3.35, 
      height = 4.75,
      fallback_resolution = 300,
      family = "serif"
      )
multivariate_plots
dev.off()

agg_tiff("../Figures/Odds Ratios/Responses/Adjusted_Plot_FF_Borrow.tiff", units="mm", width=85, height=120, res=300)
multivariate_plots
dev.off()

```

```{r}
# all covariates
FinalModel <- glm(formula = `Reduced Food Consumption (Covid Household Response)` ~    `Age (Household Head)` +
                                                                        `Sex (Household Head)` +
                                                                        `Ethnicity (Household Head)` +
                                                                        `Education (Household Head)` +
                                                                        `Occupation (Household Head)` + 
                                                                        #`Residence (Household)`+ 
                                                                        `Urbanicity (Household)` +
                                                                        `Household Size` +
                                                                         #`Dependents (Household)` +
                                                                        `Adults Over Age 60 (Household)` +
                                                                        `Children Under Age 5 (Household)` +
                                                                        `Income (Household)`+
                                                                        `Wealth Index (Household)`+
                                                                        `Job Loss (Household)`+
                                                                        `Nonfarm Business Closure (Household)` +
                                                                        `Farm Disruption (Household)` +
                                                                        `Livestock Disruption (Household)`+
                                                                        `Fishing Disruption (Household)`+
                                                                        `Input Inflation (Household)`+
                                                                        `Output Deflation (Household)`+
                                                                        `Food Price Increase (Household)`+
                                                                        `Illness/Death (Household)`, family = binomial, data = data)
 
# Print the regression model
summary(FinalModel)
```

```{r}
# Produce forest plots
model_list <- list(FinalModel)
multivariate_plots <- forest_model(model_list = model_list, exponentiate = TRUE, format_options = forest_model_format_options(colour = "black", color = NULL, shape = 18, text_size = 12, point_size = 1.25, banded = TRUE), panels = panels, merge_models = TRUE, factor_separate_line = TRUE, recalculate_width = FALSE, recalculate_height = TRUE) 
multivariate_plots <- multivariate_plots + theme(text = element_text(size = 6))
multivariate_plots <- multivariate_plots + geom_segment(x = 0, y = 0, xend = 0, yend = 75.4, linetype="solid", color = "darkred", size=0.5)
multivariate_plots

cairo_pdf("../Figures/Odds Ratios/Responses/Adjusted_Plot_Reduced_Food_Consumption.pdf", 
      width  = 3.35, 
      height = 4.75,
      fallback_resolution = 300,
      family = "serif"
      )
multivariate_plots
dev.off()

agg_tiff("../Figures/Odds Ratios/Responses/Adjusted_Plot_Reduced_Food_Consumption.tiff", units="mm", width=85, height=120, res=300)
multivariate_plots
dev.off()

```

```{r}
# all covariates
FinalModel <- glm(formula = `Reduced Consumption (Covid Household Response)` ~    `Age (Household Head)` +
                                                                        `Sex (Household Head)` +
                                                                        `Ethnicity (Household Head)` +
                                                                        `Education (Household Head)` +
                                                                        `Occupation (Household Head)` + 
                                                                        #`Residence (Household)`+ 
                                                                        `Urbanicity (Household)` +
                                                                        `Household Size` +
                                                                         #`Dependents (Household)` +
                                                                        `Adults Over Age 60 (Household)` +
                                                                        `Children Under Age 5 (Household)` +
                                                                        `Income (Household)`+
                                                                        `Wealth Index (Household)`+
                                                                        `Job Loss (Household)`+
                                                                        `Nonfarm Business Closure (Household)` +
                                                                        `Farm Disruption (Household)` +
                                                                        `Livestock Disruption (Household)`+
                                                                        `Fishing Disruption (Household)`+
                                                                        `Input Inflation (Household)`+
                                                                        `Output Deflation (Household)`+
                                                                        `Food Price Increase (Household)`+
                                                                        `Illness/Death (Household)`, family = binomial, data = data)
 
# Print the regression model
summary(FinalModel)
```

```{r}
# Produce forest plots
model_list <- list(FinalModel)
multivariate_plots <- forest_model(model_list = model_list, exponentiate = TRUE, format_options = forest_model_format_options(colour = "black", color = NULL, shape = 18, text_size = 12, point_size = 1.25, banded = TRUE), panels = panels, merge_models = TRUE, factor_separate_line = TRUE, recalculate_width = FALSE, recalculate_height = TRUE) 
multivariate_plots <- multivariate_plots + theme(text = element_text(size = 6))
multivariate_plots <- multivariate_plots + geom_segment(x = 0, y = 0, xend = 0, yend = 75.4, linetype="solid", color = "darkred", size=0.5)
multivariate_plots

cairo_pdf("../Figures/Odds Ratios/Responses/Adjusted_Plot_Reduced_Consumption.pdf", 
      width  = 3.35, 
      height = 4.75,
      fallback_resolution = 300,
      family = "serif"
      )
multivariate_plots
dev.off()

agg_tiff("../Figures/Odds Ratios/Responses/Adjusted_Plot_Reduced_Consumption.tiff", units="mm", width=85, height=120, res=300)
multivariate_plots
dev.off()

```

```{r}
# all covariates
FinalModel <- glm(formula = `Relied on Savings (Covid Household Response)` ~    `Age (Household Head)` +
                                                                        `Sex (Household Head)` +
                                                                        `Ethnicity (Household Head)` +
                                                                        `Education (Household Head)` +
                                                                        `Occupation (Household Head)` + 
                                                                        #`Residence (Household)`+ 
                                                                        `Urbanicity (Household)` +
                                                                        `Household Size` +
                                                                         #`Dependents (Household)` +
                                                                        `Adults Over Age 60 (Household)` +
                                                                        `Children Under Age 5 (Household)` +
                                                                        `Income (Household)`+
                                                                        `Wealth Index (Household)`+
                                                                        `Job Loss (Household)`+
                                                                        `Nonfarm Business Closure (Household)` +
                                                                        `Farm Disruption (Household)` +
                                                                        `Livestock Disruption (Household)`+
                                                                        `Fishing Disruption (Household)`+
                                                                        `Input Inflation (Household)`+
                                                                        `Output Deflation (Household)`+
                                                                        `Food Price Increase (Household)`+
                                                                        `Illness/Death (Household)`, family = binomial, data = data)
 
# Print the regression model
summary(FinalModel)
```

```{r}
# Produce forest plots
model_list <- list(FinalModel)
multivariate_plots <- forest_model(model_list = model_list, exponentiate = TRUE, format_options = forest_model_format_options(colour = "black", color = NULL, shape = 18, text_size = 12, point_size = 1.25, banded = TRUE), panels = panels, merge_models = TRUE, factor_separate_line = TRUE, recalculate_width = FALSE, recalculate_height = TRUE) 
multivariate_plots <- multivariate_plots + theme(text = element_text(size = 6))
multivariate_plots <- multivariate_plots + geom_segment(x = 0, y = 0, xend = 0, yend = 75.4, linetype="solid", color = "darkred", size=0.5)
multivariate_plots

pdf("../Figures/Odds Ratios/Responses/Adjusted_Plot_Relied_Savings.pdf", width = 3.5, height = 4.75)
multivariate_plots
dev.off()
```

```{r}
# all covariates
FinalModel <- glm(formula = `GOV Help (Covid Household Response)` ~    `Age (Household Head)` +
                                                                        `Sex (Household Head)` +
                                                                        `Ethnicity (Household Head)` +
                                                                        `Education (Household Head)` +
                                                                        `Occupation (Household Head)` + 
                                                                        #`Residence (Household)`+ 
                                                                        `Urbanicity (Household)` +
                                                                        `Household Size` +
                                                                         #`Dependents (Household)` +
                                                                        `Adults Over Age 60 (Household)` +
                                                                        `Children Under Age 5 (Household)` +
                                                                        `Income (Household)`+
                                                                        `Wealth Index (Household)`+
                                                                        `Job Loss (Household)`+
                                                                        `Nonfarm Business Closure (Household)` +
                                                                        `Farm Disruption (Household)` +
                                                                        `Livestock Disruption (Household)`+
                                                                        `Fishing Disruption (Household)`+
                                                                        `Input Inflation (Household)`+
                                                                        `Output Deflation (Household)`+
                                                                        `Food Price Increase (Household)`+
                                                                        `Illness/Death (Household)`, family = binomial, data = data)
 
# Print the regression model
summary(FinalModel)
```

```{r}
# Produce forest plots
model_list <- list(FinalModel)
multivariate_plots <- forest_model(model_list = model_list, exponentiate = TRUE, format_options = forest_model_format_options(colour = "black", color = NULL, shape = 18, text_size = 12, point_size = 1.25, banded = TRUE), panels = panels, merge_models = TRUE, factor_separate_line = TRUE, recalculate_width = FALSE, recalculate_height = TRUE) 
multivariate_plots <- multivariate_plots + theme(text = element_text(size = 6))
multivariate_plots <- multivariate_plots + geom_segment(x = 0, y = 0, xend = 0, yend = 75.4, linetype="solid", color = "darkred", size=0.5)
multivariate_plots

pdf("../Figures/Odds Ratios/Responses/Adjusted_Plot_GOV_Help.pdf", width = 3.5, height = 4.75)
multivariate_plots
dev.off()
```

```{r}

#data <- as.data.frame(data)

data <- data %>% #specify dply::select because MASS also has a select that will give you an error
  dplyr::relocate(c("Covid_HH_Response_Sell_Assets",
                    "Covid_HH_Response_Generate_Income",
                    "Covid_HH_Response_FF_Help",
                    "Covid_HH_Response_Borrow_Family",
                    "Covid_HH_Response_Took_Loan",
                    "Covid_HH_Response_Delay_Payment",
                    "Covid_HH_Response_Sold_Harvest",
                    "Covid_HH_Response_Reduce_Food_Consumption",
                    "Covid_HH_Response_Reduce_Consumption",
                    "Covid_HH_Response_Relied_Savings",
                    "Covid_HH_Response_NGO_Help",
                    "Covid_HH_Response_GOV_Help",
                    "Covid_HH_Response_Pay_Advance",
                    "Covid_HH_Response_Other"), .after=last_col())

dim(data)    

data$"id" <- seq.int(nrow(data))

descr(data$id)

dat.1 <- data %>% 
  dplyr::select(c(
    "id",
    "Covid_HH_Response_Sell_Assets",
    "Covid_HH_Response_Generate_Income",
    "Covid_HH_Response_FF_Help",
    "Covid_HH_Response_Borrow_Family",
    "Covid_HH_Response_Took_Loan",
    "Covid_HH_Response_Delay_Payment",
    "Covid_HH_Response_Sold_Harvest",
    "Covid_HH_Response_Reduce_Food_Consumption",
    "Covid_HH_Response_Reduce_Consumption",
    "Covid_HH_Response_Relied_Savings",
    "Covid_HH_Response_NGO_Help",
    "Covid_HH_Response_GOV_Help",
    "Covid_HH_Response_Pay_Advance",
    "Covid_HH_Response_Other")) %>%
  rename(id="id") 

dat.1$COUNT <- rowSums(dat.1[c(2:ncol(dat.1))])
```

```{r}
# waffle  plot
cairo_pdf("../Figures/Household Responses/Response_Index_Plot_1.pdf", 
      width  = 6.5, 
      height = 4.75,
      fallback_resolution = 300,
      family = "serif"
      )
dat.1 %>%
  dplyr::select(id,COUNT) %>%
  melt(id='id') %>%
  count(value) %>%
  rename(`Number of hardships reported`=value) %>%
  
  ggplot(aes(fill = `Number of hardships reported`, values = n)) +
  geom_waffle(color = "white", size = .25, n_rows = 20, flip = F) +
  scale_y_discrete() +
  scale_x_continuous(labels = function(x) x * 20, # make this multiplyer the same as n_rows
                     expand = c(0,0)) +
  scale_fill_manual(values=(viridis(n=11)))+
  coord_equal() +
  labs(
    title = "Number of Responses Reported",
    # x = "Age group",
  ) +
  theme_minimal() +
  theme(
    axis.title=element_blank(),
    panel.grid = element_blank(),
    legend.title=element_blank(),
    legend.position = "right",
    legend.text = element_text(size=8.8, family="Times"),
    legend.key.size = unit(.55, "cm"),
    plot.title = element_text(face="bold", size=11, family="Times"),
    axis.ticks.y = element_line()) +
  guides(fill = guide_legend(reverse = TRUE))
dev.off()
```

```{r}
# forest plot
cairo_pdf("../Figures/Household Responses/Response_Index_Plot_2.pdf", 
      width  = 6.5, 
      height = 4.75,
      fallback_resolution = 300,
      family = "serif"
      )
data %>% 
  dplyr::select(c(
    "id",
    "Covid_HH_Response_Sell_Assets",
    "Covid_HH_Response_Generate_Income",
    "Covid_HH_Response_FF_Help",
    "Covid_HH_Response_Borrow_Family",
    "Covid_HH_Response_Took_Loan",
    "Covid_HH_Response_Delay_Payment",
    "Covid_HH_Response_Sold_Harvest",
    "Covid_HH_Response_Reduce_Food_Consumption",
    "Covid_HH_Response_Reduce_Consumption",
    "Covid_HH_Response_Relied_Savings",
    "Covid_HH_Response_NGO_Help",
    "Covid_HH_Response_GOV_Help",
    "Covid_HH_Response_Pay_Advance",
    "Covid_HH_Response_Other")) %>%
  rename(id="id") %>%
  melt(id='id') %>%
  group_by(variable) %>%
  count(value) %>%
  filter(value==1) %>%
  rowwise() %>%
  
  mutate(
    PROP = round(n/nrow(data)*100, 1),
    L.CI = round(prop.test(n, nrow(data), conf.level=0.95)$conf.int[1]*100, 1),
    U.CI = round(prop.test(n, nrow(data), conf.level=0.95)$conf.int[2]*100, 1),
  ) %>%
  mutate(LABEL=paste(
    format(round(PROP, digits=1), nsmall = 1), " (",
    format(round(L.CI, digits=1), nsmall = 1), ", ",
    format(round(U.CI, digits=1), nsmall = 1), ")", sep =""),
    variable = gsub("_"," ",variable)) %>%
  #mutate(variable = ifelse(variable=='Illness Death','Illness or Death',variable)) %>%

  ggplot(aes(y=reorder(variable,PROP), x=PROP))+
  theme_ipsum_rc() +
  labs(y="Household Responses to COVID-19 Related Hardships\n")+
  geom_pointrange(
    size=.33,
    aes(xmin=L.CI, xmax=U.CI)) +
  geom_text(
    family="Times",
    aes(y=variable,label=LABEL,x = 41),
    hjust = 1,size = 3.1,show.legend = FALSE,parse = F) +
  
  theme(
    legend.position = "none",
    legend.title = element_blank(),
    title= element_blank(),
    axis.text = element_text(size=9, family="Times"),
    axis.title.y = element_text(face="bold", size=10.5, family="Times", hjust = 0.5),
    axis.title.x = element_blank(),
    plot.margin = unit(c(0.5,6.5,0.5,0.5), "lines")
  ) +
  scale_x_continuous(labels = function(x) paste0(x, "%"),expand = c(0, 0)) +
  scale_y_discrete('', labels = c( "Requested a Pay Advance",
                               "Sold Harvest",
                               "Other",
                               "Delayed Payments",
                               "NGO Help",
                               "Reduced Non-food Consumption",
                               "Government Help",
                               "Took Out a Loan",
                               "Relied on Savings",
                               "Borrowed from Family or Friends",
                               "Help from Family or Friends",
                               "Generate Additional Income",
                               "Sold Assets",
                               "Reduced Food Consumption"
                                    )) +
  coord_cartesian(clip = "off", xlim=c(0,30))+
  annotate("rect", xmin = 0, xmax = 50, ymin = 1, ymax = 13,  alpha = 0)

dev.off()  

```

