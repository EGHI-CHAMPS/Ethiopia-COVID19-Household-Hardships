---
title: "Household-level Impacts of COVID-19 in Ethiopia: Household Hardships"
author: "Jonathan Muir"
date: "Spring 2022"
output: html_document
---

```{r install-packages-for-analysis, echo=FALSE, eval=TRUE}
packageurl <- "https://cran.r-project.org/src/contrib/Archive/haven/haven_2.5.0.tar.gz"
install.packages(packageurl, repos=NULL, type="source")
packageurl <- "https://cran.r-project.org/src/contrib/summarytools_1.0.1.tar.gz"
install.packages(packageurl, repos=NULL, type="source")
#library(githubinstall)
#githubinstall("waffle")
```

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
library(pander) # makes tables clean and aesthetically pleasing
library(ggplot2) # the most up to date visualization package for R
library(tidyverse) # package of packages: includes ggplot2 and dplyr- great at filtering and subsetting  data;haven is part of tidyverse: allows use of data files from SAS, SPSS, or Stata
library(haven) # read in .dta data
library(readxl) # makes reading in Excel files and updating them easily possible
library(vtable) #sumtable for summary statistics
library(FactoMineR) #for computing principle component methods
library(factoextra) #for extracting, visualizing and interpreting PCA results
library(cluster) # clustering methods
library(finalfit) # fun and logistic regression
library(stargazer) #Table formatting for Word
library(modelsummary) #produces output for every common format
library(ltm) #Cronbach's Alpha -- to assess internal consistency of survey data
library(flextable) #tables for word
library(labelled) #unlabelling haven labeled variables
library(leaps) #model selection
library(kableExtra) # model summary tables
library(jtools) #more model tables
library(ggstance) #visualizing models
library(huxtable) #exporting tables
library(viridis) # color scheme
library(epiDisplay)
library(magicfor) # used in PCA Wealth Index code
library(gmodels) # used in PCA Wealth Index code
library(forestmodel) # Forest plots for ORs
library(ggpubr) # Forest plot formatting
library(grid)
library(gridExtra)
library(dplyr)
library(AER)
library(summarytools)
library(reshape2)
library(waffle)
library(hrbrthemes)
library(pals)
library(readxl)
library(ggthemes)
library(dplyr)
library(tidytext)
library(extrafont)
library(gtsummary)
library(ragg)
library(Cairo)
```

**Importing Data**
#```{r, echo=FALSE, results='hide'}
```{r}

extrafont::font_import()

Impact_COVID_Ethiopia <- read_dta("../Data/Impact of Covid 19 from Harar and Kersa HDSS.dta")

Ethiopia_Data <- as.data.frame(Impact_COVID_Ethiopia)
str(Ethiopia_Data, list.len=ncol(Ethiopia_Data)) #Get familiar with the structure of the data

#Turn off Scientific Notation
#options(scipen = 999)
options(width  = 300)
```

*Utilizing the Ethiopia Lockdown module data linked with additional sociodemographic variables from last HDSS cycle: head of household information (gender,age, occupation, education status), number of children under 5, and number of elderly (adults over 65). We have renamed our original dataset to "Impact of Covid 19 from Harar and Kersa HDSS". There are 880 observations and 238 total variables.*

**Subsetting Data to Variables of Interest**

```{r}
data <- Impact_COVID_Ethiopia %>% #specify dply::select because MASS also has a select that will give you an error
  dplyr::select(Residence, kebele_ID,
                HH_Age = head_curr_age, 
                HH_Sex = head_gender, 
                HH_Ethnicity = head_ethnicity, 
                HH_Religion = head_religion, 
                HH_Education_Level = head_educ_statu, 
                HH_Occupation = head_occupation, 
                HH_Family_Number = familynumber,
                HH_Children_Under_5 = number_underfive, 
                HH_Elderly = number_elder, 
                HH_Monthly_Income = HHincome,
                Covid_Response_HomeStay = advicehomestay,
                Covid_Response_Gathering = advicedfromgathering,
                Covid_Response_Lockdown = lockdown,
                Covid_Response_TravelRestrictions = restricttravel,
                Covid_Response_BusinessClosures = businesclosure,
                Covid_Response_IsolationCenters = establishisolation,
                Covid_Food_Insecurity = nofoodaftercovid, 
                Covid_Food_Barrier_Afford = notaffordtobuy,
                Covid_Food_Barrier_Lockdown = couldntgoout,
                Covid_Food_Barrier_Fear = afraiadtout,
                Covid_Food_Barrier_NoDelivery = nodelivery,
                Covid_Food_Barrier_NoFood = nofoodigrocery,
                HM_Job_Loss = jobless, 
                HM_Nonfarm_Business_Closure = nofarmbusin, 
                HM_Farm_Disruption = farmdisruption, 
                HM_Livestock_Disruption = livestockdisruption, 
                HM_Fishing_Disruption = fishingdisruption, 
                HM_Input_Inflation = farmpriceinflation, 
                HM_Output_Deflation = farmingpricedecrease, 
                HM_Food_Price_Increase = pricefoodinreased, 
                HM_Illness_Death = ilnessdeath,
                HM_Other_Hardship = otherproblem,
                PreCovid_Food_Insecurity = nofood,
                HH_source_water = source_water,
                HH_floor = floor,
                HH_roof = roof,
                HH_fuel_cooking = fuel_cooking,
                HH_wall_house = wall_house,
                HH_radio = radio,
                HH_motorcycle =  motorcycle,
                HH_bicycle = bicycle,
                HH_non_mobile = non_mobile,
                HH_mobile_phone = mobile_phone,
                HH_television = television,
                HH_toilet_faci = toilet_faci,
                HH_toilet_shared = share_toilet,
                HH_electricity = electricity,
                HH_car_vehicle = car_vehicle,
                HH_refrigerator = refrigerator,
                HH_bank = bank_account,
                HH_window = awindow,
                HH_sleeping_rooms = room_sleeeping,
                HH_table = atable,
                HH_chair = chair,
                HH_mitad = electric_mitad,
                HH_kerosene = kerosene,
                HH_lantern = Lantern,
                HH_lamp = pressure_lamp,
                HH_bed = bed,
                HH_land = land_agr,
                HH_mill = mill,
                HH_chickens = num_chicken,
                HH_sheep = num_sheep,
                HH_goats = num_goat,
                           
                Covid_HH_Response_Sell_Assets = saleasset,
                Covid_HH_Response_Generate_Income = genadditionalincome,
                Covid_HH_Response_FF_Help = familyfriendhelp,
                Covid_HH_Response_Borrow_Family = borrowfromfamily,
                Covid_HH_Response_Took_Loan = tookloan,
                Covid_HH_Response_Delay_Payment = delaypaymetday,
                Covid_HH_Response_Sold_Harvest = soldharvest,
                Covid_HH_Response_Reduce_Food_Consumption = reducefoodcons,
                Covid_HH_Response_Reduce_Consumption = reducenonfoodcons,
                Covid_HH_Response_Relied_Savings = reliedonsaving,
                Covid_HH_Response_NGO_Help = NGOhelp,
                Covid_HH_Response_Pay_Advance = advancedemployerpay,
                Covid_HH_Response_GOV_Help = govthelp,
                Covid_HH_Response_Other = other4
                )

sumtable(data) #Notice N in occupation and education status
str(data)
summary(data) #Any missing values (NA)? yes: education level and occupation (9)

dim(data)
#data <- na.omit(data) 
#dim(data)
```

**Recoding Variables**

```{r, results='hide'}
data$PreCOVID_Food_Insecurity <- NULL
data$PreCOVID_Food_Insecurity[data$PreCovid_Food_Insecurity == "CH00001"] <- 1
data$PreCOVID_Food_Insecurity[data$PreCovid_Food_Insecurity == "CH00002"] <- 0
data$PreCOVID_Food_Insecurity[data$PreCovid_Food_Insecurity == "CHOOOO2"] <- 0
data$`Pre-COVID Food Insecurity (Household)` <- factor(data$PreCOVID_Food_Insecurity,
                    levels = c(0,1),
                    labels = c("No", "Yes"))

tab1(data$`Pre-COVID Food Insecurity (Household)`, sort.group = "decreasing", cum.percent = TRUE)

data$PreCOVID_Food_Insecurity_V <- as.numeric(data$`Pre-COVID Food Insecurity (Household)`)
```

```{r, results='hide'}
# Hardship Variables

data$COVID_Food_Insecurity <- NULL
data$COVID_Food_Insecurity[data$Covid_Food_Insecurity == "CH00002"] <- 0
data$COVID_Food_Insecurity[data$Covid_Food_Insecurity == "CHOOOO2"] <- 0
data$COVID_Food_Insecurity[data$Covid_Food_Insecurity == "CH00001"] <- 1
data$COVID_Food_Insecurity[data$Covid_Food_Barrier_Afford == 1] <- 1
data$`COVID Food Insecurity (Household)` <- factor(data$COVID_Food_Insecurity,
                    levels = c(0,1),
                    labels = c("No", "Yes"))

tab1(data$COVID_Food_Insecurity, sort.group = "decreasing", cum.percent = TRUE)

data$COVID_Food_Insecurity_V <- data$COVID_Food_Insecurity

class(data$`COVID Food Insecurity (Household)`)
levels(data$`COVID Food Insecurity (Household)`)
summary(data$`COVID Food Insecurity (Household)`)
table(data$`COVID Food Insecurity (Household)`)
```

```{r, results='hide'}

data$Job_Loss <- NULL
data$Job_Loss[data$HM_Job_Loss == 1]  <- 1
data$Job_Loss[data$HM_Job_Loss == 0]  <- 0
data$`Job Loss (Household)` <- factor(data$Job_Loss,
                    levels = c(0,1),
                    labels = c("No", "Yes"))

tab1(data$`Job Loss (Household)`, sort.group = "decreasing", cum.percent = TRUE)

data$Job_Loss_V <- data$Job_Loss
```

```{r, results='hide'}
data$Nonfarm_Business_Closure <- NULL
data$Nonfarm_Business_Closure[data$HM_Nonfarm_Business_Closure == 1]  <- 1
data$Nonfarm_Business_Closure[data$HM_Nonfarm_Business_Closure == 0]  <- 0
data$`Nonfarm Business Closure (Household)` <- factor(data$Nonfarm_Business_Closure,
                    levels = c(0,1),
                    labels = c("No", "Yes"))

tab1(data$Nonfarm_Business_Closure, sort.group = "decreasing", cum.percent = TRUE)

data$Nonfarm_Business_Closure_V <- data$Nonfarm_Business_Closure
```

```{r, results='hide'}
data$Farm_Disruption <- NULL
data$Farm_Disruption[data$HM_Farm_Disruption == 1]  <- 1
data$Farm_Disruption[data$HM_Farm_Disruption == 0]  <- 0
data$`Farm Disruption (Household)` <- factor(data$Farm_Disruption,
                    levels = c(0,1),
                    labels = c("No", "Yes"))

tab1(data$Farm_Disruption, sort.group = "decreasing", cum.percent = TRUE)

data$Farm_Disruption_V <- data$Farm_Disruption
```

```{r, results='hide'}
data$Livestock_Disruption <- NULL
data$Livestock_Disruption[data$HM_Livestock_Disruption == 1]  <- 1
data$Livestock_Disruption[data$HM_Livestock_Disruption == 0]  <- 0
data$`Livestock Disruption (Household)` <- factor(data$Livestock_Disruption,
                    levels = c(0,1),
                    labels = c("No", "Yes"))

tab1(data$Livestock_Disruption, sort.group = "decreasing", cum.percent = TRUE)

data$Livestock_Disruption_V <- data$Livestock_Disruption
```

```{r, results='hide'}
data$Fishing_Disruption <- NULL
data$Fishing_Disruption[data$HM_Fishing_Disruption == 1]  <- 1
data$Fishing_Disruption[data$HM_Fishing_Disruption == 0]  <- 0
data$`Fishing Disruption (Household)` <- factor(data$Fishing_Disruption,
                    levels = c(0,1),
                    labels = c("No", "Yes"))

tab1(data$Fishing_Disruption, sort.group = "decreasing", cum.percent = TRUE)

data$Fishing_Disruption_V <- data$Fishing_Disruption
```

```{r, results='hide'}
data$Input_Inflation <- NULL
data$Input_Inflation[data$HM_Input_Inflation == 1]  <- 1
data$Input_Inflation[data$HM_Input_Inflation == 0]  <- 0
data$`Input Inflation (Household)` <- factor(data$Input_Inflation,
                    levels = c(0,1),
                    labels = c("No", "Yes"))

tab1(data$Input_Inflation, sort.group = "decreasing", cum.percent = TRUE)

data$Input_Inflation_V <- data$Input_Inflation
```

```{r, results='hide'}
data$Output_Deflation <- NULL
data$Output_Deflation[data$HM_Output_Deflation == 1]  <- 1
data$Output_Deflation[data$HM_Output_Deflation == 0]  <- 0
data$`Output Deflation (Household)` <- factor(data$Output_Deflation,
                    levels = c(0,1),
                    labels = c("No", "Yes"))

tab1(data$Output_Deflation, sort.group = "decreasing", cum.percent = TRUE)

data$Output_Deflation_V <- data$Output_Deflation
```

```{r, results='hide'}
data$Food_Price_Increase <- NULL
data$Food_Price_Increase[data$HM_Food_Price_Increase == 1]  <- 1
data$Food_Price_Increase[data$HM_Food_Price_Increase == 0]  <- 0
data$`Food Price Increase (Household)` <- factor(data$Food_Price_Increase,
                    levels = c(0,1),
                    labels = c("No", "Yes"))

tab1(data$`Food Price Increase (Household)`, sort.group = "decreasing", cum.percent = TRUE)

data$Food_Price_Increase_V <- data$Food_Price_Increase
```

```{r, results='hide'}
data$Illness_Death <- NULL
data$Illness_Death[data$HM_Illness_Death == 1]  <- 1
data$Illness_Death[data$HM_Illness_Death == 0]  <- 0
data$`Illness/Death (Household)` <- factor(data$Illness_Death,
                    levels = c(0,1),
                    labels = c("No", "Yes"))

tab1(data$`Illness/Death (Household)`, sort.group = "decreasing", cum.percent = TRUE)

data$Illness_Death_V <- data$Illness_Death
```

```{r, results='hide'}
data$Hardship_Other <- NULL
data$Hardship_Other[data$HM_Other_Hardship == 1]  <- 1
data$Hardship_Other[data$HM_Other_Hardship == 0]  <- 0
data$`Other Hardship (Household)` <- factor(data$Hardship_Other,
                    levels = c(0,1),
                    labels = c("No", "Yes"))

tab1(data$`Other Hardship (Household)`, sort.group = "decreasing", cum.percent = TRUE)
```

# Vulnerability Variables
```{r, results='hide'}
data$Elderly <- NULL
data$Elderly[data$HH_Elderly >= 1]  <- 1
data$Elderly[data$HH_Elderly == 0]  <- 0
data$`Adults Over Age 60 (Household)`<- factor(data$Elderly,
                    levels = c(0,1),
                    labels = c("No", "Yes"))

tab1(data$`Adults Over Age 60 (Household)`, sort.group = "decreasing", cum.percent = TRUE)

data$Elderly_V <- as.numeric(data$`Adults Over Age 60 (Household)`)
```

```{r, results='hide'}
data$Children_Under_5 <- NULL
data$Children_Under_5[data$HH_Children_Under_5 >= 1]  <- 1
data$Children_Under_5[data$HH_Children_Under_5 == 0]  <- 0
data$`Children Under Age 5 (Household)` <- factor(data$Children_Under_5,
                    levels = c(0,1),
                    labels = c("No", "Yes"))

tab1(data$`Children Under Age 5 (Household)`, sort.group = "decreasing", cum.percent = TRUE)

data$Children_Under_5_V <- as.numeric(data$`Children Under Age 5 (Household)`)
```

```{r, results='hide'}
data$Dependents <- NULL
data$Dependents[data$HH_Elderly == 0 & data$HH_Children_Under_5 == 0]  <- 1
data$Dependents[data$HH_Elderly >= 1]  <- 2
data$Dependents[data$HH_Children_Under_5 >= 1]  <- 3
data$Dependents[data$HH_Elderly == 1 & data$HH_Children_Under_5 == 1]  <- 4
data$`Dependents (Household)`<- factor(data$Dependents,
                    levels = c(1,2,3,4),
                    labels = c("None", "Older Adults", "Children", "Older Adults & Children"))

tab1(data$`Dependents (Household)`, sort.group = "decreasing", cum.percent = TRUE)

data$Dependents_V <- as.numeric(data$`Dependents (Household)`)
```

```{r, results='hide'}
data$Age <- NULL
data$Age[data$HH_Age > 10 & data$HH_Age <= 40 ] <- 1
data$Age[data$HH_Age > 40 & data$HH_Age <= 50 ] <- 2
data$Age[data$HH_Age > 50 & data$HH_Age <= 60 ] <- 3
data$Age[data$HH_Age > 60 ] <- 4
data$`Age (Household Head)` <- factor(data$Age,
                    levels = c(1,2,3,4),
                    labels = c("15-40", "41-50", "51-60", ">60"))

tab1(data$`Age (Household Head)`, sort.group = "decreasing", cum.percent = TRUE)

data$Age_1_V <- 0
data$Age_1_V[data$`Age (Household Head)`=="15-40"] <- 1

data$Age_2_V <- 0
data$Age_2_V[data$`Age (Household Head)`=="41-50"] <- 1

data$Age_3_V <- 0
data$Age_3_V[data$`Age (Household Head)`=="51-60"] <- 1

data$Age_4_V <- 0
data$Age_4_V[data$`Age (Household Head)`==">60"] <- 1

```

```{r, results='hide'}
data$Sex <- NULL
data$Sex[data$HH_Sex == "M"] <- 1
data$Sex[data$HH_Sex == "F"] <- 0
data$`Sex (Household Head)` <- factor(data$Sex,
                    levels = c(0,1),
                    labels = c("Female", "Male"))

tab1(data$`Sex (Household Head)`, sort.group = "decreasing", cum.percent = TRUE)

data$Sex_V <- as.numeric(data$`Sex (Household Head)`)
```

```{r, results='hide'}
data$Religion <- 3
data$Religion[data$HH_Religion == 2] <- 1
data$Religion[data$HH_Religion == 1] <- 2
data$`Religion (Household Head)` <- factor(data$Religion,
                    levels = c(1,2,3),
                    labels = c("Christian", "Muslim", "Other"))

tab1(data$`Religion (Household Head)`, sort.group = "decreasing", cum.percent = TRUE)
```

```{r, results='hide'}
data$Ethnicity <- 2
data$Ethnicity[data$HH_Ethnicity == 1] <- 2
data$Ethnicity[data$HH_Ethnicity == 2] <- 1

data$`Ethnicity (Household Head)` <- factor(data$Ethnicity,
                    levels = c(1,2),
                    labels = c("Amhara", "Other"))

data$Ethnicity <- factor(data$Ethnicity,
                    levels = c(1,2),
                    labels = c("Amhara", "Other"))

tab1(data$`Ethnicity (Household Head)`, sort.group = "decreasing", cum.percent = TRUE)

# data$Ethnicity_Oromo_V <- 0
# data$Ethnicity_Oromo_V[data$`Ethnicity (Household Head)`=="Oromo"] <- 1

data$Ethnicity_Other_V <- 0
data$Ethnicity_Other_V[data$`Ethnicity (Household Head)`=="Other"] <- 1
```

# Independent Variables
```{r, results='hide'}
data$Urban_Residence <- NULL
data$Urban_Residence[data$Residence == 1] <- 0
data$Urban_Residence[data$Residence == 2] <- 1
data$`Residence (Household)` <- factor(data$Urban_Residence,
                    levels = c(0,1),
                    labels = c("Urban", "Rural"))

tab1(data$`Residence (Household)`, sort.group = "decreasing", cum.percent = TRUE)

data$Residence_V <- as.numeric(data$`Residence (Household)`)
```

```{r, results='hide'}
data$Land <- NULL
data$Land[data$HH_land == 1] <- 1
data$Land[data$HH_land == 2] <- 0
data$`Agricultural Land Ownership (Household)` <- factor(data$Land,
                    levels = c(0,1),
                    labels = c("No", "Yes"))

tab1(data$`Agricultural Land Ownership (Household)`, sort.group = "decreasing", cum.percent = TRUE)

data$Land_V <- as.numeric(data$`Agricultural Land Ownership (Household)`)
```

```{r, results='hide'}
data$HDSS <- NULL
data$HDSS[data$kebele_ID == "H01"] <- 1
data$HDSS[data$kebele_ID == "H04"] <- 1
data$HDSS[data$kebele_ID == "H12"] <- 1
data$HDSS[data$kebele_ID == "H16"] <- 1
data$HDSS[data$kebele_ID == "K01"] <- 0
data$HDSS[data$kebele_ID == "K02"] <- 0
data$HDSS[data$kebele_ID == "K03"] <- 0
data$HDSS[data$kebele_ID == "K05"] <- 0
data$`Urbanicity (Household)` <- factor(data$HDSS,
                    levels = c(1,0),
                    labels = c("Urban (Harar)", "Rural (Kersa)"))

tab1(data$`Urbanicity (Household)`, sort.group = "decreasing", cum.percent = TRUE)

data$HDSS_V <- as.numeric(data$`Urbanicity (Household)`)

data$Kebele <- factor(data$kebele_ID)
```

```{r, results='hide'}
data$Education <- NULL
data$Education[data$HH_Education_Level == 4] <- 0
data$Education[data$HH_Education_Level == 1] <- 1
data$Education[data$HH_Education_Level == 2] <- 1
data$Education[data$HH_Education_Level == 3] <- 1
data$`Education (Household Head)` <- factor(data$Education,
                    levels = c(0, 1),
                    labels = c("No Education", "Some Education"))

tab1(data$`Education (Household Head)`, sort.group = "decreasing", cum.percent = TRUE)

data$Education_V <- NULL
data$Education_V[data$`Education (Household Head)`!="No Education"] <- 0
data$Education_V[data$`Education (Household Head)`=="No Education"] <- 1
tab1(data$Education_V)
```

```{r, results='hide'}
data$Occupation <- NULL
data$Occupation[data$HH_Occupation == 1]    <- 1
data$Occupation[data$HH_Occupation == 2]    <- 1
data$Occupation[data$HH_Occupation == 3]    <- 3
data$Occupation[data$HH_Occupation == 4]    <- 3
data$Occupation[data$HH_Occupation == 5]    <- 3
data$Occupation[data$HH_Occupation == 6]    <- 1
data$Occupation[data$HH_Occupation == 7]    <- 2
data$Occupation[data$HH_Occupation == 8]    <- 6
data$Occupation[data$HH_Occupation == 9]    <- 6
data$Occupation[data$HH_Occupation == 10]   <- 3
data$Occupation[data$HH_Occupation == 11]   <- 3
data$Occupation[data$HH_Occupation == 12]   <- 4
data$Occupation[data$HH_Occupation == 13]   <- 5
data$`Occupation (Household Head)` <- factor(data$Occupation,
                    levels = c(1,2,3,4,5,6),
                    labels = c("Farmer/Domestic", 
                               "Student",
                               "Professional",
                               "Daily Laborer",
                               "Other Work",
                               "Unemployed/Retired"))

tab1(data$`Occupation (Household Head)`, sort.group = "decreasing", cum.percent = TRUE)

data$Occupation_Professional_V <- NULL
data$Occupation_Professional_V[data$`Occupation (Household Head)`!="Professional"] <- 0
data$Occupation_Professional_V[data$`Occupation (Household Head)`=="Professional"] <- 1

data$Occupation_Student_V <- NULL
data$Occupation_Student_V[data$`Occupation (Household Head)`!="Student"] <- 0
data$Occupation_Student_V[data$`Occupation (Household Head)`=="Student"] <- 1

data$Occupation_Farmer_V <- NULL
data$Occupation_Farmer_V[data$`Occupation (Household Head)`!="Farmer"] <- 0
data$Occupation_Farmer_V[data$`Occupation (Household Head)`=="Farmer"] <- 1

data$Occupation_Sales_V <- NULL
data$Occupation_Sales_V[data$`Occupation (Household Head)`!="Sales"] <- 0
data$Occupation_Sales_V[data$`Occupation (Household Head)`=="Sales"] <- 1

data$Occupation_Housewife_V <- NULL
data$Occupation_Housewife_V[data$`Occupation (Household Head)`!="Housewife"] <- 0
data$Occupation_Housewife_V[data$`Occupation (Household Head)`=="Housewife"] <- 1

data$Occupation_DailyLaborer_V <- NULL
data$Occupation_DailyLaborer_V[data$`Occupation (Household Head)`!="Daily Laborer"] <- 0
data$Occupation_DailyLaborer_V[data$`Occupation (Household Head)`=="Daily Laborer"] <- 1

data$Occupation_OtherWork_V <- NULL
data$Occupation_OtherWork_V[data$`Occupation (Household Head)`!="Other Work"] <- 0
data$Occupation_OtherWork_V[data$`Occupation (Household Head)`=="Other Work"] <- 1

data$Occupation_Unemployed_V <- NULL
data$Occupation_Unemployed_V[data$`Occupation (Household Head)`!="Unemployed/Retired"] <- 0
data$Occupation_Unemployed_V[data$`Occupation (Household Head)`=="Unemployed/Retired"] <- 1
```

```{r, results='hide'}

summary(data$HH_Monthly_Income)

data$Income <- NULL
data$Income[data$HH_Monthly_Income >= 0 & data$HH_Monthly_Income < 1201 ] <- 5
data$Income[data$HH_Monthly_Income >= 1201 & data$HH_Monthly_Income < 2001 ] <- 4
data$Income[data$HH_Monthly_Income >= 2001 & data$HH_Monthly_Income < 3001 ] <- 3
data$Income[data$HH_Monthly_Income >= 3001 & data$HH_Monthly_Income < 4601 ] <- 2
data$Income[data$HH_Monthly_Income >= 4601 & data$HH_Monthly_Income < 100000 ] <- 1
data$`Income (Household)` <- factor(data$Income,
                    levels = c(5, 4, 3, 2, 1),
                    labels = c("0-1,200", "1,201-2,000", "2,001-3,000", "3,001-4,600", ">4,600"))

data$Income <- factor(data$Income,
                    levels = c(5, 4, 3, 2, 1),
                    labels = c("0-1,200", "1,201-2,000", "2,001-3,000", "3,001-4,600", ">4,600"))

tab1(data$`Income (Household)`, cum.percent = TRUE)

data$Income_1_V <- NULL
data$Income_1_V[data$`Income (Household)`!="4,600+"] <- 0
data$Income_1_V[data$`Income (Household)`=="4,600+"] <- 1

data$Income_2_V <- NULL
data$Income_2_V[data$`Income (Household)`!="3,001-4,600"] <- 0
data$Income_2_V[data$`Income (Household)`=="3,001-4,600"] <- 1

data$Income_3_V <- NULL
data$Income_3_V[data$`Income (Household)`!="2,001-3,000"] <- 0
data$Income_3_V[data$`Income (Household)`=="2,001-3,000"] <- 1

data$Income_4_V <- NULL
data$Income_4_V[data$`Income (Household)`!="1,201-2,000"] <- 0
data$Income_4_V[data$`Income (Household)`=="1,201-2,000"] <- 1

table(data$`Urbanicity (Household)`, data$`Income (Household)`)

```

```{r}
class(data$`Income (Household)`)
```

```{r, results='hide'}
data$HouseholdSize <- NULL
data$HouseholdSize[data$HH_Family_Number >= 0 & data$HH_Family_Number <= 4 ] <- 1
data$HouseholdSize[data$HH_Family_Number >= 5 & data$HH_Family_Number <= 6 ] <- 2
data$HouseholdSize[data$HH_Family_Number >= 7 ] <- 3
data$`Household Size` <- factor(data$HouseholdSize,
                    levels = c(1,2,3),
                    labels = c("1-4", "5-6", "7+"))

tab1(data$`Household Size`, sort.group = "decreasing", cum.percent = TRUE)

data$HouseholdSize_1_V <- NULL
data$HouseholdSize_1_V[data$`Household Size`!="1-4"] <- 0
data$HouseholdSize_1_V[data$`Household Size`=="1-4"] <- 1

data$HouseholdSize_2_V <- NULL
data$HouseholdSize_2_V[data$`Household Size`!="5-6"] <- 0
data$HouseholdSize_2_V[data$`Household Size`=="5-6"] <- 1

data$HouseholdSize_3_V <- NULL
data$HouseholdSize_3_V[data$`Household Size`!="7+"] <- 0
data$HouseholdSize_3_V[data$`Household Size`=="7+"] <- 1

```

```{r, results='hide'}
data$HouseholdSize <- NULL
data$HouseholdSize[data$HH_Family_Number >= 0 & data$HH_Family_Number <= 2 ] <- 1
data$HouseholdSize[data$HH_Family_Number >= 3 & data$HH_Family_Number <= 4 ] <- 2
data$HouseholdSize[data$HH_Family_Number >= 5 & data$HH_Family_Number <= 6 ] <- 3
data$HouseholdSize[data$HH_Family_Number >= 7 & data$HH_Family_Number <= 8 ] <- 4
data$HouseholdSize[data$HH_Family_Number >= 9 ] <- 5
data$`Household Size` <- factor(data$HouseholdSize,
                    levels = c(1,2,3,4,5),
                    labels = c("1-2", "3-4", "5-6", "7-8", "9+"))

tab1(data$`Household Size`, cum.percent = TRUE)

data$HouseholdSize_2_V <- NULL
data$HouseholdSize_2_V[data$`Household Size`!="3-4"] <- 0
data$HouseholdSize_2_V[data$`Household Size`=="3-4"] <- 1

data$HouseholdSize_3_V <- NULL
data$HouseholdSize_3_V[data$`Household Size`!="5-6"] <- 0
data$HouseholdSize_3_V[data$`Household Size`=="5-6"] <- 1

data$HouseholdSize_4_V <- NULL
data$HouseholdSize_4_V[data$`Household Size`!="7-8"] <- 0
data$HouseholdSize_4_V[data$`Household Size`=="7-8"] <- 1

data$HouseholdSize_5_V <- NULL
data$HouseholdSize_5_V[data$`Household Size`!="9+"] <- 0
data$HouseholdSize_5_V[data$`Household Size`=="9+"] <- 1
```

##################################################################
##################################################################

***Wealth Index DATA PREPARATION: Selective Recodes***		

**Create Drinking Water Source Recode**

```{r, echo=FALSE}
data$drinking_water_piped <- 0
data$drinking_water_piped[data$HH_source_water==1] <- 1

data$drinking_water_protected_well <- 0
data$drinking_water_protected_well[data$HH_source_water==2] <- 1

data$drinking_water_unprotected_well <- 0
data$drinking_water_unprotected_well[data$HH_source_water==3] <- 1

data$drinking_water_protected_spring <- 0
data$drinking_water_protected_spring[data$HH_source_water==4] <- 1

data$drinking_water_unprotected_spring <- 0
data$drinking_water_unprotected_spring[data$HH_source_water==5] <- 1

data$drinking_water_other <- 0
data$drinking_water_other[data$HH_source_water==3] <- 1
data$drinking_water_other[data$HH_source_water==4] <- 1
data$drinking_water_other[data$HH_source_water==5] <- 1
data$drinking_water_other[data$HH_source_water==7] <- 1

data$drinking_water <- 0
data$drinking_water[data$drinking_water_piped==1] <- 1
data$drinking_water[data$drinking_water_protected_well==1] <- 1
data$drinking_water[data$drinking_water_protected_spring==1] <- 1
```

**Create Toilet Recode**

```{r, echo=FALSE}
data$toilet_ventilated_latrine <- 0
data$toilet_ventilated_latrine[data$HH_toilet_faci==1] <- 1

data$toilet_pit_latrine <- 0
data$toilet_pit_latrine[data$HH_toilet_faci==2] <- 1

data$toilet_none <- 0
data$toilet_none[data$HH_toilet_faci==3] <- 1

data$toilet_other <- 0
data$toilet_other[data$HH_toilet_faci==4] <- 1

data$toilet <- 0
data$toilet[data$toilet_ventilated_latrine==1] <- 1
data$toilet[data$toilet_pit_latrine==1] <- 1
data$toilet[data$HH_toilet_shared==1] <- 0
```

**Create Consumer Products Recode**

```{r, echo=FALSE}
data$electricity <- 0
data$electricity[data$HH_electricity==1] <- 1

data$radio <- 0
data$radio[data$HH_radio==1] <- 1

data$tv <- 0
data$tv[data$HH_television==1] <- 1

data$refrigerator <- 0
data$refrigerator[data$HH_refrigerator==1] <- 1

data$bike <- 0
data$bike[data$HH_bicycle==1] <- 1

data$motorcycle <- 0
data$motorcycle[data$HH_motorcycle==1] <- 1

data$car <- 0
data$car[data$HH_car_vehicle==1] <- 1

data$phone <- 0
data$phone[data$HH_non_mobile==1] <- 1

data$mobile_phone <- 0
data$mobile_phone[data$HH_mobile_phone==1] <- 1

data$bank <- 0
data$bank[data$HH_bank==1] <- 1

data$window <- 0
data$window[data$HH_window==1] <- 1

data$sleeping_rooms <- 0
data$sleeping_rooms[data$HH_sleeping_rooms==1] <- 1

data$table <- 0
data$table[data$HH_table==1] <- 1

data$chair <- 0
data$chair[data$HH_chair==1] <- 1

data$mitad <- 0
data$mitad[data$HH_mitad==1] <- 1

data$kerosene <- 0
data$kerosene[data$HH_kerosene==1] <- 1

data$lantern <- 0
data$lantern[data$HH_lantern==1] <- 1

data$bed <- 0
data$bed[data$HH_bed==1] <- 1

data$land <- 0
data$land[data$HH_land==1] <- 1

data$lamp <- 0
data$lamp[data$HH_lamp==1] <- 1

data$mill <- 0
data$mill[data$HH_mill==1] <- 1

data$chickens <- 0
data$chickens[data$HH_chickens>0] <- 1

data$goats <- 0
data$goats[data$HH_sheep>0] <- 1

data$sheep <- 0
data$sheep[data$HH_goats>0] <- 1
```

**Create Floor Materials Recode**

```{r, echo=FALSE}
data$floor_earth <- 0
data$floor_earth[data$HH_floor==1] <- 1

data$floor_wood_bamboo <- 0
data$floor_wood_bamboo[data$HH_floor==2] <- 1

data$floor_finished_cement <- 0
data$floor_finished_cement[data$HH_floor==3] <- 1

data$floor_other <- 0
data$floor_other[data$HH_floor==4] <- 1

data$floor <- 0
data$floor[data$floor_finished_cement==1] <- 1
data$floor[data$floor_wood_bamboo==1] <- 1
```

**Create Wall Materials Recode**

```{r, echo=FALSE}
data$wall_wood_bamboo <- 0
data$wall_wood_bamboo[data$HH_wall_house==1] <- 1

data$wall_trunks_earth <- 0
data$wall_trunks_earth[data$HH_wall_house==3] <- 1

data$wall_bricks_cement <- 0
data$wall_bricks_cement[data$HH_wall_house==4] <- 1

data$wall_other <- 0
data$wall_other[data$HH_wall_house==5] <- 1

data$wall <- 0
data$wall[data$wall_bricks_cement==1] <- 1
data$wall[data$wwall_wood_bamboo==1] <- 1
```

**Create Roof Materials Recode**

```{r, echo=FALSE}
data$roof_thatch <- 0
data$roof_thatch[data$HH_roof==1] <- 1

data$roof_plastic <- 0
data$roof_plastic[data$HH_roof==2] <- 1

data$roof_metal <- 0
data$roof_metal[data$HH_roof==3] <- 1

data$roof_other <- 0
data$roof_other[data$HH_roof==4] <- 1

data$roof <- 0
data$roof[data$HH_roof==3] <- 1
```

**Create Cooking Fuel Recode**

```{r, echo=FALSE}
data$cooking_fuel_electricity <- 0
data$cooking_fuel_electricity[data$HH_fuel_cooking==1] <- 1

data$cooking_fuel_kerosene <- 0
data$cooking_fuel_kerosene[data$HH_fuel_cooking==2] <- 1

data$cooking_fuel_charcoal <- 0
data$cooking_fuel_charcoal[data$HH_fuel_cooking==3] <- 1

data$cooking_fuel_wood <- 0
data$cooking_fuel_wood[data$HH_fuel_cooking==4] <- 1

data$cooking_fuel_straw <- 0
data$cooking_fuel_straw[data$HH_fuel_cooking==5] <- 1

data$cooking_fuel_other <- 0
data$cooking_fuel_other[data$HH_fuel_cooking==7] <- 1

data$cooking_fuel <- 0
data$cooking_fuel[data$cooking_fuel_electricity==1] <- 1
data$cooking_fuel[data$cooking_fuel_kerosene==1] <- 1
```

```{r}
#table(data$drinking_water_piped, data$`Residence (Household)`)
#table(data$drinking_water_protected_well, data$`Residence (Household)`)
#table(data$drinking_water_unprotected_well, data$`Residence (Household)`)
#table(data$drinking_water_protected_spring, data$`Residence (Household)`)
#table(data$drinking_water_unprotected_spring, data$`Residence (Household)`)
#table(data$drinking_water_other, data$`Residence (Household)`)
table(data$drinking_water, data$`Residence (Household)`,  useNA = "always")

#table(data$toilet_ventilated_latrine, data$`Residence (Household)`)
#table(data$toilet_pit_latrine, data$`Residence (Household)`)
#table(data$toilet_none, data$`Residence (Household)`)
table(data$toilet, data$`Residence (Household)`,          useNA = "always")

table(data$electricity, data$`Residence (Household)`,     useNA = "always")
table(data$radio, data$`Residence (Household)`,           useNA = "always")
table(data$tv, data$`Residence (Household)`,              useNA = "always")
table(data$refrigerator, data$`Residence (Household)`,    useNA = "always")

table(data$bike, data$`Residence (Household)`,            useNA = "always")
table(data$motorcycle, data$`Residence (Household)`,      useNA = "always")
#table(data$car, data$`Residence (Household)`)

table(data$phone, data$`Residence (Household)`,           useNA = "always")
table(data$mobile_phone, data$`Residence (Household)`,    useNA = "always")

table(data$bank, data$`Residence (Household)`,            useNA = "always")
table(data$window, data$`Residence (Household)`,          useNA = "always")
table(data$sleeping_rooms, data$`Residence (Household)`,  useNA = "always")
table(data$table, data$`Residence (Household)`,           useNA = "always")
table(data$chair, data$`Residence (Household)`,           useNA = "always")
table(data$mitad, data$`Residence (Household)`,           useNA = "always")
table(data$kerosene, data$`Residence (Household)`,        useNA = "always")
table(data$lantern, data$`Residence (Household)`,         useNA = "always")
table(data$bed, data$`Residence (Household)`,             useNA = "always")
table(data$land, data$`Residence (Household)`,            useNA = "always")
table(data$lamp, data$`Residence (Household)`,            useNA = "always")
table(data$mill, data$`Residence (Household)`,            useNA = "always")
table(data$chickens, data$`Residence (Household)`,        useNA = "always")
table(data$goats, data$`Residence (Household)`,           useNA = "always")
table(data$sheep, data$`Residence (Household)`,           useNA = "always")

table(data$floor, data$`Residence (Household)`,           useNA = "always")
#table(data$floor_wood_bamboo, data$`Residence (Household)`)
#table(data$floor_finished_cement, data$`Residence (Household)`)
#table(data$floor_other, data$`Residence (Household)`)

table(data$wall, data$`Residence (Household)`,            useNA = "always")
#table(data$wall_trunks_earth, data$`Residence (Household)`)
#table(data$wall_bricks_cement, data$`Residence (Household)`)
#table(data$wall_other, data$`Residence (Household)`)

#table(data$roof_thatch, data$`Residence (Household)`)
table(data$roof, data$`Residence (Household)`,             useNA = "always")
#table(data$roof_metal, data$`Residence (Household)`)
#table(data$roof_other, data$`Residence (Household)`)

table(data$cooking_fuel, data$`Residence (Household)`,     useNA = "always")
#table(data$cooking_fuel_kerosene, data$`Residence (Household)`)
#table(data$cooking_fuel_charcoal, data$`Residence (Household)`)
#table(data$cooking_fuel_wood, data$`Residence (Household)`)
#table(data$cooking_fuel_straw, data$`Residence (Household)`)
#table(data$cooking_fuel_other, data$`Residence (Household)`)
```

**Check Data diminsions**
```{r, echo=FALSE}
dim(data)
head(data[1,163])
head(data[1,198])
```

**Check Data diminsions**

```{r, echo=FALSE}

data <- data %>% #specify dply::select because MASS also has a select that will give you an error
  dplyr::relocate(c(
                    "drinking_water",
                    "toilet",
                    "floor",
                    "wall",
                    "roof",
                    "cooking_fuel",
                    "electricity",
                    "radio",
                    "tv",
                    "refrigerator",
                    "bike",
                    "motorcycle",
                    "car",
                    "phone",
                    "mobile_phone",
                    "bank",
                    "window",
                    "sleeping_rooms",
                    "table",
                    "chair",
                    "mitad",
                    "kerosene",
                    "lantern",
                    "bed",
                    "land",
                    "lamp",
                    "mill",
                    "chickens",
                    "goats",
                    "sheep"
                    ), .after=last_col())
head(data[1,163])

urban.data <- data [ which(data$`Residence (Household)`=="Urban"),]
dim(urban.data)

urban.data <- urban.data %>% #specify dply::select because MASS also has a select that will give you an error
  dplyr::relocate(c(#"drinking_water",
                    "toilet",
                    "floor",
                    "wall",
                    "roof",
                    "cooking_fuel",
                    #"electricity",
                    "radio",
                    "tv",
                    "refrigerator",
                    "bike",
                    #"motorcycle",
                    #"car",
                    "phone",
                    "mobile_phone",
                    "bank",
                    "window",
                    "sleeping_rooms",
                    "table",
                    "chair",
                    "mitad",
                    "kerosene",
                    "lantern",
                    "bed",
                    "land",
                    #"lamp",
                    #"mill"
                    #"chickens",
                    #"goats",
                    #"sheep"
                    ), .after=last_col())
head(urban.data[1,190])
head(urban.data[1,216])

rural.data <- data [ which(data$`Residence (Household)`=="Rural"),]
dim(rural.data)

rural.data <- rural.data %>% #specify dply::select because MASS also has a select that will give you an error
  dplyr::relocate(c("drinking_water",
                    "toilet",
                    #"floor",
                    #"wall",
                    #"roof",
                    #"cooking_fuel",
                    "electricity",
                    "radio",
                    #"tv",
                    #"refrigerator",
                    "bike",
                    #"motorcycle",
                    #"car",
                    #"phone",
                    "mobile_phone",
                    #"bank",
                    "window",
                    #"sleeping_rooms",
                    #"table",
                    #"chair",
                    #"mitad",
                    "kerosene",
                    "lantern",
                    #"bed",
                    #"land",
                    "lamp",
                    #"mill"
                    #"chickens",
                    #"goats",
                    #"sheep"
), .after=last_col())

head(rural.data[198])
head(rural.data[216])
```

```{r}
# forest plot

dim(data)
data$"id" <- seq.int(nrow(data))

cairo_pdf("../Figures/Wealth Index/Wealth_Index_Assets_Distribution.pdf", width = 8, height = 10)

data %>%
    dplyr::select(c(
                    "id",
                    `Drinking Water: Improved` =                 "drinking_water",
                    `Toilet: Improved` =                         "toilet",
                    `Electricity` =                             "electricity",
                    `Radio` =                                   "radio",
                    `TV` =                                      "tv",
                    `Refrigerator` =                            "refrigerator",
                    `Bike` =                                    "bike",
                    `Motorcycle` =                              "motorcycle",
                    #`Car` =                                     "car",
                    `Phone` =                                   "phone",
                    `Mobile Phone` =                            "mobile_phone",
                    `Bank` =                                    "bank",
                    `Window` =                                  "window",
                    `Designated Sleeping Rooms` =               "sleeping_rooms",
                    `Table` =                                   "table",
                    `Chair` =                                   "chair",
                    `Mitad` =                                   "mitad",
                    `Kerosene` =                                "kerosene",
                    `Lantern` =                                  "lantern",
                    `Bed` =                                     "bed",
                    `Owns Land` =                               "land",
                    `Floor: Improved` =                         "floor",
                    `Wall: Improved` =                          "wall",
                    `Roof: Improved` =                          "roof",
                    `Cooking Fuel: Improved` =                  "cooking_fuel"
                    )) %>%
  rename(id="id") %>%
  melt(id='id') %>%
  group_by(variable) %>%
  count(value) %>%
  filter(value==1) %>%
  rowwise() %>%

  mutate(
    PROP = round(n/nrow(data)*100, 1),
    L.CI = round(prop.test(n, nrow(data), conf.level=0.95)$conf.int[1]*100, 1),
    U.CI = round(prop.test(n, nrow(data), conf.level=0.95)$conf.int[2]*100, 1),
  ) %>%
  mutate(LABEL=paste(
    format(round(PROP, digits=1), nsmall = 1), " (",
    format(round(L.CI, digits=1), nsmall = 1), ", ",
    format(round(U.CI, digits=1), nsmall = 1), ")", sep =""),
    variable = gsub("_"," ",variable)) %>%
  #mutate(variable = ifelse(variable=='Illness Death','Illness or Death',variable)) %>%
#quartz() %>%
  ggplot(aes(y=reorder(variable,PROP), x=PROP))+
  theme_ipsum_rc() +
  labs(y="")+
  geom_pointrange(
    size=.33,
    aes(xmin=L.CI, xmax=U.CI)) +
  geom_text(
    family="Roboto Condensed",
    aes(y=variable,label=LABEL,x = 135),
    hjust = 1,size = 3.1,show.legend = FALSE,parse = F) +

  theme(
    legend.position = "none",
    legend.title = element_blank(),
    title= element_blank(),
    axis.text = element_text(size=9, family="Roboto Condensed"),
    axis.title.y = element_text(face="bold",size=10.5,family="Roboto Condensed"),
    axis.title.x = element_blank(),
    plot.margin = unit(c(1,6.2,1,1), "lines")
  ) +
  scale_x_continuous(labels = function(x) paste0(x, "%"),expand = c(0, 0))+
  #scale_color_manual(values= rev(viridis(10))) +
  coord_cartesian(xlim=c(0,100))

dev.off()

```

```{r}

dat.1 <- data %>%
    dplyr::select(c(
                    "id",
                    `Piped` =                   "drinking_water_piped",
                    `Protected Well` =          "drinking_water_protected_well",
                    #`Unprotected Well` =        "drinking_water_unprotected_well",
                    #`Protected Spring` =        "drinking_water_protected_spring",
                    #`Unprotected Spring` =      "drinking_water_unprotected_spring",
                    `Other` =                   "drinking_water_other"
                    )) %>%
  rename(id="id") %>%
  melt(id='id') %>%
  group_by(variable) %>%
  count(value) %>%
  filter(value==1) %>%
  rowwise() %>%

  mutate(
    PROP = round(n/nrow(data)*100, 1),
    L.CI = round(prop.test(n, nrow(data), conf.level=0.95)$conf.int[1]*100, 1),
    U.CI = round(prop.test(n, nrow(data), conf.level=0.95)$conf.int[2]*100, 1),
  ) %>%
  mutate(LABEL=paste(
    format(round(PROP, digits=1), nsmall = 1), " (",
    format(round(L.CI, digits=1), nsmall = 1), ", ",
    format(round(U.CI, digits=1), nsmall = 1), ")", sep =""),
    variable = gsub("_"," ",variable))

dat.1$Category <- "Water Source"
dat.1

dat.2 <- data %>%
    dplyr::select(c(
                    "id",
                    `Ventilated Latrine` =              "toilet_ventilated_latrine",
                    `Pit Latrine` =                     "toilet_pit_latrine",
                    `None` =                            "toilet_none",
                    #`Other` =                           "toilet_other"
                    )) %>%
  rename(id="id") %>%
  melt(id='id') %>%
  group_by(variable) %>%
  count(value) %>%
  filter(value==1) %>%
  rowwise() %>%

  mutate(
    PROP = round(n/nrow(data)*100, 1),
    L.CI = round(prop.test(n, nrow(data), conf.level=0.95)$conf.int[1]*100, 1),
    U.CI = round(prop.test(n, nrow(data), conf.level=0.95)$conf.int[2]*100, 1),
  ) %>%
  mutate(LABEL=paste(
    format(round(PROP, digits=1), nsmall = 1), " (",
    format(round(L.CI, digits=1), nsmall = 1), ", ",
    format(round(U.CI, digits=1), nsmall = 1), ")", sep =""),
    variable = gsub("_"," ",variable))

dat.2$Category <- "Toilet Facility"
dat.2

dat.3 <- data %>%
    dplyr::select(c(
                    "id",
                    `Electricity` =                             "electricity",
                    `Radio` =                                   "radio",
                    `TV` =                                      "tv",
                    `Refrigerator` =                            "refrigerator",
                    `Bike` =                                    "bike",
                    #`Motorcycle` =                              "motorcycle",
                    #`Car` =                                     "car",
                    `Phone` =                                   "phone",
                    `Mobile Phone` =                            "mobile_phone",
                    `Bank` =                                    "bank",
                    `Window` =                                  "window",
                    `Sleeping Rooms` =                          "sleeping_rooms",
                    `Table` =                                   "table",
                    `Chair` =                                   "chair",
                    `Mitad` =                                   "mitad",
                    `Kerosene` =                                "kerosene",
                    `Lantern` =                                  "lantern",
                    `Bed` =                                     "bed",
                    `Owns Land` =                               "land")) %>%
  rename(id="id") %>%
  melt(id='id') %>%
  group_by(variable) %>%
  count(value) %>%
  filter(value==1) %>%
  rowwise() %>%

  mutate(
    PROP = round(n/nrow(data)*100, 1),
    L.CI = round(prop.test(n, nrow(data), conf.level=0.95)$conf.int[1]*100, 1),
    U.CI = round(prop.test(n, nrow(data), conf.level=0.95)$conf.int[2]*100, 1),
  ) %>%
  mutate(LABEL=paste(
    format(round(PROP, digits=1), nsmall = 1), " (",
    format(round(L.CI, digits=1), nsmall = 1), ", ",
    format(round(U.CI, digits=1), nsmall = 1), ")", sep =""),
    variable = gsub("_"," ",variable))

dat.3$Category <- "Assets"
dat.3

dat.4 <- data %>%
    dplyr::select(c(
                    "id",
                    `Earth` =                            "floor_earth",
                    #`Wood or Bamboo` =                   "floor_wood_bamboo",
                    `Cement` =                           "floor_finished_cement",
                    #`Other` =                            "floor_other",
                    )) %>%
  rename(id="id") %>%
  melt(id='id') %>%
  group_by(variable) %>%
  count(value) %>%
  filter(value==1) %>%
  rowwise() %>%

  mutate(
    PROP = round(n/nrow(data)*100, 1),
    L.CI = round(prop.test(n, nrow(data), conf.level=0.95)$conf.int[1]*100, 1),
    U.CI = round(prop.test(n, nrow(data), conf.level=0.95)$conf.int[2]*100, 1),
  ) %>%
  mutate(LABEL=paste(
    format(round(PROP, digits=1), nsmall = 1), " (",
    format(round(L.CI, digits=1), nsmall = 1), ", ",
    format(round(U.CI, digits=1), nsmall = 1), ")", sep =""),
    variable = gsub("_"," ",variable))

dat.4$Category <- "Floor Material"
dat.4

dat.5 <- data %>%
    dplyr::select(c(
                    "id",
                    `Wood or Bamboo` =                    "wall_wood_bamboo",
                    `Earth` =                             "wall_trunks_earth",
                    `Bricks or Cement` =                  "wall_bricks_cement",
                    #`Other` =                             "wall_other"
                    )) %>%
  rename(id="id") %>%
  melt(id='id') %>%
  group_by(variable) %>%
  count(value) %>%
  filter(value==1) %>%
  rowwise() %>%

  mutate(
    PROP = round(n/nrow(data)*100, 1),
    L.CI = round(prop.test(n, nrow(data), conf.level=0.95)$conf.int[1]*100, 1),
    U.CI = round(prop.test(n, nrow(data), conf.level=0.95)$conf.int[2]*100, 1),
  ) %>%
  mutate(LABEL=paste(
    format(round(PROP, digits=1), nsmall = 1), " (",
    format(round(L.CI, digits=1), nsmall = 1), ", ",
    format(round(U.CI, digits=1), nsmall = 1), ")", sep =""),
    variable = gsub("_"," ",variable))

dat.5$Category <- "Wall Material"
dat.5

dat.6 <- data %>%
    dplyr::select(c(
                    "id",
                    #`Thatch` =                            "roof_thatch",
                    `Plastic` =                           "roof_plastic",
                    `Metal` =                             "roof_metal",
                    `Other` =                             "roof_other")) %>%
  rename(id="id") %>%
  melt(id='id') %>%
  group_by(variable) %>%
  count(value) %>%
  filter(value==1) %>%
  rowwise() %>%

  mutate(
    PROP = round(n/nrow(data)*100, 1),
    L.CI = round(prop.test(n, nrow(data), conf.level=0.95)$conf.int[1]*100, 1),
    U.CI = round(prop.test(n, nrow(data), conf.level=0.95)$conf.int[2]*100, 1),
  ) %>%
  mutate(LABEL=paste(
    format(round(PROP, digits=1), nsmall = 1), " (",
    format(round(L.CI, digits=1), nsmall = 1), ", ",
    format(round(U.CI, digits=1), nsmall = 1), ")", sep =""),
    variable = gsub("_"," ",variable))

dat.6$Category <- "Roof Material"
dat.6

dat.7 <- data %>%
    dplyr::select(c(
                    "id",
                    `Electricity` =               "cooking_fuel_electricity",
                    `Kersosene` =                 "cooking_fuel_kerosene",
                    `Charcoal` =                  "cooking_fuel_charcoal",
                    `Wood` =                      "cooking_fuel_wood",
                    `Straw` =                     "cooking_fuel_straw",
                    #`Other` =                     "cooking_fuel_other"
                    )) %>%
  rename(id="id") %>%
  melt(id='id') %>%
  group_by(variable) %>%
  count(value) %>%
  filter(value==1) %>%
  rowwise() %>%

  mutate(
    PROP = round(n/nrow(data)*100, 1),
    L.CI = round(prop.test(n, nrow(data), conf.level=0.95)$conf.int[1]*100, 1),
    U.CI = round(prop.test(n, nrow(data), conf.level=0.95)$conf.int[2]*100, 1),
  ) %>%
  mutate(LABEL=paste(
    format(round(PROP, digits=1), nsmall = 1), " (",
    format(round(L.CI, digits=1), nsmall = 1), ", ",
    format(round(U.CI, digits=1), nsmall = 1), ")", sep =""),
    variable = gsub("_"," ",variable))

dat.7$Category <- "Cooking Fuel"
dat.7

dat <- rbind(dat.1, dat.2, dat.3, dat.4, dat.5, dat.6, dat.7)
dat

```

```{r}
cairo_pdf("../Figures/Wealth Index/Wealth_Index_Assets_Distribution_By_Category.pdf", 
      width  = 3.35, 
      height = 4.75,
      fallback_resolution = 300,
      family = "serif"
      )
dat %>%
    group_by(Category) %>%
    top_n(15) %>%
    ungroup %>%
    mutate(Category = as.factor(Category),
           variable = reorder_within(variable, PROP, Category)) %>%
 
   ggplot(aes(variable, PROP)) +
   theme_bw() +
  geom_point()+
   #geom_pointrange(size=.33, aes(variable, PROP)) +
   
   facet_grid(Category~., scales = "free", space = "free", switch = "y", shrink = FALSE)+
   
   scale_x_reordered() +
  
   geom_text(family="Times",
    aes(y=130,label=LABEL,x = variable),
    hjust = 1,size = 3.1,show.legend = FALSE,parse = F) +
  
    theme(
     legend.position = "none",
      legend.title = element_blank(),
     title= element_blank(),
     axis.text = element_text(size=9, family="Times"),
     axis.title.y = element_text(face="bold",size=10.5,family="Times"),
      axis.title.x = element_blank(),
      plot.margin = unit(c(.5,.5,.25,.5), "lines")) +
    scale_y_continuous(breaks=seq(0,100,10))+
    #scale_y_continuous(labels = function(x) paste0(x, "%"),expand = c(0, 0)) +
    coord_cartesian(clip = "off", ylim=c(0,100)) +
    #annotate("rect", xmin = 0, xmax = 10, ymin = 0, ymax = 100,  alpha = .5) +
    coord_flip() +
    xlab("") +
    ylab("")

dev.off()

```
  
```{r}
# forest plot

dim(urban.data)
urban.data$"id" <- seq.int(nrow(urban.data))

dat.1 <- urban.data %>% 
  dplyr::select(c(
                    "id",
                    #`Drinking Water: Improved` =                "drinking_water",
                    `Toilet: Improved` =                        "toilet",
                    `Floor: Improved` =                         "floor",
                    `Wall: Improved` =                          "wall",
                    `Roof: Improved` =                          "roof",
                    `Cooking Fuel: Improved` =                  "cooking_fuel",
                    `Electricity` =                             "electricity",
                    `Radio` =                                   "radio",
                    `TV` =                                      "tv",
                    `Refrigerator` =                            "refrigerator",
                    `Bike` =                                    "bike",
                    `Motorcycle` =                              "motorcycle",
                    #`Car` =                                     "car",
                    `Phone` =                                   "phone",
                    `Mobile Phone` =                            "mobile_phone",
                    `Bank` =                                    "bank",
                    `Window` =                                  "window",
                    `Designated Sleeping Rooms` =               "sleeping_rooms",
                    `Table` =                                   "table",
                    `Chair` =                                   "chair",
                    `Mitad` =                                   "mitad",
                    `Kerosene` =                                "kerosene",
                    `Lantern` =                                  "lantern",
                    `Bed` =                                     "bed",
                    `Land` =                                    "land",
                    #`Lamp` =                                    "lamp"
                    #`Mill` =                                    "mill"
                    #`Chickens` =                                "chickens",
                    #`Goats` =                                   "goats",
                    #`Sheep` =                                   "sheep"
                    )) %>%
  rename(id="id") 

dat.1$COUNT <- rowSums(dat.1[c(2:ncol(dat.1))])

cairo_pdf("../Figures/Wealth Index/Urban_Wealth_Index_Assets_Distribution.pdf", 
      width  = 6.5, 
      height = 4.75,
      fallback_resolution = 300,
      family = "serif"
      )
urban.data %>%
  dplyr::select(c(
                    "id",
                    #`Drinking Water: Improved` =                "drinking_water",
                    `Toilet: Improved` =                        "toilet",
                    `Floor: Improved` =                         "floor",
                    `Wall: Improved` =                          "wall",
                    `Roof: Improved` =                          "roof",
                    `Cooking Fuel: Improved` =                  "cooking_fuel",
                    `Electricity` =                             "electricity",
                    `Radio` =                                   "radio",
                    `TV` =                                      "tv",
                    `Refrigerator` =                            "refrigerator",
                    `Bike` =                                    "bike",
                    `Motorcycle` =                              "motorcycle",
                    #`Car` =                                     "car",
                    `Phone` =                                   "phone",
                    `Mobile Phone` =                            "mobile_phone",
                    `Bank` =                                    "bank",
                    `Window` =                                  "window",
                    `Designated Sleeping Rooms` =               "sleeping_rooms",
                    `Table` =                                   "table",
                    `Chair` =                                   "chair",
                    `Mitad` =                                   "mitad",
                    `Kerosene` =                                "kerosene",
                    `Lantern` =                                  "lantern",
                    `Bed` =                                     "bed",
                    `Land` =                                    "land",
                    #`Lamp` =                                    "lamp"
                    #`Mill` =                                    "mill"
                    #`Chickens` =                                "chickens",
                    #`Goats` =                                   "goats",
                    #`Sheep` =                                   "sheep"
                    )) %>%
  rename(id="id") %>%
  melt(id='id') %>%
  group_by(variable) %>%
  count(value) %>%
  filter(value==1) %>%
  rowwise() %>%

  mutate(
    PROP = round(n/nrow(urban.data)*100, 1),
    L.CI = round(prop.test(n, nrow(urban.data), conf.level=0.95)$conf.int[1]*100, 1),
    U.CI = round(prop.test(n, nrow(urban.data), conf.level=0.95)$conf.int[2]*100, 1),
  ) %>%
  mutate(LABEL=paste(
    format(round(PROP, digits=1), nsmall = 1), " (",
    format(round(L.CI, digits=1), nsmall = 1), ", ",
    format(round(U.CI, digits=1), nsmall = 1), ")", sep =""),
    variable = gsub("_"," ",variable)) %>%
  mutate(variable = ifelse(variable=='Illness Death','Illness or Death',variable)) %>%

  ggplot(aes(y=reorder(variable,PROP), x=PROP))+
  theme_ipsum_rc() +
  labs(y="")+
  geom_pointrange(
    size=.33,
    aes(xmin=L.CI, xmax=U.CI)) +
  geom_text(
    family="Times",
    aes(y=variable,label=LABEL,x = 130),
    hjust = 1,size = 3.1,show.legend = FALSE,parse = F) +

  theme(
    legend.position = "none",
    legend.title = element_blank(),
    title= element_blank(),
    axis.text = element_text(size=9, family="Times"),
    axis.title.y = element_text(face="bold",size=10.5,family="Times"),
    axis.title.x = element_blank(),
    plot.margin = unit(c(1,6.2,1,1), "lines")
  ) +
  scale_x_continuous(labels = function(x) paste0(x, "%"),expand = c(0, 0))+
  #scale_color_manual(values= rev(viridis(10))) +
  coord_cartesian(clip = "off" ,xlim=c(0,100))

dev.off()

```

```{r}

dat.1 <- urban.data %>%
    dplyr::select(c(
                    "id",
                    #`Drinking Water: Improved` =                "drinking_water",
                    `Improved Toilet` =                        "toilet",
                    `Improved Floor` =                         "floor",
                    `Improved Wall` =                          "wall",
                    `Improved Roof` =                          "roof",
                    `Cooking Fuel` =                  "cooking_fuel",
                    )) %>%
  rename(id="id") %>%
  melt(id='id') %>%
  group_by(variable) %>%
  count(value) %>%
  filter(value==1) %>%
  rowwise() %>%

  mutate(
    PROP = round(n/nrow(urban.data)*100, 1),
    L.CI = round(prop.test(n, nrow(urban.data), conf.level=0.95)$conf.int[1]*100, 1),
    U.CI = round(prop.test(n, nrow(urban.data), conf.level=0.95)$conf.int[2]*100, 1),
  ) %>%
  mutate(LABEL=paste(
    format(round(PROP, digits=1), nsmall = 1), " (",
    format(round(L.CI, digits=1), nsmall = 1), ", ",
    format(round(U.CI, digits=1), nsmall = 1), ")", sep =""),
    variable = gsub("_"," ",variable))

dat.1$Category <- "Dwelling"
dat.1

dat.2 <- urban.data %>%
    dplyr::select(c(
                    "id",
                    #`Electricity` =                             "electricity",
                    `Radio` =                                   "radio",
                    `TV` =                                      "tv",
                    `Refrigerator` =                            "refrigerator",
                    `Bike` =                                    "bike",
                    #`Motorcycle` =                              "motorcycle",
                    #`Car` =                                     "car",
                    `Phone` =                                   "phone",
                    `Mobile Phone` =                            "mobile_phone",
                    `Bank Account` =                                    "bank",
                    `Window` =                                  "window",
                    `Sleeping Rooms` =               "sleeping_rooms",
                    `Table` =                                   "table",
                    `Chair` =                                   "chair",
                    `Mitad` =                                   "mitad",
                    `Kerosene` =                                "kerosene",
                    `Lantern` =                                  "lantern",
                    `Bed` =                                     "bed",
                    `Land` =                                    "land",
                    #`Lamp` =                                    "lamp",
                    #`Mill` =                                    "mill"
                    #`Chickens` =                                "chickens",
                    #`Goats` =                                   "goats",
                    #`Sheep` =                                   "sheep"
                    )) %>%
  rename(id="id") %>%
  melt(id='id') %>%
  group_by(variable) %>%
  count(value) %>%
  filter(value==1) %>%
  rowwise() %>%

  mutate(
    PROP = round(n/nrow(urban.data)*100, 1),
    L.CI = round(prop.test(n, nrow(urban.data), conf.level=0.95)$conf.int[1]*100, 1),
    U.CI = round(prop.test(n, nrow(urban.data), conf.level=0.95)$conf.int[2]*100, 1),
  ) %>%
  mutate(LABEL=paste(
    format(round(PROP, digits=1), nsmall = 1), " (",
    format(round(L.CI, digits=1), nsmall = 1), ", ",
    format(round(U.CI, digits=1), nsmall = 1), ")", sep =""),
    variable = gsub("_"," ",variable))

dat.2$Category <- "Assets"
dat.2

dat <- rbind(dat.1, dat.2)
dat

```

```{r}
cairo_pdf("../Figures/Wealth Index/Wealth_Index_Assets_Distribution_By_Category_Urban.pdf", 
      width  = 6.5, 
      height = 4.75,
      fallback_resolution = 300,
      family = "serif"
      )
dat %>%
    group_by(Category) %>%
    top_n(15) %>%
    ungroup %>%
    mutate(Category = as.factor(Category),
           variable = reorder_within(variable, PROP, Category)) %>%
 
   ggplot(aes(variable, PROP)) +
   theme_bw() +
   #geom_point() +
   geom_pointrange(shape = 18, size=.75, aes(ymin = L.CI, ymax = U.CI)) +

   facet_grid(Category~., scales = "free", space = "free", switch = "y", shrink = FALSE)+
   
   scale_x_reordered() +
  
   geom_text(family="Times",
    aes(y=125,label=LABEL,x = variable),
    hjust = 1,size = 3.1,show.legend = FALSE,parse = F) +
  
    theme(
     legend.position = "none",
      legend.title = element_blank(),
      title= element_blank(),
      axis.text = element_text(size=11, family="Times"),
      axis.title.y = element_text(size=11, family="Times"),
      axis.title.x = element_text(size=11, family="Times"),
      plot.margin = unit(c(.5,.5,.25,.5), "lines")) +
    scale_y_continuous(breaks=seq(0,100,10))+
    #scale_y_continuous(labels = function(x) paste0(x, "%"),expand = c(0, 0)) +
    coord_cartesian(clip = "off", ylim=c(0,100)) +
    #annotate("rect", xmin = 0, xmax = 10, ymin = 0, ymax = 100,  alpha = .5) +
    coord_flip() +
    xlab("") +
    ylab("Percent Ownership (Urban Households)")

dev.off()
```

```{r}
# forest plot

dim(rural.data)
rural.data$"id" <- seq.int(nrow(rural.data))

dat.1 <- rural.data %>% 
  dplyr::select(c(
                    "id",
                    `Drinking Water: Improved` =                 "drinking_water",
                    `Toilet: Improved` =                         "toilet",
                    #`Floor: Improved` =                         "floor",
                    #`Wall: Improved` =                          "wall",
                    `Roof: Improved` =                          "roof",
                    #`Cooking Fuel: Improved` =                  "cooking_fuel",
                    `Electricity` =                             "electricity",
                    `Radio` =                                   "radio",
                    #`TV` =                                      "tv",
                    #`Refrigerator` =                            "refrigerator",
                    `Bike` =                                    "bike",
                    #`Motorcycle` =                              "motorcycle",
                    #`Car` =                                     "car",
                    #`Phone` =                                   "phone",
                    `Mobile Phone` =                            "mobile_phone",
                    `Bank` =                                    "bank",
                    `Window` =                                  "window",
                    `Designated Sleeping Rooms` =               "sleeping_rooms",
                    #`Table` =                                   "table",
                    #`Chair` =                                   "chair",
                    #`Mitad` =                                   "mitad",
                    `Kerosene` =                                "kerosene",
                    `Lantern` =                                  "lantern",
                    `Bed` =                                     "bed",
                    #`Owns Land` =                               "land",
                    `Lamp` =                                    "lamp",
                    #`Mill` =                                    "mill"
                    #`Chickens` =                                "chickens",
                    #`Goats` =                                   "goats",
                    #`Sheep` =                                   "sheep"
                    )) %>%
  rename(id="id") 

dat.1$COUNT <- rowSums(dat.1[c(2:ncol(dat.1))])

cairo_pdf("../Figures/Wealth Index/Rural_Wealth_Index_Assets_Distribution.pdf", 
      width  = 6.5, 
      height = 4.75,
      fallback_resolution = 300,
      family = "serif"
      )
rural.data %>%
  dplyr::select(c(
                    "id",
                    `Drinking Water: Improved` =                 "drinking_water",
                    `Toilet: Improved` =                         "toilet",
                    #`Floor: Improved` =                         "floor",
                    #`Wall: Improved` =                          "wall",
                    `Roof: Improved` =                          "roof",
                    #`Cooking Fuel: Improved` =                  "cooking_fuel",
                    `Electricity` =                             "electricity",
                    `Radio` =                                   "radio",
                    #`TV` =                                      "tv",
                    #`Refrigerator` =                            "refrigerator",
                    `Bike` =                                    "bike",
                    #`Motorcycle` =                              "motorcycle",
                    #`Car` =                                     "car",
                    #`Phone` =                                   "phone",
                    `Mobile Phone` =                            "mobile_phone",
                    `Bank` =                                    "bank",
                    `Window` =                                  "window",
                    `Designated Sleeping Rooms` =               "sleeping_rooms",
                    #`Table` =                                   "table",
                    #`Chair` =                                   "chair",
                    #`Mitad` =                                   "mitad",
                    `Kerosene` =                                "kerosene",
                    `Latern` =                                  "lantern",
                    `Bed` =                                     "bed",
                    #`Owns Land` =                               "land",
                    `Lamp` =                                    "lamp",
                    #`Mill` =                                    "mill"
                    #`Chickens` =                                "chickens",
                    #`Goats` =                                   "goats",
                    #`Sheep` =                                   "sheep"
                    )) %>%
  rename(id="id") %>%
  melt(id='id') %>%
  group_by(variable) %>%
  count(value) %>%
  filter(value==1) %>%
  rowwise() %>%

  mutate(
    PROP = round(n/nrow(rural.data)*100, 1),
    L.CI = round(prop.test(n, nrow(rural.data), conf.level=0.95)$conf.int[1]*100, 1),
    U.CI = round(prop.test(n, nrow(rural.data), conf.level=0.95)$conf.int[2]*100, 1),
  ) %>%
  mutate(LABEL=paste(
    format(round(PROP, digits=1), nsmall = 1), " (",
    format(round(L.CI, digits=1), nsmall = 1), ", ",
    format(round(U.CI, digits=1), nsmall = 1), ")", sep =""),
    variable = gsub("_"," ",variable)) %>%
  mutate(variable = ifelse(variable=='Illness Death','Illness or Death',variable)) %>%

  ggplot(aes(y=reorder(variable,PROP), x=PROP))+
  theme_ipsum_rc() +
  labs(y="")+
  geom_pointrange(
    size=.33,
    aes(xmin=L.CI, xmax=U.CI)) +
  geom_text(
    family="Times",
    aes(y=variable,label=LABEL,x = 130),
    hjust = 1,size = 3.1,show.legend = FALSE,parse = F) +

  theme(
    legend.position = "none",
    legend.title = element_blank(),
    title= element_blank(),
    axis.text = element_text(size=9, family="Times"),
    axis.title.y = element_text(face="bold",size=10.5,family="Times"),
    axis.title.x = element_blank(),
    plot.margin = unit(c(1,6.2,1,1), "lines")
  ) +
  scale_x_continuous(labels = function(x) paste0(x, "%"),expand = c(0, 0))+
  #scale_color_manual(values= rev(viridis(10))) +
  coord_cartesian(clip = "off" ,xlim=c(0,100))

dev.off()

```

```{r}

dat.1 <- rural.data %>%
    dplyr::select(c(
                    "id",
                    `Improved Water` =                "drinking_water",
                    `Improved Toilet` =             "toilet",
                    #`Floor: Improved` =              "floor",
                    #`Wall: Improved` =               "wall",
                    #`Roof` =                          "roof",
                    )) %>%
  rename(id="id") %>%
  melt(id='id') %>%
  group_by(variable) %>%
  count(value) %>%
  filter(value==1) %>%
  rowwise() %>%

  mutate(
    PROP = round(n/nrow(rural.data)*100, 1),
    L.CI = round(prop.test(n, nrow(rural.data), conf.level=0.95)$conf.int[1]*100, 1),
    U.CI = round(prop.test(n, nrow(rural.data), conf.level=0.95)$conf.int[2]*100, 1),
  ) %>%
  mutate(LABEL=paste(
    format(round(PROP, digits=1), nsmall = 1), " (",
    format(round(L.CI, digits=1), nsmall = 1), ", ",
    format(round(U.CI, digits=1), nsmall = 1), ")", sep =""),
    variable = gsub("_"," ",variable))

dat.1$Category <- "Dwelling"
dat.1

dat.2 <- rural.data %>%
    dplyr::select(c(
                    "id",
                    `Electricity` =                             "electricity",
                    `Radio` =                                   "radio",
                    #`TV` =                                      "tv",
                    #`Refrigerator` =                            "refrigerator",
                    `Bike` =                                    "bike",
                    #`Motorcycle` =                              "motorcycle",
                    #`Car` =                                     "car",
                    #`Phone` =                                   "phone",
                    `Mobile Phone` =                            "mobile_phone",
                    #`Bank` =                                    "bank",
                    `Window` =                                  "window",
                    #`Sleeping Rooms` =               "sleeping_rooms",
                    #`Table` =                                   "table",
                    #`Chair` =                                   "chair",
                    #`Mitad` =                                   "mitad",
                    `Kerosene` =                                "kerosene",
                    `Lantern` =                                  "lantern",
                    #`Bed` =                                     "bed",
                    #`Owns Land` =                               "land",
                    `Lamp` =                                    "lamp",
                    #`Mill` =                                    "mill"
                    #`Chickens` =                                "chickens",
                    #`Goats` =                                   "goats",
                    #`Sheep` =                                   "sheep"
                    )) %>%
  rename(id="id") %>%
  melt(id='id') %>%
  group_by(variable) %>%
  count(value) %>%
  filter(value==1) %>%
  rowwise() %>%

  mutate(
    PROP = round(n/nrow(rural.data)*100, 1),
    L.CI = round(prop.test(n, nrow(rural.data), conf.level=0.95)$conf.int[1]*100, 1),
    U.CI = round(prop.test(n, nrow(rural.data), conf.level=0.95)$conf.int[2]*100, 1),
  ) %>%
  mutate(LABEL=paste(
    format(round(PROP, digits=1), nsmall = 1), " (",
    format(round(L.CI, digits=1), nsmall = 1), ", ",
    format(round(U.CI, digits=1), nsmall = 1), ")", sep =""),
    variable = gsub("_"," ",variable))

dat.2$Category <- "Assets"
dat.2

dat <- rbind(dat.1, dat.2)
dat

```

```{r}
cairo_pdf("../Figures/Wealth Index/Wealth_Index_Assets_Distribution_By_Category_Rural.pdf", 
      width  = 6.5, 
      height = 4.75,
      fallback_resolution = 300,
      family = "serif"
      )
dat %>%
    group_by(Category) %>%
    top_n(15) %>%
    ungroup %>%
    mutate(Category = as.factor(Category),
           variable = reorder_within(variable, PROP, Category)) %>%
 
   ggplot(aes(variable, PROP)) +
   theme_bw() +
   #geom_point()+
   geom_pointrange(shape = 18, size=.75, aes(ymin = L.CI, ymax = U.CI)) +
   
   facet_grid(Category~., scales = "free", space = "free", switch = "y", shrink = FALSE)+
   
   scale_x_reordered() +
  
   geom_text(family="Times",
    aes(y=125,label=LABEL,x = variable),
    hjust = 1,size = 3.1,show.legend = FALSE,parse = F) +
  
    theme(
     legend.position = "none",
      legend.title = element_blank(),
      title= element_blank(),
      axis.text = element_text(size=11, family="Times"),
      axis.title.y = element_text(size=11, family="Times"),
      axis.title.x = element_text(size=11, family="Times"),
      plot.margin = unit(c(.5,.5,.25,.5), "lines")) +
    scale_y_continuous(breaks=seq(0,100,10))+
    #scale_y_continuous(labels = function(x) paste0(x, "%"),expand = c(0, 0)) +
    coord_cartesian(clip = "off", ylim=c(0,100)) +
    #annotate("rect", xmin = 0, xmax = 10, ymin = 0, ymax = 100,  alpha = .5) +
    coord_flip() +
    xlab("") +
    ylab("Percent Ownership (Rural Households)")

dev.off()
```
**Check Data diminsions**
```{r}
dim(data)
head(data[1,187])
head(data[1,216])
```

**Check Data diminsions**
```{r}
dim(urban.data)
head(urban.data[1,199])
head(urban.data[1,219])
```

**Check Data diminsions**
```{r}
dim(rural.data)
head(rural.data[1,209])
head(rural.data[1,218])
```

##################################################################
*Principle Components Analysis - Urban*
##################################################################

##     SET SAMPLE DESIGN
Data were gathered as part of a simple random sample - no need to account to sample design.

Note: After running PCA, Stata presents two tables. The first contains eigenvalues as well as showing the proportion of variance accounted for by each component. We will not be using these numbers. The second table entitled Principal components (eigenvectors) presents the components for each variable. We will use the very first component only (Comp1).

The value given under Comp1 for each variable is the factor weight for that variable. These factor weights will be used later on to produce standardized, weighted versions of the wealth indicator variables that we will then sum to produce the raw wealth index scores.

*	Obtain Factor Weights from First Component of PCA (7 Steps):

* Step 1: Create a variable list of all wealth indicator variables.

* Step 2: Store the variable lists in a global macro.

* Step 3: Create global macro 'comp1', which will help return only the first component from the PCA.

* Step 4: Generate the PCA weight by multiplying the household weight (hv005) by the number of dejure resident members in the household and then dividing by 1,000,000.

* Step 5: Run the PCA for the variable list created in Steps 1 & 2. Use the 'comp1' macro to return only the first component. Use means to obtain summary statistics as we will need the mean and standard deviation later on.

* Step 6: Generate factor weights for each variable.

* Step 7: Label the new list of factor weights to facilitate future automation.

```{r, echo=FALSE}
head(urban.data[1,212])
head(urban.data[1,232])
```

```{r, echo=FALSE}
pca.data <- colnames(urban.data[,212:232])
class(pca.data)
dim(urban.data)
head(pca.data, 27)
sum(is.na(urban.data[,212:232]))
```

## Principal Compoenents Analysis (PCA)
```{r, echo=FALSE}
prn<-psych::principal(urban.data[,212:232], rotate="varimax", nfactors=3,covar=T, scores=TRUE)
prn
urban.data$index=prn$scores[,1]
summary(urban.data$index)
quintiles = quantile(urban.data$index, probs = seq(0, 1, .2))
table(quintiles)
quintiles[1]
quintiles[2]
quintiles[3]
quintiles[4]
quintiles[5]
```

## Generate Wealth Index
```{r, echo=FALSE}
#data$rawwealthscore <- data$rawwealthscore*-1

urban.data$wealthindex = NULL
urban.data$wealthindex[urban.data$index <=  quintiles[2]] <- 1
urban.data$wealthindex[urban.data$index > quintiles[2] & urban.data$index <= quintiles[3]] <- 2
urban.data$wealthindex[urban.data$index > quintiles[3] & urban.data$index <= quintiles[4]] <- 3
urban.data$wealthindex[urban.data$index > quintiles[4] & urban.data$index <= quintiles[5]] <- 4
urban.data$wealthindex[urban.data$index > quintiles[5]] <- 5
table(urban.data$wealthindex)

urban.data$`Wealth Index (Household)` <- factor(urban.data$wealthindex,
                    levels = c(5,4,3,2,1),
                    labels = c("Richest", "Richer", "Middle", "Poorer", "Poorest"))

urban.data$WealthIndex <- factor(urban.data$wealthindex,
                    levels = c(5,4,3,2,1),
                    labels = c("Richest", "Richer", "Middle", "Poorer", "Poorest"))

ggplot(urban.data, aes(x=`Wealth Index (Household)`, colour = `Wealth Index (Household)`)) +
  geom_bar(aes(fill = `Wealth Index (Household)`)) +
  scale_color_viridis(discrete=TRUE) +
  scale_fill_viridis(discrete=TRUE) +
  theme(legend.position="none") +
  xlab("Wealth Index (Urban Households)") +
  ylab("Count")

pdf("../Figures/Wealth Index/Wealth_Index_Plot_Urban.pdf", width = 5, height = 2.75)
ggplot(urban.data, aes(x=`Wealth Index (Household)`, colour = `Wealth Index (Household)`)) +
  geom_bar(aes(fill = `Wealth Index (Household)`)) +
  scale_color_viridis(discrete=TRUE) +
  scale_fill_viridis(discrete=TRUE) +
  theme(legend.position="none") +
  xlab("Wealth Index (Urban Households)") +
  ylab("Count")
dev.off()

urban.data$WealthIndex_2_V <- 0
urban.data$WealthIndex_2_V[urban.data$`Wealth Index (Household)` == "Richer"] <- 1

urban.data$WealthIndex_3_V <- 0
urban.data$WealthIndex_3_V[urban.data$`Wealth Index (Household)` == "Middle"] <- 1

urban.data$WealthIndex_4_V <- 0
urban.data$WealthIndex_4_V[urban.data$`Wealth Index (Household)` == "Poorer"] <- 1

urban.data$WealthIndex_5_V <- 0
urban.data$WealthIndex_5_V[urban.data$`Wealth Index (Household)` == "Poorest"] <- 1

```

## Evaluate Wealth Index

```{r, echo=FALSE}

summary(urban.data$index)
summary(urban.data$HH_Monthly_Income)
table(urban.data$WealthIndex, urban.data$Income)

EvaluationModel <- lm(HH_Monthly_Income ~ index, data = urban.data)
```

```{r, echo=FALSE}
summary(EvaluationModel)
#summ(EvaluationModel, confint = TRUE, digits = 3)
```

```{r, echo=FALSE}

summary(urban.data$`Wealth Index (Household)`)
summary(urban.data$HH_Monthly_Income)
table(urban.data$WealthIndex, urban.data$Income)

EvaluationModel <- lm(HH_Monthly_Income ~ `Wealth Index (Household)`, data = urban.data)
```

```{r, echo=FALSE}
summary(EvaluationModel)
#summ(EvaluationModel, confint = TRUE, digits = 3)
```

```{r, echo=FALSE}
EvaluationModel <- glm(formula = Education ~ factor(`Wealth Index (Household)`), family = binomial, data = urban.data)
 
# Print the regression model
summary(EvaluationModel) 
```

```{r, echo=FALSE}
EvaluationModel <- glm(formula = radio ~ factor(`Wealth Index (Household)`), family = binomial, data = urban.data)
 
# Print the regression model
summary(EvaluationModel) 
```

```{r, echo=FALSE}
EvaluationModel <- glm(formula = tv ~ factor(`Wealth Index (Household)`), family = binomial, data = urban.data)
 
# Print the regression model
summary(EvaluationModel) 
```

```{r, echo=FALSE}
EvaluationModel <- glm(formula = refrigerator ~ factor(`Wealth Index (Household)`), family = binomial, data = urban.data)
 
# Print the regression model
summary(EvaluationModel) 
```

```{r, echo=FALSE}
EvaluationModel <- glm(formula = mitad ~ factor(`Wealth Index (Household)`), family = binomial, data = urban.data)
 
# Print the regression model
summary(EvaluationModel) 
```

```{r, echo=FALSE}
EvaluationModel <- glm(formula = phone ~ factor(`Wealth Index (Household)`), family = binomial, data = urban.data)
 
# Print the regression model
summary(EvaluationModel) 
```

```{r, echo=FALSE}
EvaluationModel <- glm(formula = mobile_phone ~ factor(`Wealth Index (Household)`), family = binomial, data = urban.data)
 
# Print the regression model
summary(EvaluationModel) 
```

```{r, echo=FALSE}
EvaluationModel <- glm(formula = bike ~ factor(`Wealth Index (Household)`), family = binomial, data = urban.data)
 
# Print the regression model
summary(EvaluationModel) 
```

```{r, echo=FALSE}
EvaluationModel <- glm(formula = motorcycle ~ factor(`Wealth Index (Household)`), family = binomial, data = urban.data)
 
# Print the regression model
summary(EvaluationModel) 
```

```{r, echo=FALSE}
EvaluationModel <- glm(formula = car ~ factor(`Wealth Index (Household)`), family = binomial, data = urban.data)
 
# Print the regression model
summary(EvaluationModel) 
```

```{r, echo=FALSE}
EvaluationModel <- glm(formula = mill ~ factor(`Wealth Index (Household)`), family = binomial, data = urban.data)
 
# Print the regression model
summary(EvaluationModel) 
```

```{r, echo=FALSE}
EvaluationModel <- glm(formula = land ~ factor(`Wealth Index (Household)`), family = binomial, data = urban.data)
 
# Print the regression model
summary(EvaluationModel) 
```


##################################################################
*Principle Components Analysis - Rural*
##################################################################

##     SET SAMPLE DESIGN
Data were gathered as part of a simple random sample - no need to account to sample design.

Note: After running PCA, Stata presents two tables. The first contains eigenvalues as well as showing the proportion of variance accounted for by each component. We will not be using these numbers. The second table entitled Principal components (eigenvectors) presents the components for each variable. We will use the very first component only (Comp1).

The value given under Comp1 for each variable is the factor weight for that variable. These factor weights will be used later on to produce standardized, weighted versions of the wealth indicator variables that we will then sum to produce the raw wealth index scores.

*	Obtain Factor Weights from First Component of PCA (7 Steps):

* Step 1: Create a variable list of all wealth indicator variables.

* Step 2: Store the variable lists in a global macro.

* Step 3: Create global macro 'comp1', which will help return only the first component from the PCA.

* Step 4: Generate the PCA weight by multiplying the household weight (hv005) by the number of dejure resident members in the household and then dividing by 1,000,000.

* Step 5: Run the PCA for the variable list created in Steps 1 & 2. Use the 'comp1' macro to return only the first component. Use means to obtain summary statistics as we will need the mean and standard deviation later on.

* Step 6: Generate factor weights for each variable.

* Step 7: Label the new list of factor weights to facilitate future automation. 196:214

```{r}
head(rural.data[1,223])
head(rural.data[1,232])
```

```{r}
pca.data <- colnames(rural.data[,223:232])
class(pca.data)
dim(rural.data)
head(pca.data, 15)
sum(is.na(rural.data[,223:232]))
```

## Principal Compoenents Analysis (PCA)
```{r, echo=FALSE}
prn<-psych::principal(rural.data[,223:232], rotate="varimax", nfactors=3,covar=T, scores=TRUE)
prn
rural.data$index=prn$scores[,1]
summary(rural.data$index)
quintiles = quantile(rural.data$index, probs = seq(0, 1, .2))
table(quintiles)
quintiles[1]
quintiles[2]
quintiles[3]
quintiles[4]
quintiles[5]
```

## Generate Wealth Index
```{r, echo=FALSE}
#data$rawwealthscore <- data$rawwealthscore*-1

rural.data$wealthindex = NULL
rural.data$wealthindex[rural.data$index <  quintiles[2]] <- 1
rural.data$wealthindex[rural.data$index >= quintiles[2] & rural.data$index < quintiles[3]] <- 2
rural.data$wealthindex[rural.data$index >= quintiles[3] & rural.data$index < quintiles[4]] <- 3
rural.data$wealthindex[rural.data$index >= quintiles[4] & rural.data$index < quintiles[5]] <- 4
rural.data$wealthindex[rural.data$index >= quintiles[5]] <- 5
table(rural.data$wealthindex)

rural.data$`Wealth Index (Household)` <- factor(rural.data$wealthindex,
                    levels = c(5,4,3,2,1),
                    labels = c("Richest", "Richer", "Middle", "Poorer", "Poorest"))

rural.data$WealthIndex <- factor(rural.data$wealthindex,
                    levels = c(5,4,3,2,1),
                    labels = c("Richest", "Richer", "Middle", "Poorer", "Poorest"))

ggplot(rural.data, aes(x=`Wealth Index (Household)`, colour = `Wealth Index (Household)`)) +
  geom_bar(aes(fill = `Wealth Index (Household)`)) +
  scale_color_viridis(discrete=TRUE) +
  scale_fill_viridis(discrete=TRUE) +
  theme(legend.position="none") +
  xlab("Wealth Index (Rural Households)") +
  ylab("Count")

pdf("../Figures/Wealth Index/Wealth_Index_Plot_Rural.pdf", width = 5, height = 2.75)
ggplot(rural.data, aes(x=`Wealth Index (Household)`, colour = `Wealth Index (Household)`)) +
  geom_bar(aes(fill = `Wealth Index (Household)`)) +
  scale_color_viridis(discrete=TRUE) +
  scale_fill_viridis(discrete=TRUE) +
  theme(legend.position="none") +
  xlab("Wealth Index (Rural Households)") +
  ylab("Count")
dev.off()

rural.data$WealthIndex_2_V <- 0
rural.data$WealthIndex_2_V[rural.data$`Wealth Index (Household)` == "Richer"] <- 1

rural.data$WealthIndex_3_V <- 0
rural.data$WealthIndex_3_V[rural.data$`Wealth Index (Household)` == "Middle"] <- 1

rural.data$WealthIndex_4_V <- 0
rural.data$WealthIndex_4_V[rural.data$`Wealth Index (Household)` == "Poorer"] <- 1

rural.data$WealthIndex_5_V <- 0
rural.data$WealthIndex_5_V[rural.data$`Wealth Index (Household)` == "Poorest"] <- 1

```

## Evaluate Wealth Index

```{r}
summary(rural.data$index)
summary(rural.data$HH_Monthly_Income)
table(rural.data$WealthIndex, rural.data$Income)

EvaluationModel <- lm(HH_Monthly_Income ~ index, data = rural.data)
```

```{r}
summary(EvaluationModel)
#summ(EvaluationModel, confint = TRUE, digits = 3)
```

```{r}

summary(rural.data$`Wealth Index (Household)`)
summary(rural.data$HH_Monthly_Income)
table(rural.data$WealthIndex, rural.data$Income)

EvaluationModel <- lm(HH_Monthly_Income ~ `Wealth Index (Household)`, data = rural.data)
```

```{r}
summary(EvaluationModel)
#summ(EvaluationModel, confint = TRUE, digits = 3)
```

## Evaluate Wealth Index 
```{r, echo=FALSE}
EvaluationModel <- glm(formula = Education ~ factor(`Wealth Index (Household)`), family = binomial, data = rural.data)
 
# Print the regression model
summary(EvaluationModel) 
```

```{r, echo=FALSE}
EvaluationModel <- glm(formula = radio ~ factor(`Wealth Index (Household)`), family = binomial, data = rural.data)
 
# Print the regression model
summary(EvaluationModel) 
```

```{r, echo=FALSE}
EvaluationModel <- glm(formula = tv ~ factor(`Wealth Index (Household)`), family = binomial, data = rural.data)
 
# Print the regression model
summary(EvaluationModel) 
```

```{r, echo=FALSE}
EvaluationModel <- glm(formula = refrigerator ~ factor(`Wealth Index (Household)`), family = binomial, data = rural.data)
 
# Print the regression model
summary(EvaluationModel) 
```

```{r, echo=FALSE}
EvaluationModel <- glm(formula = mitad ~ factor(`Wealth Index (Household)`), family = binomial, data = rural.data)
 
# Print the regression model
summary(EvaluationModel) 
```

```{r, echo=FALSE}
EvaluationModel <- glm(formula = phone ~ factor(`Wealth Index (Household)`), family = binomial, data = rural.data)
 
# Print the regression model
summary(EvaluationModel) 
```

```{r, echo=FALSE}
EvaluationModel <- glm(formula = mobile_phone ~ factor(`Wealth Index (Household)`), family = binomial, data = rural.data)
 
# Print the regression model
summary(EvaluationModel) 
```

```{r, echo=FALSE}
EvaluationModel <- glm(formula = bike ~ factor(`Wealth Index (Household)`), family = binomial, data = rural.data)
 
# Print the regression model
summary(EvaluationModel) 
```

```{r, echo=FALSE}
EvaluationModel <- glm(formula = motorcycle ~ factor(`Wealth Index (Household)`), family = binomial, data = rural.data)
 
# Print the regression model
summary(EvaluationModel) 
```

```{r, echo=FALSE}
EvaluationModel <- glm(formula = car ~ factor(`Wealth Index (Household)`), family = binomial, data = rural.data)
 
# Print the regression model
summary(EvaluationModel) 
```

```{r, echo=FALSE}
EvaluationModel <- glm(formula = mill ~ factor(`Wealth Index (Household)`), family = binomial, data = rural.data)
 
# Print the regression model
summary(EvaluationModel) 
```

```{r, echo=FALSE}
EvaluationModel <- glm(formula = land ~ factor(`Wealth Index (Household)`), family = binomial, data = rural.data)
 
# Print the regression model
summary(EvaluationModel) 
```

```{r, echo=FALSE}
data <- rbind(urban.data, rural.data)
dim(data)

quintiles = quantile(data$index, probs = seq(0, 1, .2))
table(quintiles)
quintiles[1]
quintiles[2]
quintiles[3]
quintiles[4]
quintiles[5]

data$wealthindex = NULL
data$wealthindex[data$index <  quintiles[2]] <- 1
data$wealthindex[data$index >= quintiles[2] & data$index < quintiles[3]] <- 2
data$wealthindex[data$index >= quintiles[3] & data$index < quintiles[4]] <- 3
data$wealthindex[data$index >= quintiles[4] & data$index < quintiles[5]] <- 4
data$wealthindex[data$index >= quintiles[5]] <- 5
table(data$wealthindex, useNA = "always")
tab1(data$wealthindex, cum.percent = TRUE)

data$`Wealth Index (Household)` <- factor(data$wealthindex,
                    levels = c(1, 2, 3, 4, 5),
                    labels = c("Poorest", "Poorer", "Middle", "Richer", "Richest"))

data$WealthIndex <- factor(data$wealthindex,
                    levels = c(1, 2, 3, 4, 5),
                    labels = c("Poorest", "Poorer", "Middle", "Richer", "Richest"))

data$WealthIndex_2_V <- 0 
data$WealthIndex_2_V[data$`Wealth Index (Household)` == "Richer"]  <- 1

data$WealthIndex_3_V <- 0 
data$WealthIndex_3_V[data$`Wealth Index (Household)` == "Middle"]  <- 1

data$WealthIndex_4_V <- 0 
data$WealthIndex_4_V[data$`Wealth Index (Household)` == "Poorer"]  <- 1

data$WealthIndex_5_V <- 0 
data$WealthIndex_5_V[data$`Wealth Index (Household)` == "Poorest"] <- 1

ggplot(data, aes(x=`Wealth Index (Household)`, colour = `Wealth Index (Household)`)) +
  geom_bar(aes(fill = `Wealth Index (Household)`)) +
  scale_color_viridis(discrete=TRUE) +
  scale_fill_viridis(discrete=TRUE) +
  theme(legend.position="none") +
  ylab("Count")

pdf("../Figures/Wealth Index/Wealth_Index_Plot_Combined.pdf", width = 5, height = 2.75)
ggplot(data, aes(x=`Wealth Index (Household)`, colour = `Wealth Index (Household)`)) +
  geom_bar(aes(fill = `Wealth Index (Household)`)) +
  scale_color_viridis(discrete=TRUE) +
  scale_fill_viridis(discrete=TRUE) +
  theme(legend.position="none") +
  xlab("Wealth Index (Composite Households)") +
  ylab("Count")
dev.off()

tiff("../Figures/Wealth Index/Wealth_Index_Plot_Combined.tiff", units="mm", width=85, height=120, res=300)

ggplot(data, aes(x=`Wealth Index (Household)`, colour = `Wealth Index (Household)`)) +
  geom_bar(aes(fill = `Wealth Index (Household)`)) +
  scale_color_viridis(discrete=TRUE) +
  scale_fill_viridis(discrete=TRUE) +
  theme(legend.position="none") +
  xlab("Wealth Index (Composite Households)") +
  ylab("Count")

dev.off()


```


## Evaluate Wealth Index 

```{r, echo=FALSE}

summary(data$`Wealth Index (Household)`)
summary(data$HH_Monthly_Income)
table(data$`Wealth Index (Household)`, data$Income)
table(data$`Wealth Index (Household)`, data$`Residence (Household)`)
table(data$Income, data$`Residence (Household)`)

EvaluationModel <- lm(HH_Monthly_Income ~ `Wealth Index (Household)`, data = data)
```

```{r, echo=FALSE}
summary(EvaluationModel) 
#summ(EvaluationModel, confint = TRUE, digits = 3)
```

```{r, echo=FALSE}
EvaluationModel <- glm(formula = Education ~ factor(`Wealth Index (Household)`), family = binomial, data = data)
 
# Print the regression model
summary(EvaluationModel) 
```

```{r, echo=FALSE}
EvaluationModel <- glm(formula = radio ~ factor(`Wealth Index (Household)`), family = binomial, data = data)
 
# Print the regression model
summary(EvaluationModel) 
```

```{r, echo=FALSE}
EvaluationModel <- glm(formula = tv ~ factor(`Wealth Index (Household)`), family = binomial, data = data)
 
# Print the regression model
summary(EvaluationModel) 
```

```{r, echo=FALSE}
EvaluationModel <- glm(formula = refrigerator ~ factor(`Wealth Index (Household)`), family = binomial, data = data)
 
# Print the regression model
summary(EvaluationModel) 
```

```{r, echo=FALSE}
EvaluationModel <- glm(formula = mitad ~ factor(`Wealth Index (Household)`), family = binomial, data = data)
 
# Print the regression model
summary(EvaluationModel) 
```

```{r, echo=FALSE}
EvaluationModel <- glm(formula = phone ~ factor(`Wealth Index (Household)`), family = binomial, data = data)
 
# Print the regression model
summary(EvaluationModel) 
```

```{r, echo=FALSE}
EvaluationModel <- glm(formula = mobile_phone ~ factor(`Wealth Index (Household)`), family = binomial, data = data)
 
# Print the regression model
summary(EvaluationModel) 
```

```{r, echo=FALSE}
EvaluationModel <- glm(formula = bike ~ factor(`Wealth Index (Household)`), family = binomial, data = data)
 
# Print the regression model
summary(EvaluationModel) 
```

```{r, echo=FALSE}
EvaluationModel <- glm(formula = motorcycle ~ factor(`Wealth Index (Household)`), family = binomial, data = data)
 
# Print the regression model
summary(EvaluationModel) 
```

```{r, echo=FALSE}
EvaluationModel <- glm(formula = car ~ factor(`Wealth Index (Household)`), family = binomial, data = data)
 
# Print the regression model
summary(EvaluationModel) 
```

```{r, echo=FALSE}
EvaluationModel <- glm(formula = mill ~ factor(`Wealth Index (Household)`), family = binomial, data = data)
 
# Print the regression model
summary(EvaluationModel) 
```

```{r, echo=FALSE}
EvaluationModel <- glm(formula = land ~ factor(`Wealth Index (Household)`), family = binomial, data = data)
 
# Print the regression model
summary(EvaluationModel) 
```

```{r, echo=FALSE}
EvaluationModel <- glm(formula = goats ~ factor(`Wealth Index (Household)`), family = binomial, data = data)
 
# Print the regression model
summary(EvaluationModel) 
```

```{r, echo=FALSE}
EvaluationModel <- glm(formula = sheep ~ factor(`Wealth Index (Household)`), family = binomial, data = data)
 
# Print the regression model
summary(EvaluationModel) 
```

```{r, echo=FALSE}
EvaluationModel <- glm(formula = chickens ~ factor(`Wealth Index (Household)`), family = binomial, data = data)
 
# Print the regression model
summary(EvaluationModel) 
```

*Hardship Index Creation: Additive Index*
```{r}

#data <- as.data.frame(data)

data <- data %>% #specify dply::select because MASS also has a select that will give you an error
  dplyr::relocate(c("Job_Loss",
                    "Nonfarm_Business_Closure",
                    "Farm_Disruption",
                    "Livestock_Disruption",
                    "Fishing_Disruption",
                    "Output_Deflation",
                    "Input_Inflation",
                    "Food_Price_Increase",
                    "Illness_Death",
                    "COVID_Food_Insecurity",
                    "Hardship_Other"), .after=last_col())

dim(data)    
head(data[5, 231:239])

data$"id" <- seq.int(nrow(data))

descr(data$id)

dat.1 <- data %>% 
  dplyr::select(c(
    "id",
    #"COVID_Food_Insecurity",
    "Job_Loss",
    "Nonfarm_Business_Closure",
    "Farm_Disruption",
    "Livestock_Disruption",
    "Fishing_Disruption",
    "Input_Inflation",
    "Output_Deflation",
    "Food_Price_Increase",
    "Illness_Death")) %>%
  rename(id="id") 

dat.1$COUNT <- rowSums(dat.1[c(2:ncol(dat.1))])
```

```{r}
# waffle  plot
cairo_pdf("../Figures/Hardship Index/Hardship_Index_Plot_1.pdf", 
      width  = 6.5, 
      height = 4.75,
      fallback_resolution = 300,
      family = "serif"
      )
dat.1 %>%
  dplyr::select(id,COUNT) %>%
  melt(id='id') %>%
  count(value) %>%
  rename(`Number of hardships reported`=value) %>%
  
  ggplot(aes(fill = `Number of hardships reported`, values = n)) +
  geom_waffle(color = "white", size = .25, n_rows = 20, flip = F) +
  scale_y_discrete() +
  scale_x_continuous(labels = function(x) x * 20, # make this multiplyer the same as n_rows
                     expand = c(0,0)) +
  scale_fill_manual(values=(viridis(n=11)))+
  coord_equal() +
  labs(
    title = "Number of Hardships Reported",
    x = "Age group",
  ) +
  theme_minimal() +
  theme(
    axis.title=element_blank(),
    panel.grid = element_blank(),
    legend.title=element_blank(),
    legend.position = "right",
    legend.text = element_text(size=8.8, family="Times"),
    legend.key.size = unit(.55, "cm"),
    plot.title = element_text(face="bold", size=11, family="Times"),
    axis.ticks.y = element_line()) +
  guides(fill = guide_legend(reverse = TRUE))
dev.off()

```

```{r}
# forest plot

cairo_pdf("../Figures/Hardship Index/Hardship_Index_Plot_2.pdf", 
      width  = 6.5, 
      height = 4.75,
      fallback_resolution = 300,
      family = "serif"
      )
data %>% 
  dplyr::select(c(
    "id",
    #"COVID_Food_Insecurity",
    "Job_Loss",
    "Nonfarm_Business_Closure",
    "Farm_Disruption",
    "Livestock_Disruption",
    "Fishing_Disruption",
    "Input_Inflation",
    "Output_Deflation",
    "Food_Price_Increase",
    "Illness_Death")) %>%
  rename(id="id") %>%
  melt(id='id') %>%
  group_by(variable) %>%
  count(value) %>%
  filter(value==1) %>%
  rowwise() %>%
  
  mutate(
    PROP = round(n/nrow(data)*100, 1),
    L.CI = round(prop.test(n, nrow(data), conf.level=0.95)$conf.int[1]*100, 1),
    U.CI = round(prop.test(n, nrow(data), conf.level=0.95)$conf.int[2]*100, 1),
  ) %>%
  mutate(LABEL=paste(
    format(round(PROP, digits=1), nsmall = 1), " (",
    format(round(L.CI, digits=1), nsmall = 1), ", ",
    format(round(U.CI, digits=1), nsmall = 1), ")", sep =""),
    variable = gsub("_"," ",variable)) %>%
  mutate(variable = ifelse(variable=='Illness Death','Illness or Death',variable)) %>%
  mutate(variable = ifelse(variable=='Nonfarm Business Closure','Business Closure',variable)) %>%

  ggplot(aes(y=reorder(variable,PROP), x=PROP))+
  theme_ipsum_rc() +
  labs(y="")+
  geom_pointrange(
    size=.33,
    aes(xmin=L.CI, xmax=U.CI)) +
  geom_text(
    family="Times",
    aes(y=variable,label=LABEL,x = 90.5),
    hjust = 1,size = 3.1,show.legend = FALSE,parse = F) +
  
  theme(
    legend.position = "none",
    legend.title = element_blank(),
    title= element_blank(),
    axis.text = element_text(size=9, family="Times"),
    axis.title.y = element_text(face="bold", size=10.5, family="Times", hjust = 0.5),
    axis.title.x = element_blank(),
    plot.margin = unit(c(0.5,7,0.5,0.0), "lines")
  ) +
  scale_x_continuous(labels = function(x) paste0(x, "%"),expand = c(0, 0))+
  #scale_color_manual(values= rev(viridis(10))) +
  coord_cartesian(clip = "off" ,xlim=c(0,70))

dev.off()  

```

```{r}

head(data[5, 231:239])

#creating an additive Hardship Index variable- factor
data$HardshipIndex <-rowSums(data[,c(231:239)])          
descr(data$HardshipIndex)
table(data$HardshipIndex)

cronbach.alpha((data[,c(231:239)])) #Assessing the internal consistency of our hardship index variables

Figure <- ggplot(data, aes(x =`HardshipIndex`, y = (..count..)/sum(..count..), fill = factor(`HardshipIndex`))) +
        #geom_bar(color = "white") +
        geom_bar() +
        theme_minimal() +
        #theme(panel.grid.major = element_line(colour = "black")) +
        #theme(panel.grid.major = element_line(linetype = "dotted")) +
        scale_x_continuous(name="Number of Hardships Reported", breaks=seq(0,9,1)) +
        xlab("Hardship Index") +
        scale_fill_viridis(name="", discrete=TRUE, begin = 0, end = .9) +
        scale_y_continuous(labels = scales::percent, name = "", position = "right") +
        #theme(axis.text.x = element_text(hjust = 1)) +
        theme(legend.position = "none") + # No need for a legend but add a title
        theme(axis.text.x = element_text(size =8, color = "black"),
              axis.text.y = element_text(size =8, color = "black"),
              axis.title.y = element_text(size=10, color = "black"),
              axis.title.x = element_text(size=10, color = "black")) +
        ggtitle("")
Figure
cairo_pdf("../Figures/Hardship Index/Proportions of Households by Hardship Index.pdf", 
      width  = 6.5, 
      height = 4.75,
      fallback_resolution = 300,
      family = "serif"
      )
Figure
dev.off()

#Bar chart of counts by all hardship indicators
hardships <- NULL
hardships$factors <- factor(c("Illness/Death",
                       "Farm Disruption",
                       "Farming Input Inflation",
                       "Farming Output Deflation",
                       "Fishing Disruption", 
                       #"Food Insecurity",
                       "Food Price Increase",
                       "Job Loss", 
                       "Livestock Disruption", 
                       "Business Closure"))

hardships$values <-  c(92/880*100,
                       118/880*100,
                       438/880*100,
                       245/880*100,
                       111/880*100, 
                       #138/880*100,
                       524/880*100,
                       488/880*100, 
                       232/880*100, 
                       266/880*100)

hardships <- as.data.frame(hardships)

hardships$factors <- factor(hardships$factors, levels = c("Illness/Death",
                       "Farm Disruption",
                       "Farming Input Inflation",
                       "Farming Output Deflation",
                       "Fishing Disruption", 
                       #"Food Insecurity",
                       "Food Price Increase",
                       "Job Loss", 
                       "Livestock Disruption", 
                       "Business Closure"))
hardships
levels(hardships$factors)

Figure <- ggplot(hardships, aes(x = factors, y = values, fill = factors, label = values)) +
  geom_bar(stat="identity", color = "white") +
  geom_bar(stat="identity") +
  coord_flip()+
  scale_fill_viridis_d() +
  scale_x_discrete("", limits = rev(levels(hardships$factors)), labels = c("Business Closure",
                                                                        "Livestock Disruption",
                                                                        "Job Loss", 
                                                                        "Food Price Increase",
                                                                        #"Food Insecurity",
                                                                        "Fishing Disruption",
                                                                        "Farming Output Deflation",
                                                                        "Farming Input Inflation",
                                                                        "Farm Disruption",
                                                                        "Illness/Death")) +
  scale_y_continuous("Percent of Households") +
  theme(legend.position = "none") +
  #theme(axis.text.x = element_text(angle = 45, hjust = 1)) +
  theme(axis.text.x = element_text(size =12, color = "black"),
        axis.text.y = element_text(size =12, color = "black"),
        axis.title.y = element_text(size=15, color = "black"),
        axis.title.x = element_text(size=15, color = "black")) +
  ggtitle("")

Figure
pdf("../Figures/Hardship Index/COVID-19 Hardship Index Composition.pdf", width = 6, height = 3.5)
Figure
dev.off()

```

*Hardship Index Creation: PCA Factor Analysis*

```{r}

pca.rotated <- data %>% #specify dply::select because MASS also has a select that will give you an error
  dplyr::select(c(
    #"COVID_Food_Insecurity",
    "Job_Loss",
    "Nonfarm_Business_Closure",
    "Farm_Disruption",
    "Livestock_Disruption",
    "Fishing_Disruption",
    "Input_Inflation",
    "Output_Deflation",
    "Food_Price_Increase",
    #"Illness_Death",
    #"Hardship_Other"
    )) %>%

  # factor analysis with all hardship variables
  psych::principal(rotate="varimax", nfactors=2, scores=TRUE)

print(pca.rotated)

# subset to variables that loaded onto first factor
pca.rotated.1 <- data %>% 
  dplyr::select(c(
    "Job_Loss",
    "Nonfarm_Business_Closure",
    "Farm_Disruption",
    "Livestock_Disruption",
    "Fishing_Disruption",
    "Output_Deflation"
  )) %>%

  # rerun factor analysis on subset
  psych::principal(rotate="varimax", nfactors=1, scores=TRUE)

# subset to variables that loaded onto second factor
pca.rotated.2 <- data %>% 
  dplyr::select(c(
    "Input_Inflation",
    "Food_Price_Increase"
  )) %>%
  
  # rerun factor analysis on subset
  psych::principal(rotate="varimax", nfactors=1, scores=TRUE)

dat.1 <- data %>%
  dplyr::select(c(
    #"COVID_Food_Insecurity",
    "Job_Loss",
    "Nonfarm_Business_Closure",
    "Farm_Disruption",
    "Livestock_Disruption",
    "Fishing_Disruption",
    "Input_Inflation",
    "Output_Deflation",
    "Food_Price_Increase",
    "Illness_Death",
    "HardshipIndex"
  )) %>%
  
  mutate(
    'Disruption Index' = 
      pca.rotated.1$loadings[1]*Job_Loss +
      pca.rotated.1$loadings[2]*Nonfarm_Business_Closure +
      pca.rotated.1$loadings[3]*Farm_Disruption +
      pca.rotated.1$loadings[4]*Livestock_Disruption +
      pca.rotated.1$loadings[5]*Fishing_Disruption +
      pca.rotated.1$loadings[6]*Output_Deflation,
    
    'Inflation Index' = 
      pca.rotated.2$loadings[1]*Input_Inflation +
      pca.rotated.2$loadings[2]*Food_Price_Increase,
    
    'Additive Index' = HardshipIndex
    
  ) %>% 
  dplyr::select(c(
    `Disruption Index`,
    `Inflation Index`,
    `Additive Index`
    )) 

# add pca results to data
data <- cbind(data, dat.1)

summary(data$`Disruption Index`)
class(data$`Disruption Index`)
table(data$`Disruption Index`)
data$DisruptionIndex <- data$`Disruption Index`
# Figure <- ggplot(data, aes(x =`Disruption Index`, y = (..count..)/sum(..count..), fill = factor(`Disruption Index`))) +
#         geom_bar(color = "white") +
#         geom_bar() +
#         xlab("Disruption Index") +
#         scale_fill_viridis_d(direction = -1) +
#         scale_y_continuous(labels = scales::percent, name = "Proportion") +
#         theme(axis.text.x = element_text(angle = 45, hjust = 1)) +
#         theme(legend.position = "none") + # No need for a legend but add a title
#         ggtitle("Proportions of Households by Disruption Index")
# Figure
# pdf("../Figures/Hardship Index/Proportions of Households by Disruption Index.pdf", width = 6, height = 5)
# Figure
# dev.off()

```

*Response Variables - Index Creation: Additive Index*
```{r}
dim(data)
```

```{r}

data$Covid_Response_HomeStay           <- as.numeric(data$Covid_Response_HomeStay)
data$Covid_Response_Gathering          <- as.numeric(data$Covid_Response_Gathering)
data$Covid_Response_Lockdown           <- as.numeric(data$Covid_Response_Lockdown)
data$Covid_Response_TravelRestrictions <- as.numeric(data$Covid_Response_TravelRestrictions)
data$Covid_Response_BusinessClosures   <- as.numeric(data$Covid_Response_BusinessClosures)
data$Covid_Response_IsolationCenters   <- as.numeric(data$Covid_Response_IsolationCenters)

table(data$Covid_Response_HomeStay,  useNA = "always")
table(data$Covid_Response_Gathering,  useNA = "always")
table(data$Covid_Response_Lockdown,  useNA = "always")
table(data$Covid_Response_TravelRestrictions,  useNA = "always")
table(data$Covid_Response_BusinessClosures,  useNA = "always")
table(data$Covid_Response_IsolationCenters,  useNA = "always")
#data <- as.data.frame(data)

data <- data %>% #specify dply::select because MASS also has a select that will give you an error
  dplyr::relocate(c(
                    "Covid_Response_Gathering",
                    "Covid_Response_Lockdown",
                    "Covid_Response_HomeStay",
                    "Covid_Response_TravelRestrictions",
                    "Covid_Response_BusinessClosures",
                    "Covid_Response_IsolationCenters"), .after=last_col())
    
head(data[5, 227:232])
```

```{r, echo=FALSE}
#creating an additive Hardship Index variable- factor
data$ResponseIndex <-rowSums(data[,c(228:232)])          
descr(data$ResponseIndex)

cronbach.alpha((data[,c(228:232)])) #Assessing the internal consistency of our hardship index variables

Figure <- ggplot(data, aes(x =`ResponseIndex`, y = (..count..)/sum(..count..), fill = factor(`ResponseIndex`))) +
        geom_bar(color = "white") +
        geom_bar() +
        #coord_flip()+
        scale_x_continuous(name="Number of Government Responses to COVID-19", breaks=seq(0,9,1)) +
        xlab("Response Index") +
        scale_fill_viridis_d(direction = -1) +
        scale_y_continuous(labels = scales::percent, name = "Proportion") +
        #theme(axis.text.x = element_text(hjust = 1)) +
        theme(legend.position = "none") + # No need for a legend but add a title
        theme(axis.text.x = element_text(size =12, color = "black"),
              axis.text.y = element_text(size =12, color = "black"),
              axis.title.y = element_text(size=15, color = "black"),
              axis.title.x = element_text(size=15, color = "black")) +
        ggtitle("")
Figure
pdf("../Figures/Barriers Index/Proportions of Households by Response Index.pdf", width = 6, height = 3.5)
Figure
dev.off()

#Bar chart of counts by all hardship indicators
hardships <- NULL
hardships$factors <- factor(c("Covid_Response_HomeStay",
                              #"Covid_Response_Gathering",
                              "Covid_Response_Lockdown",
                              "Covid_Response_TravelRestrictions",
                              "Covid_Response_BusinessClosures",
                              "Covid_Response_IsolationCenters"))

hardships$values <-  c(548/880*100,
                       #662/880*100,
                       378/880*100,
                       406/880*100,
                       419/880*100,
                       383/880*100)

hardships <- as.data.frame(hardships)

hardships$factors <- factor(hardships$factors, levels = c("Covid_Response_HomeStay",
                                                          #"Covid_Response_Gathering",
                                                          "Covid_Response_Lockdown",
                                                          "Covid_Response_TravelRestrictions",
                                                          "Covid_Response_BusinessClosures",
                                                          "Covid_Response_IsolationCenters"))
hardships
levels(hardships$factors)

Figure <- ggplot(hardships, aes(x = factors, y = values, fill = factors, label = values)) +
  geom_bar(stat="identity", color = "white") +
  geom_bar(stat="identity") +
  coord_flip()+
  scale_fill_viridis_d() +
  scale_x_discrete("", limits = rev(levels(hardships$factors)), labels = c("Isolation Centers",
                                                                           "Business Closures",
                                                                           "Travel Restrictions",
                                                                           "Lockdown",
                                                                           #"Avoid Gatherings",
                                                                           "Stay at Home")) +
  scale_y_continuous("Percent of Households") +
  theme(legend.position = "none") +
  #theme(axis.text.x = element_text(angle = 45, hjust = 1)) +
  theme(axis.text.x = element_text(size =12, color = "black"),
        axis.text.y = element_text(size =12, color = "black"),
        axis.title.y = element_text(size=15, color = "black"),
        axis.title.x = element_text(size=15, color = "black")) +
  ggtitle("")

Figure
pdf("../Figures/Barriers Index/COVID-19 Response Index Composition.pdf", width = 6, height = 3.5)
Figure
dev.off()

data$responseindex = NULL
data$responseindex[data$ResponseIndex ==  0] <- 0
data$responseindex[data$ResponseIndex ==  1] <- 1
data$responseindex[data$ResponseIndex ==  2] <- 2
data$responseindex[data$ResponseIndex ==  3] <- 3
data$responseindex[data$ResponseIndex ==  4] <- 4
data$responseindex[data$ResponseIndex ==  5] <- 5
data$responseindex[data$ResponseIndex ==  6] <- 6
table(data$responseindex)

 data$`Government/Community Response` <- factor(data$responseindex)
#                     levels = c(1,2,3),
#                     labels = c("None", 
#                                "1-2", 
#                                "3-5"))
# 
# data$ResponseIndex <- factor(data$responseindex,
#                     levels = c(1,2,3),
#                     labels = c("None",
#                                "1-2",
#                                "3-5"))
# # 
# # data$ResponseIndex_1_V <- 0
# # data$ResponseIndex_1_V[data$`Government/Community Response` == "1 Intervention"] <- 1
# 
# data$ResponseIndex_2_V <- 0
# data$ResponseIndex_2_V[data$`Government/Community Response` == "1-2"] <- 1
# 
# data$ResponseIndex_3_V <- 0
# data$ResponseIndex_3_V[data$`Government/Community Response` == "3-5"] <- 1

# data$ResponseIndex_4_V <- 0
# data$ResponseIndex_4_V[data$`Government/Community Response` == "4 Interventions"] <- 1
# 
# data$ResponseIndex_5_V <- 0
# data$ResponseIndex_5_V[data$`Government/Community Response` == "5 Interventions"] <- 1

# data$responseindex = NULL
# data$responseindex[data$ResponseIndex ==  0] <- 0
# data$responseindex[data$ResponseIndex >=  1] <- 1
# table(data$responseindex)
# 
# data$`Government/Community Response` <- factor(data$responseindex,
#                     levels = c(0,1),
#                     labels = c("None", 
#                                "1+ Interventions"))
# 
# data$ResponseIndex <- factor(data$responseindex,
#                     levels = c(0,1),
#                     labels = c("None", 
#                                "1+ Interventions"))
# 
# data$ResponseIndex_1_V <- 0
# data$ResponseIndex_1_V[data$`Government/Community Response` == "1+ Interventions"] <- 1

```

*Response Index Creation: PCA Factor Analysis*

```{r, echo=FALSE}

pca.rotated <- data %>% #specify dply::select because MASS also has a select that will give you an error
  dplyr::select(c(
    "Covid_Response_HomeStay",
    "Covid_Response_Lockdown",
    "Covid_Response_TravelRestrictions",
    "Covid_Response_BusinessClosures",
    "Covid_Response_IsolationCenters"
    )) %>%

  # factor analysis with all hardship variables
  psych::principal(rotate="varimax", nfactors=3, scores=TRUE)

print(pca.rotated)

# subset to variables that loaded onto first factor
pca.rotated.1 <- data %>% 
  dplyr::select(c(
    "Covid_Response_HomeStay",
    "Covid_Response_Lockdown",
    "Covid_Response_TravelRestrictions",
    "Covid_Response_BusinessClosures",
    "Covid_Response_IsolationCenters"
  )) %>%

  # rerun factor analysis on subset
  psych::principal(rotate="varimax", nfactors=1, scores=TRUE)

dat.1 <- data %>%
  dplyr::select(c(
    "Covid_Response_HomeStay",
    "Covid_Response_Lockdown",
    "Covid_Response_TravelRestrictions",
    "Covid_Response_BusinessClosures",
    "Covid_Response_IsolationCenters",
    "responseindex"
  )) %>%
  
  mutate(
    'Lockdown Index' = 
      pca.rotated.1$loadings[1]*Covid_Response_HomeStay +
      pca.rotated.1$loadings[2]*Covid_Response_Lockdown +
      pca.rotated.1$loadings[3]*Covid_Response_TravelRestrictions +
      pca.rotated.1$loadings[4]*Covid_Response_BusinessClosures +
      pca.rotated.1$loadings[5]*Covid_Response_IsolationCenters,
    
    'Additive Index' = responseindex
    
  ) %>% 
  dplyr::select(c(
    `Lockdown Index`,
    `Additive Index`
    )) 

# add pca results to data
data <- cbind(data, dat.1)

summary(data$`Lockdown Index`)
class(data$`Lockdown Index`)
table(data$`Lockdown Index`)
data$LockdownIndex <- data$`Lockdown Index`
# Figure <- ggplot(data, aes(x =`Disruption Index`, y = (..count..)/sum(..count..), fill = factor(`Disruption Index`))) +
#         geom_bar(color = "white") +
#         geom_bar() +
#         xlab("Disruption Index") +
#         scale_fill_viridis_d(direction = -1) +
#         scale_y_continuous(labels = scales::percent, name = "Proportion") +
#         theme(axis.text.x = element_text(angle = 45, hjust = 1)) +
#         theme(legend.position = "none") + # No need for a legend but add a title
#         ggtitle("Proportions of Households by Disruption Index")
# Figure
# pdf("../Figures/Hardship Index/Proportions of Households by Disruption Index.pdf", width = 6, height = 5)
# Figure
# dev.off()

```

```{r, echo=FALSE}

data$CResponse_Lockdown <- NULL
data$CResponse_Lockdown[data$Covid_Response_Lockdown == 1]  <- 1
data$CResponse_Lockdown[data$Covid_Response_Lockdown == 0]  <- 0
data$`Lockdown (Covid Response)` <- factor(data$CResponse_Lockdown,
                    levels = c(0,1),
                    labels = c("No", "Yes"))

tab1(data$`Lockdown (Covid Response)`, sort.group = "decreasing", cum.percent = TRUE)

data$CResponse_Lockdown_V <- data$CResponse_Lockdown

data$CResponse_BusinessClosures <- NULL
data$CResponse_BusinessClosures[data$Covid_Response_BusinessClosures == 1]  <- 1
data$CResponse_BusinessClosures[data$Covid_Response_BusinessClosures == 0]  <- 0
data$`Business Closures (Covid Response)` <- factor(data$CResponse_BusinessClosures,
                    levels = c(0,1),
                    labels = c("No", "Yes"))

tab1(data$`Business Closures (Covid Response)`, sort.group = "decreasing", cum.percent = TRUE)

data$CResponse_BusinessClosures_V <- data$CResponse_BusinessClosures

data$CResponse_TravelRestrictions <- NULL
data$CResponse_TravelRestrictions[data$Covid_Response_TravelRestrictions == 1]  <- 1
data$CResponse_TravelRestrictions[data$Covid_Response_TravelRestrictions == 0]  <- 0
data$`Travel Restrictions (Covid Response)` <- factor(data$CResponse_TravelRestrictions,
                    levels = c(0,1),
                    labels = c("No", "Yes"))

tab1(data$`Travel Restrictions (Covid Response)`, sort.group = "decreasing", cum.percent = TRUE)

data$CResponse_TravelRestrictions_V <- data$CResponse_TravelRestrictions

data$CResponse_IsolationCenters <- NULL
data$CResponse_IsolationCenters[data$Covid_Response_IsolationCenters == 1]  <- 1
data$CResponse_IsolationCenters[data$Covid_Response_IsolationCenters == 0]  <- 0
data$`Isolation Centers (Covid Response)` <- factor(data$CResponse_IsolationCenters,
                    levels = c(0,1),
                    labels = c("No", "Yes"))

tab1(data$`Isolation Centers (Covid Response)`, sort.group = "decreasing", cum.percent = TRUE)

data$CResponse_IsolationCenters_V <- data$CResponse_IsolationCenters

```

**Analytics**

**Descriptive Statistics with Chi-square**

*Dependent Variable: Dichotomous Food Insecurity outcome variable*

```{r}
#Categorical Socio-demographic Variables
# Age Category
CrossTable(data$`Age (Household Head)`, data$`Urbanicity (Household)`, prop.r=FALSE, prop.c=FALSE,
           prop.t=FALSE, chisq = TRUE, format="SAS")

```

```{r}
#Categorical Socio-demographic Variables
# Age Category
CrossTable(data$`Sex (Household Head)`, data$`Urbanicity (Household)`, prop.r=FALSE, prop.c=FALSE,
           prop.t=FALSE, chisq = TRUE, format="SAS")

```

```{r}
#Categorical Socio-demographic Variables
# Age Category
CrossTable(data$`Ethnicity (Household Head)`, data$`Urbanicity (Household)`, prop.r=FALSE, prop.c=FALSE,
           prop.t=FALSE, chisq = TRUE, format="SAS")

```

```{r}
#Categorical Socio-demographic Variables
# Age Category
CrossTable(data$`Education (Household Head)`, data$`Urbanicity (Household)`, prop.r=FALSE, prop.c=FALSE,
           prop.t=FALSE, chisq = TRUE, format="SAS")

```

```{r}
#Categorical Socio-demographic Variables
# Age Category
CrossTable(data$`Occupation (Household Head)`, data$`Urbanicity (Household)`, prop.r=FALSE, prop.c=FALSE,
           prop.t=FALSE, chisq = TRUE, format="SAS")

```

```{r}
#Categorical Socio-demographic Variables
# Age Category
CrossTable(data$`Household Size`, data$`Urbanicity (Household)`, prop.r=FALSE, prop.c=FALSE,
           prop.t=FALSE, chisq = TRUE, format="SAS")

```

```{r}
#Categorical Socio-demographic Variables
# Age Category
CrossTable(data$`Children Under Age 5 (Household)`, data$`Urbanicity (Household)`, prop.r=FALSE, prop.c=FALSE,
           prop.t=FALSE, chisq = TRUE, format="SAS")

```

```{r}
#Categorical Socio-demographic Variables
# Age Category
CrossTable(data$`Adults Over Age 60 (Household)`, data$`Urbanicity (Household)`, prop.r=FALSE, prop.c=FALSE,
           prop.t=FALSE, chisq = TRUE, format="SAS")

```

```{r}
#Categorical Socio-demographic Variables
# Age Category
CrossTable(data$`Income (Household)`, data$`Urbanicity (Household)`, prop.r=FALSE, prop.c=FALSE,
           prop.t=FALSE, chisq = TRUE, format="SAS")

```

```{r}
#Categorical Socio-demographic Variables
# Age Category
CrossTable(data$`Wealth Index (Household)`, data$`Urbanicity (Household)`, prop.r=FALSE, prop.c=FALSE,
           prop.t=FALSE, chisq = TRUE, format="SAS")

```

```{r}
#Categorical Socio-demographic Variables
# Age Category
CrossTable(data$`Lockdown (Covid Response)`, data$`Urbanicity (Household)`, prop.r=FALSE, prop.c=FALSE,
           prop.t=FALSE, chisq = TRUE, format="SAS")

```

```{r}
#Categorical Socio-demographic Variables
# Age Category
CrossTable(data$`Business Closures (Covid Response)`, data$`Urbanicity (Household)`, prop.r=FALSE, prop.c=FALSE,
           prop.t=FALSE, chisq = TRUE, format="SAS")

```

```{r}
#Categorical Socio-demographic Variables
# Age Category
CrossTable(data$`Travel Restrictions (Covid Response)`, data$`Urbanicity (Household)`, prop.r=FALSE, prop.c=FALSE,
           prop.t=FALSE, chisq = TRUE, format="SAS")

```

```{r}
#Categorical Socio-demographic Variables
# Age Category
CrossTable(data$`Isolation Centers (Covid Response)`, data$`Urbanicity (Household)`, prop.r=FALSE, prop.c=FALSE,
           prop.t=FALSE, chisq = TRUE, format="SAS")

```

*Unadjusted associations with Hardships*

```{r}
#Categorical Socio-demographic Variables
# Age Category
Model1 <- glm(formula = HardshipIndex ~ `Age (Household Head)`,
             family = 'quasipoisson',
             data = data)
cat("Regression model:\n")
summary(Model1) 
Model1 
odds.ratios <- as.matrix(exp(coef(Model1)))
odds.ratios
plot1 <- forest_model(Model1)
plot1
```

```{r}
#Categorical Socio-demographic Variables
# Age Category
Model2 <- glm(formula = HardshipIndex ~ `Sex (Household Head)`,
             family = 'quasipoisson',
             data = data)
cat("Regression model:\n")
summary(Model2) 
odds.ratios <- as.matrix(exp(coef(Model2)))
odds.ratios
plot2 <- forest_model(Model2)
plot2
```

```{r}
#continuous socio-demographic variables
# Age
Model3 <- glm(formula = HardshipIndex ~ `Ethnicity (Household Head)`,
             family = 'quasipoisson',
             data = data)
cat("Regression model:\n")
summary(Model3) 
odds.ratios <- as.matrix(exp(coef(Model3)))
odds.ratios
plot3 <- forest_model(Model3)
plot3
```

```{r}
# Sex
Model4 <- glm(formula = HardshipIndex ~ `Religion (Household Head)`,
             family = 'quasipoisson',
             data = data)
cat("Regression model:\n")
summary(Model4) 
odds.ratios <- as.matrix(exp(coef(Model4)))
odds.ratios
plot4 <- forest_model(Model4)
plot4
```

```{r}
# Occupation
Model5 <- glm(formula = HardshipIndex ~ `Education (Household Head)`,
             family = 'quasipoisson',
             data = data)
cat("Regression model:\n")
summary(Model5)
odds.ratios <- as.matrix(exp(coef(Model5)))
odds.ratios
plot5 <- forest_model(Model5)
plot5
```

```{r}
# Education Level
Model6 <- glm(formula = HardshipIndex ~ `Occupation (Household Head)`,
             family = 'quasipoisson',
             data = data)
cat("Regression model:\n")
summary(Model6) 
odds.ratios <- as.matrix(exp(coef(Model6)))
odds.ratios
plot6 <- forest_model(Model6)
plot6
```


```{r}
# Urban Residence
Model7 <- glm(formula = HardshipIndex ~ `Residence (Household)`,
             family = 'quasipoisson',
             data = data)
cat("Regression model:\n")
summary(Model7) 
odds.ratios <- as.matrix(exp(coef(Model7)))
odds.ratios
plot7 <- forest_model(Model7)
plot7
```

```{r}
# HDSS Site
Model8 <- glm(formula = HardshipIndex ~ `Urbanicity (Household)`,
             family = 'quasipoisson',
             data = data)
cat("Regression model:\n")
summary(Model8) 
odds.ratios <- as.matrix(exp(coef(Model8)))
odds.ratios
plot8 <- forest_model(Model8)
plot8
```

```{r}
# Family number
Model9 <- glm(formula = HardshipIndex ~ `Household Size`,
             family = 'quasipoisson',
             data = data)
cat("Regression model:\n")
summary(Model9)
odds.ratios <- as.matrix(exp(coef(Model9)))
odds.ratios
plot9 <- forest_model(Model9)
plot9
```

```{r}
# Number of children under 5
Model10 <- glm(formula = HardshipIndex ~ `Children Under Age 5 (Household)`,
             family = 'quasipoisson',
             data = data)
cat("Regression model:\n")
summary(Model10) 
odds.ratios <- as.matrix(exp(coef(Model10)))
odds.ratios
plot10 <- forest_model(Model10)
plot10
```

```{r}
# Number of elderly people
Model11 <- glm(formula = HardshipIndex ~ `Adults Over Age 60 (Household)`,
             family = 'quasipoisson',
             data = data)
cat("Regression model:\n")
summary(Model11) 
odds.ratios <- as.matrix(exp(coef(Model11)))
odds.ratios
plot11 <- forest_model(Model11)
plot11
```

```{r, echo=FALSE, results='hide'}
# PreCOVID Food Insecurity
Model12 <- glm(formula = HardshipIndex ~ `Dependents (Household)`,
             family = 'quasipoisson',
             data = data)
cat("Regression model:\n")
summary(Model12) 
odds.ratios <- as.matrix(exp(coef(Model12)))
odds.ratios
plot12 <- forest_model(Model12)
```

```{r}
# Household Monthly Income
Model13<- glm(formula = HardshipIndex ~ HH_Monthly_Income,
             family = 'quasipoisson',
             data = data)
cat("Regression model:\n")
summary(Model13) 
odds.ratios <- as.matrix(exp(coef(Model13)))
odds.ratios
plot13 <- forest_model(Model13)
plot13
```

```{r}
# Household Monthly Income
Model13<- glm(formula = HardshipIndex ~ `Income (Household)`,
             family = 'quasipoisson',
             data = data)
cat("Regression model:\n")
summary(Model13) 
odds.ratios <- as.matrix(exp(coef(Model13)))
odds.ratios
plot13 <- forest_model(Model13)
plot13
```

```{r}
# Household Monthly Income
Model14 <- glm(formula = HardshipIndex ~ `Wealth Index (Household)`,
             family = 'quasipoisson',
             data = data)
cat("Regression model:\n")
summary(Model14) 
odds.ratios <- as.matrix(exp(coef(Model14)))
odds.ratios
plot14 <- forest_model(Model14)
plot14
```

```{r}
# Household Monthly Income
Model15 <- glm(formula = HardshipIndex ~ `Agricultural Land Ownership (Household)`,
             family = 'quasipoisson',
             data = data)
cat("Regression model:\n")
summary(Model15) 
odds.ratios <- as.matrix(exp(coef(Model15)))
odds.ratios
plot15 <- forest_model(Model15)
plot15
```

```{r}
# Household Monthly Income
Model15 <- glm(formula = HardshipIndex ~ `Lockdown (Covid Response)`,
             family = 'quasipoisson',
             data = data)
cat("Regression model:\n")
summary(Model15) 
odds.ratios <- as.matrix(exp(coef(Model15)))
odds.ratios
plot15 <- forest_model(Model15)
plot15
```

```{r}
# Household Monthly Income
Model16 <- glm(formula = HardshipIndex ~ `Travel Restrictions (Covid Response)`,
             family = 'quasipoisson',
             data = data)
cat("Regression model:\n")
summary(Model16) 
odds.ratios <- as.matrix(exp(coef(Model16)))
odds.ratios
plot16 <- forest_model(Model16)
plot16
```

```{r}
# Household Monthly Income
Model17 <- glm(formula = HardshipIndex ~ `Business Closures (Covid Response)`,
             family = 'quasipoisson',
             data = data)
cat("Regression model:\n")
summary(Model17) 
odds.ratios <- as.matrix(exp(coef(Model17)))
odds.ratios
plot17 <- forest_model(Model17)
plot17
```

```{r}
# Household Monthly Income
Model18 <- glm(formula = HardshipIndex ~ `Isolation Centers (Covid Response)`,
             family = 'quasipoisson',
             data = data)
cat("Regression model:\n")
summary(Model18) 
odds.ratios <- as.matrix(exp(coef(Model18)))
odds.ratios
plot18 <- forest_model(Model18)
plot18
```

```{r, echo=FALSE, results='hide'}
panels <- list(
  list(width = 0.01),
  list(width = 0.20, display = ~variable, fontface = "bold", heading = "Variable"),
  list(width = 0.18, display = ~level),
  list(width = 0.05, display = ~n, hjust = 1, heading = "n"),
  list(width = 0.01, item = "vline", hjust = 0.5),
  list(width = 0.30, item = "forest", hjust = 0.5, heading = "IRR", linetype = "dotted", color = "red", line_x = 0),
  list(width = 0.01, item = "vline", hjust = 0.5),
  list(width = 0.15, display = ~ ifelse(reference, "Reference", sprintf("%0.2f (%0.2f, %0.2f)", trans(estimate), trans(conf.low), trans(conf.high))), display_na = NA),
  #list(width = 0.05, display = ~ ifelse(reference, "", format.pval(p.value, digits = 1, eps = 0.001)), display_na = NA, hjust = 1, heading = "p"),
  list(width = 0.01)
)
```

```{r, echo=FALSE}
# Produce forest plots
model_list <- list(Model1, Model2, Model3, Model5, Model6, Model8, Model9, Model10, Model11, Model13, Model14, Model15, Model16, Model17, Model18)
bivariate_plots <- forest_model(model_list = model_list, exponentiate = TRUE, format_options = forest_model_format_options(colour = "black", color = NULL, shape = 18, text_size = 12, point_size = 1.25, banded = TRUE), panels = panels, merge_models = TRUE, factor_separate_line = TRUE, recalculate_width = FALSE, recalculate_height = TRUE, breaks = c(-0.69314718056, -0.28768207245, 0, 0.4054651081, 0.69314718056)) 
bivariate_plots <- bivariate_plots + theme(text = element_text(size = 6))
bivariate_plots <- bivariate_plots + geom_segment(x = 0, y = 0, xend = 0, yend = 60.4, linetype="solid", color = "darkred", size=0.5)
bivariate_plots
```

```{r, echo=FALSE, results='hide'}
pdf("../Figures/Odds Ratios/Unadjusted_Plots.pdf", width = 3.5, height = 4.75)
bivariate_plots
dev.off()
```

*What would be the best model to estimate household vulnerability to experiencing COVID-related hardship based on the given data on hand?*
```{r}

# all covariates
FinalModel1 <- glm(formula = HardshipIndex ~`Age (Household Head)` +
                                            `Sex (Household Head)`+
                                            `Ethnicity (Household Head)`+
                                            `Residence (Household)`+ 
                                            `Urbanicity (Household)`, family = 'quasipoisson', data = data)
 
# Print the regression model
summary(FinalModel1) 

```

```{r}
# all covariates
FinalModel2 <- glm(formula = HardshipIndex ~`Age (Household Head)` +
                                            `Sex (Household Head)` +
                                            `Ethnicity (Household Head)` +
                                            `Occupation (Household Head)`+ 
                                            `Education (Household Head)`+ 
                                            `Wealth Index (Household)` +
                                            `Income (Household)`, family = 'quasipoisson', data = data)
 
# Print the regression model
summary(FinalModel2) 
#dispersiontest(FinalModel2)

```

```{r}
# all covariates
FinalModel3 <- glm(formula = HardshipIndex ~  `Age (Household Head)` +
                                              `Sex (Household Head)` +
                                              `Ethnicity (Household Head)` +
                                              `Education (Household Head)` +
                                              `Occupation (Household Head)` + 
                                              `Urbanicity (Household)` +
                                              `Household Size` +
                                              `Adults Over Age 60 (Household)` +
                                              `Children Under Age 5 (Household)` +
                                              `Income (Household)`+
                                              `Wealth Index (Household)`, family = 'quasipoisson', data = data)
 
# Print the regression model
summary(FinalModel3) 
```

```{r}
# all covariates
FinalModel4 <- glm(formula = HardshipIndex ~  `Age (Household Head)` +
                                              `Sex (Household Head)` +
                                              `Ethnicity (Household Head)` +
                                              `Education (Household Head)` +
                                              `Occupation (Household Head)` + 
                                              #`Residence (Household)`+ 
                                              `Urbanicity (Household)` +
                                              `Household Size` +
                                              #`Dependents (Household)` +
                                              `Children Under Age 5 (Household)` +
                                              `Adults Over Age 60 (Household)` +
                                              `Income (Household)`+
                                              `Wealth Index (Household)`+
                                              `Lockdown (Covid Response)` +
                                              `Business Closures (Covid Response)` +
                                              `Travel Restrictions (Covid Response)` +
                                              `Isolation Centers (Covid Response)`, family = 'quasipoisson', data = data)
                                           
 
# Print the regression model
summary(FinalModel4)

```

```{r, echo=FALSE, results='hide'}
panels <- list(
  list(width = 0.01),
  list(width = 0.22, display = ~variable, fontface = "bold", heading = "Variable"),
  list(width = 0.16, display = ~level),
  #list(width = 0.05, display = ~n, hjust = 1, heading = "n"),
  list(width = 0.01, item = "vline", hjust = 0.5),
  list(width = 0.30, item = "forest", hjust = 0.5, heading = "AIRR", linetype = "dotted", color = "red", line_x = 0),
  list(width = 0.01, item = "vline", hjust = 0.5),
  list(width = 0.12, display = ~ ifelse(reference, "Reference", sprintf("%0.2f (%0.2f, %0.2f)", trans(estimate), trans(conf.low), trans(conf.high))), display_na = NA),
  #list(width = 0.05, display = ~ ifelse(reference, "", format.pval(p.value, digits = 1, eps = 0.001)), display_na = NA, hjust = 1, heading = "p"),
  list(width = 0.01)
)
```

```{r}
# Produce forest plots
model_list <- list(FinalModel4)
multivariate_plots <- forest_model(model_list = model_list, exponentiate = TRUE, format_options = forest_model_format_options(colour = "black", color = NULL, shape = 18, text_size = 12, point_size = 1.25, banded = TRUE), panels = panels, merge_models = TRUE, factor_separate_line = TRUE, recalculate_width = FALSE, recalculate_height = TRUE, breaks = c(-0.69314718056, -0.28768207245, 0, 0.4054651081, 0.69314718056)) 
multivariate_plots <- multivariate_plots + theme(text = element_text(size = 6))
multivariate_plots <- multivariate_plots + geom_segment(x = 0, y = 0, xend = 0, yend = 60.4, linetype="solid", color = "darkred", size=0.5)
multivariate_plots

cairo_pdf("../Figures/Odds Ratios/Adjusted_Plot.pdf", 
      width  = 3.35, 
      height = 4.75,
      fallback_resolution = 300,
      family = "serif"
      )
multivariate_plots
dev.off()

agg_tiff("../Figures/Odds Ratios/Adjusted_Plot.tiff", units="mm", width=85, height=120, res=300)
multivariate_plots
dev.off()

```

```{r}
# all covariates
FinalModel4 <- glm(formula = `Disruption Index` ~   `Age (Household Head)` +
                                              `Sex (Household Head)` +
                                              `Ethnicity (Household Head)` +
                                              `Education (Household Head)` +
                                              `Occupation (Household Head)` + 
                                              #`Residence (Household)`+ 
                                              `Urbanicity (Household)` +
                                              `Household Size` +
                                              #`Dependents (Household)` +
                                              `Children Under Age 5 (Household)` +
                                              `Adults Over Age 60 (Household)` +
                                              `Income (Household)`+
                                              `Wealth Index (Household)`+
                                              `Lockdown (Covid Response)` +
                                              `Business Closures (Covid Response)` +
                                              `Travel Restrictions (Covid Response)` +
                                              `Isolation Centers (Covid Response)`, family = 'quasipoisson', data = data)
 
# Print the regression model
summary(FinalModel4)

```

```{r}
# Produce forest plots
model_list <- list(FinalModel4)
multivariate_plots <- forest_model(model_list = model_list, exponentiate = TRUE, format_options = forest_model_format_options(colour = "black", color = NULL, shape = 18, text_size = 12, point_size = 1.25, banded = TRUE), panels = panels, merge_models = TRUE, factor_separate_line = TRUE, recalculate_width = FALSE, recalculate_height = TRUE, breaks = c(-1.38629436112, -0.69314718056, 0, 0.69314718056, 1.38629436112)) 
multivariate_plots <- multivariate_plots + theme(text = element_text(size = 6))
multivariate_plots <- multivariate_plots + geom_segment(x = 0, y = 0, xend = 0, yend = 60.4, linetype="solid", color = "darkred", size=0.5)
multivariate_plots

#pdf("../Figures/Odds Ratios/Disruption_Adjusted_Plot.pdf", width = 3.5, height = 4.75)
#multivariate_plots
#dev.off()

cairo_pdf("../Figures/Odds Ratios/Disruption_Adjusted_Plot.pdf", 
      width  = 3.35, 
      height = 4.75,
      fallback_resolution = 300,
      family = "serif"
      )
multivariate_plots
dev.off()

agg_tiff("../Figures/Odds Ratios/Disruption_Adjusted_Plot.tiff", units="mm", width=85, height=120, res=300)
multivariate_plots
dev.off()
```

```{r}
# all covariates
FinalModel4 <- glm(formula = `Inflation Index` ~    `Age (Household Head)` +
                                              `Sex (Household Head)` +
                                              `Ethnicity (Household Head)` +
                                              `Education (Household Head)` +
                                              `Occupation (Household Head)` + 
                                              #`Residence (Household)`+ 
                                              `Urbanicity (Household)` +
                                              `Household Size` +
                                              #`Dependents (Household)` +
                                              `Adults Over Age 60 (Household)` +
                                              `Children Under Age 5 (Household)` +
                                              `Income (Household)`+
                                              `Wealth Index (Household)`+
                                              `Lockdown (Covid Response)` +
                                              `Business Closures (Covid Response)` +
                                              `Travel Restrictions (Covid Response)` +
                                              `Isolation Centers (Covid Response)`, family = 'quasipoisson', data = data)
 
# Print the regression model
summary(FinalModel4)

```

```{r}
# Produce forest plots
model_list <- list(FinalModel4)
multivariate_plots <- forest_model(model_list = model_list, exponentiate = TRUE, format_options = forest_model_format_options(colour = "black", color = NULL, shape = 18, text_size = 12, point_size = 1.25, banded = TRUE), panels = panels, merge_models = TRUE, factor_separate_line = TRUE, recalculate_width = FALSE, recalculate_height = TRUE) 
multivariate_plots <- multivariate_plots + theme(text = element_text(size = 6))
multivariate_plots <- multivariate_plots + geom_segment(x = 0, y = 0, xend = 0, yend = 44.5, linetype="solid", color = "darkred", size=0.5)
multivariate_plots

pdf("../Figures/Odds Ratios/Inflation Multivariate_Plot.pdf", width = 3.25, height = 4.755)
multivariate_plots
dev.off()
```

*Multivariate Associations of Food Insecurity*

```{r, echo=FALSE, results='hide'}
panels <- list(
  list(width = 0.01),
  list(width = 0.20, display = ~variable, fontface = "bold", heading = "Variable"),
  list(width = 0.18, display = ~level),
  list(width = 0.05, display = ~n, hjust = 1, heading = "n"),
  list(width = 0.01, item = "vline", hjust = 0.5),
  list(width = 0.30, item = "forest", hjust = 0.5, heading = "AIRR", linetype = "dotted", color = "red", line_x = 0),
  list(width = 0.01, item = "vline", hjust = 0.5),
  list(width = 0.15, display = ~ ifelse(reference, "Reference", sprintf("%0.2f (%0.2f, %0.2f)", trans(estimate), trans(conf.low), trans(conf.high))), display_na = NA),
  #list(width = 0.05, display = ~ ifelse(reference, "", format.pval(p.value, digits = 1, eps = 0.001)), display_na = NA, hjust = 1, heading = "p"),
  list(width = 0.01)
)
```

```{r}
# all covariates
FinalModel4 <- glm(formula = COVID_Food_Insecurity ~    `Age (Household Head)` +
                                                        `Sex (Household Head)` +
                                                        `Ethnicity (Household Head)` +
                                                        `Education (Household Head)` +
                                                        `Occupation (Household Head)` + 
                                                        `Urbanicity (Household)` +
                                                        `Household Size` +
                                                        `Dependents (Household)` +
                                                        `Income (Household)`+
                                                        `Wealth Index (Household)`+
                                                        `Job Loss (Household)` +
                                              `Lockdown (Covid Response)` +
                                              `Business Closures (Covid Response)` +
                                              `Travel Restrictions (Covid Response)` +
                                              `Isolation Centers (Covid Response)`, family = binomial, data = data)
 
# Print the regression model
summary(FinalModel4)
```

```{r}
# Produce forest plots
model_list <- list(FinalModel4)
multivariate_plots <- forest_model(model_list = model_list, exponentiate = TRUE, format_options = forest_model_format_options(colour = "black", color = NULL, shape = 18, text_size = 12, point_size = 1.25, banded = TRUE), panels = panels, merge_models = TRUE, factor_separate_line = TRUE, recalculate_width = FALSE, recalculate_height = TRUE) 
multivariate_plots <- multivariate_plots + theme(text = element_text(size = 6))
multivariate_plots <- multivariate_plots + geom_segment(x = 0, y = 0, xend = 0, yend = 54.4, linetype="solid", color = "darkred", size=0.5)
multivariate_plots

pdf("../Figures/Odds Ratios/Multivariate Food Security Check_Plot.pdf", width = 3.5, height = 4.75)
multivariate_plots
dev.off()
```

```{r}
# all covariates
FinalModel4 <- glm(formula = Food_Price_Increase   ~    `Age (Household Head)` +
                                              `Sex (Household Head)` +
                                              `Ethnicity (Household Head)` +
                                              `Education (Household Head)` +
                                              `Occupation (Household Head)` + 
                                              #`Residence (Household)`+ 
                                              `Urbanicity (Household)` +
                                              `Household Size` +
                                              #`Dependents (Household)` +
                                              `Adults Over Age 60 (Household)` +
                                              `Children Under Age 5 (Household)` +
                                              `Income (Household)`+
                                              `Wealth Index (Household)`+
                                              `Lockdown (Covid Response)` +
                                              `Business Closures (Covid Response)` +
                                              `Travel Restrictions (Covid Response)` +
                                              `Isolation Centers (Covid Response)`, family = binomial, data = data)
 
# Print the regression model
summary(FinalModel4)
```

```{r}
# Produce forest plots
model_list <- list(FinalModel4)
multivariate_plots <- forest_model(model_list = model_list, exponentiate = TRUE, format_options = forest_model_format_options(colour = "black", color = NULL, shape = 18, text_size = 12, point_size = 1.25, banded = TRUE), panels = panels, merge_models = TRUE, factor_separate_line = TRUE, recalculate_width = FALSE, recalculate_height = TRUE) 
multivariate_plots <- multivariate_plots + theme(text = element_text(size = 6))
multivariate_plots <- multivariate_plots + geom_segment(x = 0, y = 0, xend = 0, yend = 54.4, linetype="solid", color = "darkred", size=0.5)
multivariate_plots

pdf("../Figures/Odds Ratios/Multivariate Food Price Increase_Plot.pdf", width = 3.5, height = 4.75)
multivariate_plots
dev.off()
```

```{r}
# all covariates
FinalModel4 <- glm(formula = Job_Loss              ~    `Age (Household Head)` +
                                              `Sex (Household Head)` +
                                              `Ethnicity (Household Head)` +
                                              `Education (Household Head)` +
                                              `Occupation (Household Head)` + 
                                              #`Residence (Household)`+ 
                                              `Urbanicity (Household)` +
                                              `Household Size` +
                                              #`Dependents (Household)` +
                                              `Adults Over Age 60 (Household)` +
                                              `Children Under Age 5 (Household)` +
                                              `Income (Household)`+
                                              `Wealth Index (Household)`+
                                              `Lockdown (Covid Response)` +
                                              `Business Closures (Covid Response)` +
                                              `Travel Restrictions (Covid Response)` +
                                              `Isolation Centers (Covid Response)`, family = binomial, data = data)
 
# Print the regression model
summary(FinalModel4)
```

```{r}
# Produce forest plots
model_list <- list(FinalModel4)
multivariate_plots <- forest_model(model_list = model_list, exponentiate = TRUE, format_options = forest_model_format_options(colour = "black", color = NULL, shape = 18, text_size = 12, point_size = 1.25, banded = TRUE), panels = panels, merge_models = TRUE, factor_separate_line = TRUE, recalculate_width = FALSE, recalculate_height = TRUE) 
multivariate_plots <- multivariate_plots + theme(text = element_text(size = 6))
multivariate_plots <- multivariate_plots + geom_segment(x = 0, y = 0, xend = 0, yend = 54.4, linetype="solid", color = "darkred", size=0.5)
multivariate_plots

pdf("../Figures/Odds Ratios/Multivariate Job Loss_Plot.pdf", width = 3.5, height = 4.75)
multivariate_plots
dev.off()
```

```{r}
# all covariates
FinalModel4 <- glm(formula = Nonfarm_Business_Closure ~ `Age (Household Head)` +
                                              `Sex (Household Head)` +
                                              `Ethnicity (Household Head)` +
                                              `Education (Household Head)` +
                                              `Occupation (Household Head)` + 
                                              #`Residence (Household)`+ 
                                              `Urbanicity (Household)` +
                                              `Household Size` +
                                              #`Dependents (Household)` +
                                              `Adults Over Age 60 (Household)` +
                                              `Children Under Age 5 (Household)` +
                                              `Income (Household)`+
                                              `Wealth Index (Household)`+
                                              `Lockdown (Covid Response)` +
                                              `Business Closures (Covid Response)` +
                                              `Travel Restrictions (Covid Response)` +
                                              `Isolation Centers (Covid Response)`, family = binomial, data = data)
 
# Print the regression model
summary(FinalModel4)
```

```{r}
# Produce forest plots
model_list <- list(FinalModel4)
multivariate_plots <- forest_model(model_list = model_list, exponentiate = TRUE, format_options = forest_model_format_options(colour = "black", color = NULL, shape = 18, text_size = 12, point_size = 1.25, banded = TRUE), panels = panels, merge_models = TRUE, factor_separate_line = TRUE, recalculate_width = FALSE, recalculate_height = TRUE) 
multivariate_plots <- multivariate_plots + theme(text = element_text(size = 6))
multivariate_plots <- multivariate_plots + geom_segment(x = 0, y = 0, xend = 0, yend = 54.4, linetype="solid", color = "darkred", size=0.5)
multivariate_plots

pdf("../Figures/Odds Ratios/Multivariate Business Closure_Plot.pdf", width = 3.5, height = 4.75)
multivariate_plots
dev.off()
```

```{r}
# all covariates
FinalModel4 <- glm(formula = Farm_Disruption    ~       `Age (Household Head)` +
                                              `Sex (Household Head)` +
                                              `Ethnicity (Household Head)` +
                                              `Education (Household Head)` +
                                              `Occupation (Household Head)` + 
                                              #`Residence (Household)`+ 
                                              `Urbanicity (Household)` +
                                              `Household Size` +
                                              #`Dependents (Household)` +
                                              `Adults Over Age 60 (Household)` +
                                              `Children Under Age 5 (Household)` +
                                              `Income (Household)`+
                                              `Wealth Index (Household)`+
                                              `Lockdown (Covid Response)` +
                                              `Business Closures (Covid Response)` +
                                              `Travel Restrictions (Covid Response)` +
                                              `Isolation Centers (Covid Response)`, family = binomial, data = data)
 
# Print the regression model
summary(FinalModel4)
```

```{r}
# Produce forest plots
model_list <- list(FinalModel4)
multivariate_plots <- forest_model(model_list = model_list, exponentiate = TRUE, format_options = forest_model_format_options(colour = "black", color = NULL, shape = 18, text_size = 12, point_size = 1.25, banded = TRUE), panels = panels, merge_models = TRUE, factor_separate_line = TRUE, recalculate_width = FALSE, recalculate_height = TRUE) 
multivariate_plots <- multivariate_plots + theme(text = element_text(size = 6))
multivariate_plots <- multivariate_plots + geom_segment(x = 0, y = 0, xend = 0, yend = 54.4, linetype="solid", color = "darkred", size=0.5)
multivariate_plots

pdf("../Figures/Odds Ratios/Multivariate Farm Disruption_Plot.pdf", width = 3.5, height = 4.75)
multivariate_plots
dev.off()
```

```{r}
# all covariates
FinalModel4 <- glm(formula = Livestock_Disruption    ~  `Age (Household Head)` +
                                              `Sex (Household Head)` +
                                              `Ethnicity (Household Head)` +
                                              `Education (Household Head)` +
                                              `Occupation (Household Head)` + 
                                              #`Residence (Household)`+ 
                                              `Urbanicity (Household)` +
                                              `Household Size` +
                                              #`Dependents (Household)` +
                                              `Adults Over Age 60 (Household)` +
                                              `Children Under Age 5 (Household)` +
                                              `Income (Household)`+
                                              `Wealth Index (Household)`+
                                              `Lockdown (Covid Response)` +
                                              `Business Closures (Covid Response)` +
                                              `Travel Restrictions (Covid Response)` +
                                              `Isolation Centers (Covid Response)`, family = binomial, data = data)
 
# Print the regression model
summary(FinalModel4)
```

```{r}
# Produce forest plots
model_list <- list(FinalModel4)
multivariate_plots <- forest_model(model_list = model_list, exponentiate = TRUE, format_options = forest_model_format_options(colour = "black", color = NULL, shape = 18, text_size = 12, point_size = 1.25, banded = TRUE), panels = panels, merge_models = TRUE, factor_separate_line = TRUE, recalculate_width = FALSE, recalculate_height = TRUE) 
multivariate_plots <- multivariate_plots + theme(text = element_text(size = 6))
multivariate_plots <- multivariate_plots + geom_segment(x = 0, y = 0, xend = 0, yend = 54.4, linetype="solid", color = "darkred", size=0.5)
multivariate_plots

pdf("../Figures/Odds Ratios/Multivariate Livestock Disruption_Plot.pdf", width = 3.5, height = 4.75)
multivariate_plots
dev.off()
```

```{r}
# all covariates
FinalModel4 <- glm(formula = Fishing_Disruption    ~    `Age (Household Head)` +
                                              `Sex (Household Head)` +
                                              `Ethnicity (Household Head)` +
                                              `Education (Household Head)` +
                                              `Occupation (Household Head)` + 
                                              #`Residence (Household)`+ 
                                              `Urbanicity (Household)` +
                                              `Household Size` +
                                              #`Dependents (Household)` +
                                              `Adults Over Age 60 (Household)` +
                                              `Children Under Age 5 (Household)` +
                                              `Income (Household)`+
                                              `Wealth Index (Household)`+
                                              `Lockdown (Covid Response)` +
                                              `Business Closures (Covid Response)` +
                                              `Travel Restrictions (Covid Response)` +
                                              `Isolation Centers (Covid Response)`, family = binomial, data = data)
 
# Print the regression model
summary(FinalModel4)
```

```{r}
# Produce forest plots
model_list <- list(FinalModel4)
multivariate_plots <- forest_model(model_list = model_list, exponentiate = TRUE, format_options = forest_model_format_options(colour = "black", color = NULL, shape = 18, text_size = 12, point_size = 1.25, banded = TRUE), panels = panels, merge_models = TRUE, factor_separate_line = TRUE, recalculate_width = FALSE, recalculate_height = TRUE) 
multivariate_plots <- multivariate_plots + theme(text = element_text(size = 6))
multivariate_plots <- multivariate_plots + geom_segment(x = 0, y = 0, xend = 0, yend = 54.4, linetype="solid", color = "darkred", size=0.5)
multivariate_plots

pdf("../Figures/Odds Ratios/Multivariate Fishing Disruption_Plot.pdf", width = 3.5, height = 4.75)
multivariate_plots
dev.off()
```

```{r}
# all covariates
FinalModel4 <- glm(formula = Input_Inflation    ~       `Age (Household Head)` +
                                              `Sex (Household Head)` +
                                              `Ethnicity (Household Head)` +
                                              `Education (Household Head)` +
                                              `Occupation (Household Head)` + 
                                              #`Residence (Household)`+ 
                                              `Urbanicity (Household)` +
                                              `Household Size` +
                                              #`Dependents (Household)` +
                                              `Adults Over Age 60 (Household)` +
                                              `Children Under Age 5 (Household)` +
                                              `Income (Household)`+
                                              `Wealth Index (Household)`+
                                              `Lockdown (Covid Response)` +
                                              `Business Closures (Covid Response)` +
                                              `Travel Restrictions (Covid Response)` +
                                              `Isolation Centers (Covid Response)`, family = binomial, data = data)
 
# Print the regression model
summary(FinalModel4)
```

```{r}
# Produce forest plots
model_list <- list(FinalModel4)
multivariate_plots <- forest_model(model_list = model_list, exponentiate = TRUE, format_options = forest_model_format_options(colour = "black", color = NULL, shape = 18, text_size = 12, point_size = 1.25, banded = TRUE), panels = panels, merge_models = TRUE, factor_separate_line = TRUE, recalculate_width = FALSE, recalculate_height = TRUE) 
multivariate_plots <- multivariate_plots + theme(text = element_text(size = 6))
multivariate_plots <- multivariate_plots + geom_segment(x = 0, y = 0, xend = 0, yend = 54.4, linetype="solid", color = "darkred", size=0.5)
multivariate_plots

pdf("../Figures/Odds Ratios/Multivariate Input Inflation_Plot.pdf", width = 3.5, height = 4.75)
multivariate_plots
dev.off()
```

```{r}
# all covariates
FinalModel4 <- glm(formula = Output_Deflation    ~      `Age (Household Head)` +
                                              `Sex (Household Head)` +
                                              `Ethnicity (Household Head)` +
                                              `Education (Household Head)` +
                                              `Occupation (Household Head)` + 
                                              #`Residence (Household)`+ 
                                              `Urbanicity (Household)` +
                                              `Household Size` +
                                              #`Dependents (Household)` +
                                              `Adults Over Age 60 (Household)` +
                                              `Children Under Age 5 (Household)` +
                                              `Income (Household)`+
                                              `Wealth Index (Household)`+
                                              `Lockdown (Covid Response)` +
                                              `Business Closures (Covid Response)` +
                                              `Travel Restrictions (Covid Response)` +
                                              `Isolation Centers (Covid Response)`, family = binomial, data = data)
 
# Print the regression model
summary(FinalModel4)
```

```{r}
# Produce forest plots
model_list <- list(FinalModel4)
multivariate_plots <- forest_model(model_list = model_list, exponentiate = TRUE, format_options = forest_model_format_options(colour = "black", color = NULL, shape = 18, text_size = 12, point_size = 1.25, banded = TRUE), panels = panels, merge_models = TRUE, factor_separate_line = TRUE, recalculate_width = FALSE, recalculate_height = TRUE) 
multivariate_plots <- multivariate_plots + theme(text = element_text(size = 6))
multivariate_plots <- multivariate_plots + geom_segment(x = 0, y = 0, xend = 0, yend = 54.4, linetype="solid", color = "darkred", size=0.5)
multivariate_plots

pdf("../Figures/Odds Ratios/Multivariate Output Deflation_Plot.pdf", width = 3.5, height = 4.75)
multivariate_plots
dev.off()
```

```{r}
# Check interaction models - effect modification

InteractionModel <- glm(formula = HardshipIndex ~ `Age (Household Head)` +
                                                  `Sex (Household Head)` +
                                                  `Ethnicity (Household Head)` +
                                                  `Education (Household Head)` +
                                                  `Occupation (Household Head)` + 
                                                  `Urbanicity (Household)` +
                                                  `Household Size` +
                                                  `Dependents (Household)` +
                                                  `Income (Household)`+
                                                  `Wealth Index (Household)` +
                                                  `Lockdown (Covid Response)` +
                                                  `Business Closures (Covid Response)` +
                                                  `Travel Restrictions (Covid Response)` +
                                                  `Isolation Centers (Covid Response)` +
                                                  `Age (Household Head)`*`Urbanicity (Household)`, family = 'quasipoisson', data = data)

# Print the regression model
summary(InteractionModel)

InteractionModel <- glm(formula = HardshipIndex ~ `Age (Household Head)` +
                                                  `Sex (Household Head)` +
                                                  `Ethnicity (Household Head)` +
                                                  `Education (Household Head)` +
                                                  `Occupation (Household Head)` + 
                                                  `Urbanicity (Household)` +
                                                  `Household Size` +
                                                  `Dependents (Household)` +
                                                  `Income (Household)`+
                                                  `Wealth Index (Household)` +
                                                  `Lockdown (Covid Response)` +
                                                  `Business Closures (Covid Response)` +
                                                  `Travel Restrictions (Covid Response)` +
                                                  `Isolation Centers (Covid Response)` +
                                                  `Sex (Household Head)`*`Urbanicity (Household)`, family = 'quasipoisson', data = data)

# Print the regression model
summary(InteractionModel)

InteractionModel <- glm(formula = HardshipIndex ~ `Age (Household Head)` +
                                                  `Sex (Household Head)` +
                                                  `Ethnicity (Household Head)` +
                                                  `Education (Household Head)` +
                                                  `Occupation (Household Head)` + 
                                                  `Urbanicity (Household)` +
                                                  `Household Size` +
                                                  `Dependents (Household)` +
                                                  `Income (Household)`+
                                                  `Wealth Index (Household)` +
                                                  `Lockdown (Covid Response)` +
                                                  `Business Closures (Covid Response)` +
                                                  `Travel Restrictions (Covid Response)` +
                                                  `Isolation Centers (Covid Response)` +
                                                  `Ethnicity (Household Head)`*`Urbanicity (Household)`, family = 'quasipoisson', data = data)

# Print the regression model
summary(InteractionModel)

InteractionModel <- glm(formula = HardshipIndex ~ `Age (Household Head)` +
                                                  `Sex (Household Head)` +
                                                  `Ethnicity (Household Head)` +
                                                  `Education (Household Head)` +
                                                  `Occupation (Household Head)` + 
                                                  `Urbanicity (Household)` +
                                                  `Household Size` +
                                                  `Dependents (Household)` +
                                                  `Income (Household)`+
                                                  `Wealth Index (Household)` +
                                                  `Lockdown (Covid Response)` +
                                                  `Business Closures (Covid Response)` +
                                                  `Travel Restrictions (Covid Response)` +
                                                  `Isolation Centers (Covid Response)` +
                                                  `Education (Household Head)`*`Urbanicity (Household)`, family = 'quasipoisson', data = data)

# Print the regression model
summary(InteractionModel)

InteractionModel <- glm(formula = HardshipIndex ~ `Age (Household Head)` +
                                                  `Sex (Household Head)` +
                                                  `Ethnicity (Household Head)` +
                                                  `Education (Household Head)` +
                                                  `Occupation (Household Head)` + 
                                                  `Urbanicity (Household)` +
                                                  `Household Size` +
                                                  `Dependents (Household)` +
                                                  `Income (Household)`+
                                                  `Wealth Index (Household)` +
                                                  `Lockdown (Covid Response)` +
                                                  `Business Closures (Covid Response)` +
                                                  `Travel Restrictions (Covid Response)` +
                                                  `Isolation Centers (Covid Response)` +
                                                  `Occupation (Household Head)`*`Urbanicity (Household)`, family = 'quasipoisson', data = data)

# Print the regression model
summary(InteractionModel)

InteractionModel <- glm(formula = HardshipIndex ~ `Age (Household Head)` +
                                                  `Sex (Household Head)` +
                                                  `Ethnicity (Household Head)` +
                                                  `Education (Household Head)` +
                                                  `Occupation (Household Head)` + 
                                                  `Urbanicity (Household)` +
                                                  `Household Size` +
                                                  `Dependents (Household)` +
                                                  `Income (Household)`+
                                                  `Wealth Index (Household)` +
                                                  `Lockdown (Covid Response)` +
                                                  `Business Closures (Covid Response)` +
                                                  `Travel Restrictions (Covid Response)` +
                                                  `Isolation Centers (Covid Response)` +
                                                  `Household Size`*`Urbanicity (Household)`, family = 'quasipoisson', data = data)

# Print the regression model
summary(InteractionModel)

InteractionModel <- glm(formula = HardshipIndex ~ `Age (Household Head)` +
                                                  `Sex (Household Head)` +
                                                  `Ethnicity (Household Head)` +
                                                  `Education (Household Head)` +
                                                  `Occupation (Household Head)` + 
                                                  `Urbanicity (Household)` +
                                                  `Household Size` +
                                                  `Dependents (Household)` +
                                                  `Income (Household)`+
                                                  `Wealth Index (Household)` +
                                                  `Lockdown (Covid Response)` +
                                                  `Business Closures (Covid Response)` +
                                                  `Travel Restrictions (Covid Response)` +
                                                  `Isolation Centers (Covid Response)` +
                                                  `Dependents (Household)`*`Urbanicity (Household)`, family = 'quasipoisson', data = data)

# Print the regression model
summary(InteractionModel)

InteractionModel <- glm(formula = HardshipIndex ~ `Age (Household Head)` +
                                                  `Sex (Household Head)` +
                                                  `Ethnicity (Household Head)` +
                                                  `Education (Household Head)` +
                                                  `Occupation (Household Head)` + 
                                                  `Urbanicity (Household)` +
                                                  `Household Size` +
                                                  `Dependents (Household)` +
                                                  `Income (Household)`+
                                                  `Wealth Index (Household)` +
                                                  `Lockdown (Covid Response)` +
                                                  `Business Closures (Covid Response)` +
                                                  `Travel Restrictions (Covid Response)` +
                                                  `Isolation Centers (Covid Response)` +
                                                  `Income (Household)`*`Urbanicity (Household)`, family = 'quasipoisson', data = data)

# Print the regression model
summary(InteractionModel)

InteractionModel <- glm(formula = HardshipIndex ~ `Age (Household Head)` +
                                                  `Sex (Household Head)` +
                                                  `Ethnicity (Household Head)` +
                                                  `Education (Household Head)` +
                                                  `Occupation (Household Head)` + 
                                                  `Urbanicity (Household)` +
                                                  `Household Size` +
                                                  `Dependents (Household)` +
                                                  `Income (Household)`+
                                                  `Wealth Index (Household)` +
                                                  `Lockdown (Covid Response)` +
                                                  `Business Closures (Covid Response)` +
                                                  `Travel Restrictions (Covid Response)` +
                                                  `Isolation Centers (Covid Response)` +
                                                  `Wealth Index (Household)`*`Urbanicity (Household)`, family = 'quasipoisson', data = data)

# Print the regression model
summary(InteractionModel)

InteractionModel <- glm(formula = HardshipIndex ~ `Age (Household Head)` +
                                                  `Sex (Household Head)` +
                                                  `Ethnicity (Household Head)` +
                                                  `Education (Household Head)` +
                                                  `Occupation (Household Head)` + 
                                                  `Urbanicity (Household)` +
                                                  `Household Size` +
                                                  `Dependents (Household)` +
                                                  `Income (Household)`+
                                                  `Wealth Index (Household)` +
                                                  `Lockdown (Covid Response)` +
                                                  `Business Closures (Covid Response)` +
                                                  `Travel Restrictions (Covid Response)` +
                                                  `Isolation Centers (Covid Response)` +
                                                  `Lockdown (Covid Response)`*`Urbanicity (Household)`, family = 'quasipoisson', data = data)

# Print the regression model
summary(InteractionModel)

InteractionModel <- glm(formula = HardshipIndex ~ `Age (Household Head)` +
                                                  `Sex (Household Head)` +
                                                  `Ethnicity (Household Head)` +
                                                  `Education (Household Head)` +
                                                  `Occupation (Household Head)` + 
                                                  `Urbanicity (Household)` +
                                                  `Household Size` +
                                                  `Dependents (Household)` +
                                                  `Income (Household)`+
                                                  `Wealth Index (Household)` +
                                                  `Lockdown (Covid Response)` +
                                                  `Business Closures (Covid Response)` +
                                                  `Travel Restrictions (Covid Response)` +
                                                  `Isolation Centers (Covid Response)` +
                                                  `Business Closures (Covid Response)`*`Urbanicity (Household)`, family = 'quasipoisson', data = data)

# Print the regression model
summary(InteractionModel)

InteractionModel <- glm(formula = HardshipIndex ~ `Age (Household Head)` +
                                                  `Sex (Household Head)` +
                                                  `Ethnicity (Household Head)` +
                                                  `Education (Household Head)` +
                                                  `Occupation (Household Head)` + 
                                                  `Urbanicity (Household)` +
                                                  `Household Size` +
                                                  `Dependents (Household)` +
                                                  `Income (Household)`+
                                                  `Wealth Index (Household)` +
                                                  `Lockdown (Covid Response)` +
                                                  `Business Closures (Covid Response)` +
                                                  `Travel Restrictions (Covid Response)` +
                                                  `Isolation Centers (Covid Response)` +
                                                  `Travel Restrictions (Covid Response)`*`Urbanicity (Household)`, family = 'quasipoisson', data = data)

# Print the regression model
summary(InteractionModel)

InteractionModel <- glm(formula = HardshipIndex ~ `Age (Household Head)` +
                                                  `Sex (Household Head)` +
                                                  `Ethnicity (Household Head)` +
                                                  `Education (Household Head)` +
                                                  `Occupation (Household Head)` + 
                                                  `Urbanicity (Household)` +
                                                  `Household Size` +
                                                  `Dependents (Household)` +
                                                  `Income (Household)`+
                                                  `Wealth Index (Household)` +
                                                  `Lockdown (Covid Response)` +
                                                  `Business Closures (Covid Response)` +
                                                  `Travel Restrictions (Covid Response)` +
                                                  `Isolation Centers (Covid Response)` +
                                                  `Isolation Centers (Covid Response)`*`Urbanicity (Household)`, family = 'quasipoisson', data = data)

# Print the regression model
summary(InteractionModel)
```

*Visualization of Multivariate Associations of Household Hardships with Interactions* 

We need to visualize interactions for Ethnicity, Education, Occupation, Household Size, Income, Wealth, Lockdown, Business Closures.

```{r, echo=FALSE}
tab1(data$HDSS, sort.group = "decreasing", cum.percent = TRUE)
tab1(data$`Urbanicity (Household)`, sort.group = "decreasing", cum.percent = TRUE)

data$HDSS_D <- NULL
data$HDSS_D <- factor(data$HDSS,
                    levels = c(1, 0),
                    labels = c("Urban (Harar)", "Rural (Kersa)"))
```

```{r, echo=FALSE}
VisualizationModel <- glm(formula = HardshipIndex ~ Age_2_V +
                                                    Age_3_V +
                                                    Age_4_V +
                                                    Sex_V +
                                                    Ethnicity_Other_V +
                                                    Education_V +
                                                    Occupation_Professional_V +
                                                    Occupation_Student_V + 
                                                    Occupation_DailyLaborer_V +
                                                    Occupation_OtherWork_V +
                                                    Occupation_Unemployed_V +
                                                    HDSS_D +
                                                    HouseholdSize_2_V +
                                                    HouseholdSize_3_V +
                                                    HouseholdSize_4_V +
                                                    HouseholdSize_5_V +
                                                    Children_Under_5_V +
                                                    Elderly_V +
                                                    Income_2_V +
                                                    Income_3_V +
                                                    Income_4_V +
                                                    WealthIndex_2_V +
                                                    WealthIndex_3_V +
                                                    WealthIndex_4_V +
                                                    WealthIndex_5_V +
                                                    CResponse_Lockdown_V +
                                                    CResponse_BusinessClosures_V +
                                                    CResponse_TravelRestrictions_V +
                                                    CResponse_IsolationCenters_V , family = 'quasipoisson', data = data)
 
# Print the regression model
summary(VisualizationModel)
```

```{r}
# Produce forest plots
model_list <- list(VisualizationModel)
multivariate_plots <- forest_model(model_list = model_list, exponentiate = TRUE, format_options = forest_model_format_options(colour = "black", color = NULL, shape = 18, text_size = 12, point_size = 1.25, banded = TRUE), panels = panels, merge_models = TRUE, factor_separate_line = TRUE, recalculate_width = FALSE, recalculate_height = TRUE) 
multivariate_plots <- multivariate_plots + theme(text = element_text(size = 6))
multivariate_plots <- multivariate_plots + geom_segment(x = 0, y = 0, xend = 0, yend = 54.4, linetype="solid", color = "darkred", size=0.5)
multivariate_plots

```

```{r, echo=FALSE}
# Obtain Predicted Values #
newdata2 <- with(data, data.frame(HardshipIndex,
                                  HDSS_D,
                                  Age_2_V=mean(Age_2_V, na.rm = TRUE),
                                  Age_3_V=mean(Age_3_V, na.rm = TRUE),
                                  Age_4_V=mean(Age_4_V, na.rm = TRUE),
                                  Sex_V=mean(Sex_V, na.rm = TRUE),
                                  Ethnicity_Other_V=mean(Ethnicity_Other_V, na.rm = TRUE),
                                  Education_V=mean(Education_V, na.rm = TRUE),
                                  Occupation_Professional_V=mean(Occupation_Professional_V, na.rm = TRUE),
                                  Occupation_Student_V=mean(Occupation_Student_V, na.rm = TRUE),
                                  Occupation_DailyLaborer_V=mean(Occupation_DailyLaborer_V, na.rm = TRUE),
                                  Occupation_OtherWork_V=mean(Occupation_OtherWork_V, na.rm = TRUE),
                                  Occupation_Unemployed_V=mean(Occupation_Unemployed_V, na.rm = TRUE),
                                  HouseholdSize_2_V=mean(HouseholdSize_2_V, na.rm = TRUE),
                                  HouseholdSize_3_V=mean(HouseholdSize_3_V, na.rm = TRUE),
                                  HouseholdSize_4_V=mean(HouseholdSize_4_V, na.rm = TRUE),
                                  HouseholdSize_5_V=mean(HouseholdSize_5_V, na.rm = TRUE),
                                  Children_Under_5_V=mean(Children_Under_5_V, na.rm = TRUE),
                                  Elderly_V=mean(Elderly_V, na.rm = TRUE),
                                  Income_2_V=mean(Income_2_V, na.rm = TRUE),
                                  Income_3_V=mean(Income_3_V, na.rm = TRUE),
                                  Income_4_V=mean(Income_4_V, na.rm = TRUE),
                                  WealthIndex_2_V=mean(WealthIndex_2_V, na.rm = TRUE),
                                  WealthIndex_3_V=mean(WealthIndex_3_V, na.rm = TRUE),
                                  WealthIndex_4_V=mean(WealthIndex_4_V, na.rm = TRUE),
                                  WealthIndex_5_V=mean(WealthIndex_5_V, na.rm = TRUE),
                                  CResponse_Lockdown_V=mean(CResponse_Lockdown_V, na.rm = TRUE),
                                  CResponse_BusinessClosures_V=mean(CResponse_BusinessClosures_V, na.rm = TRUE),
                                  CResponse_TravelRestrictions_V=mean(CResponse_TravelRestrictions_V, na.rm = TRUE),
                                  CResponse_IsolationCenters_V=mean(CResponse_IsolationCenters_V, na.rm = TRUE)
))

head(newdata2)
```

```{r, echo=FALSE}
newdata3 = NULL
newdata3 <- cbind(newdata2, predict(VisualizationModel, newdata = newdata2, type = c("link"), se.fit = TRUE))

# Obtain Confidence Intervals #
newdata3 <- within(newdata3, {
    PredictedProbability <- exp(fit)
    LL <- exp(fit - (1.96 * se.fit))
    UL <- exp(fit + (1.96 * se.fit))
})

head(newdata3)
newdata3 <- newdata3 %>% 
        drop_na(PredictedProbability)

head(newdata3)

df.HDSS <- newdata3[c("HDSS_D", "PredictedProbability", "LL", "UL")]
df.HDSS$Catchment <- df.HDSS$HDSS_D
df.HDSS$Factor <- "Urbanicity"
df.HDSS$Category <- fct_rev(df.HDSS$HDSS_D)
df.HDSS <- df.HDSS[c("Factor", "Category", "PredictedProbability", "LL", "UL", "Catchment")]
unique(df.HDSS)
```

```{r, echo=FALSE}
VisualizationModel <- glm(formula = HardshipIndex ~ Age_2_V +
                                                    Age_3_V +
                                                    Age_4_V +
                                                    Sex_V +
                                                    Ethnicity +
                                                    Education_V +
                                                    Occupation_Professional_V +
                                                    Occupation_Student_V + 
                                                    Occupation_DailyLaborer_V +
                                                    Occupation_OtherWork_V +
                                                    Occupation_Unemployed_V +
                                                    HDSS_D +
                                                    HouseholdSize_2_V +
                                                    HouseholdSize_3_V +
                                                    HouseholdSize_4_V +
                                                    HouseholdSize_5_V +
                                                    Children_Under_5_V +
                                                    Elderly_V +
                                                    Income_2_V +
                                                    Income_3_V +
                                                    Income_4_V +
                                                    WealthIndex_2_V +
                                                    WealthIndex_3_V +
                                                    WealthIndex_4_V +
                                                    WealthIndex_5_V +
                                                    CResponse_Lockdown_V +
                                                    CResponse_BusinessClosures_V +
                                                    CResponse_TravelRestrictions_V +
                                                    CResponse_IsolationCenters_V +
                                                    HDSS_D*Ethnicity, family = 'quasipoisson', data = data)
 
# Print the regression model
summary(VisualizationModel)
```

```{r, echo=FALSE}
# Obtain Predicted Values #
newdata2 <- with(data, data.frame(HardshipIndex,
                                  HDSS_D,
                                  Age_2_V=mean(Age_2_V, na.rm = TRUE),
                                  Age_3_V=mean(Age_3_V, na.rm = TRUE),
                                  Age_4_V=mean(Age_4_V, na.rm = TRUE),
                                  Sex_V=mean(Sex_V, na.rm = TRUE),
                                  Ethnicity,
                                  Education_V=mean(Education_V, na.rm = TRUE),
                                  Occupation_Professional_V=mean(Occupation_Professional_V, na.rm = TRUE),
                                  Occupation_Student_V=mean(Occupation_Student_V, na.rm = TRUE),
                                  Occupation_DailyLaborer_V=mean(Occupation_DailyLaborer_V, na.rm = TRUE),
                                  Occupation_OtherWork_V=mean(Occupation_OtherWork_V, na.rm = TRUE),
                                  Occupation_Unemployed_V=mean(Occupation_Unemployed_V, na.rm = TRUE),
                                  HouseholdSize_2_V=mean(HouseholdSize_2_V, na.rm = TRUE),
                                  HouseholdSize_3_V=mean(HouseholdSize_3_V, na.rm = TRUE),
                                  HouseholdSize_4_V=mean(HouseholdSize_4_V, na.rm = TRUE),
                                  HouseholdSize_5_V=mean(HouseholdSize_5_V, na.rm = TRUE),
                                  Children_Under_5_V=mean(Children_Under_5_V, na.rm = TRUE),
                                  Elderly_V=mean(Elderly_V, na.rm = TRUE),
                                  Income_2_V=mean(Income_2_V, na.rm = TRUE),
                                  Income_3_V=mean(Income_3_V, na.rm = TRUE),
                                  Income_4_V=mean(Income_4_V, na.rm = TRUE),
                                  WealthIndex_2_V=mean(WealthIndex_2_V, na.rm = TRUE),
                                  WealthIndex_3_V=mean(WealthIndex_3_V, na.rm = TRUE),
                                  WealthIndex_4_V=mean(WealthIndex_4_V, na.rm = TRUE),
                                  WealthIndex_5_V=mean(WealthIndex_5_V, na.rm = TRUE),
                                  CResponse_Lockdown_V=mean(CResponse_Lockdown_V, na.rm = TRUE),
                                  CResponse_BusinessClosures_V=mean(CResponse_BusinessClosures_V, na.rm = TRUE),
                                  CResponse_TravelRestrictions_V=mean(CResponse_TravelRestrictions_V, na.rm = TRUE),
                                  CResponse_IsolationCenters_V=mean(CResponse_IsolationCenters_V, na.rm = TRUE)
))

head(newdata2)
```

```{r, echo=FALSE}
newdata3 = NULL
newdata3 <- cbind(newdata2, predict(VisualizationModel, newdata = newdata2, type = c("link"), se.fit = TRUE))

# Obtain Confidence Intervals #
newdata3 <- within(newdata3, {
    PredictedProbability <- exp(fit)
    LL <- exp(fit - (1.96 * se.fit))
    UL <- exp(fit + (1.96 * se.fit))
})

head(newdata3)
newdata3 <- newdata3 %>% 
        drop_na(PredictedProbability)

head(newdata3)

df.Ethnicity <- newdata3[c("Ethnicity", "HDSS_D", "PredictedProbability", "LL", "UL")]
df.Ethnicity$Catchment <- df.Ethnicity$HDSS_D
df.Ethnicity$Factor <- "Ethnicity"
df.Ethnicity$Category <- fct_rev(df.Ethnicity$Ethnicity)
df.Ethnicity <- df.Ethnicity[c("Factor", "Category", "PredictedProbability", "LL", "UL", "Catchment")]
unique(df.Ethnicity)
```

```{r, echo=FALSE}

data$Education <- factor(data$Education,
                    levels = c(0, 1),
                    labels = c("Some Education", "No Education"))

VisualizationModel <- glm(formula = HardshipIndex ~ Age_2_V +
                                                    Age_3_V +
                                                    Age_4_V +
                                                    Sex_V +
                                                    Ethnicity_Other_V +
                                                    Education +
                                                    Occupation_Professional_V +
                                                    Occupation_Student_V + 
                                                    Occupation_DailyLaborer_V +
                                                    Occupation_OtherWork_V +
                                                    Occupation_Unemployed_V +
                                                    HDSS_D +
                                                    HouseholdSize_2_V +
                                                    HouseholdSize_3_V +
                                                    HouseholdSize_4_V +
                                                    HouseholdSize_5_V +
                                                    Children_Under_5_V +
                                                    Elderly_V +
                                                    Income_2_V +
                                                    Income_3_V +
                                                    Income_4_V +
                                                    WealthIndex_2_V +
                                                    WealthIndex_3_V +
                                                    WealthIndex_4_V +
                                                    WealthIndex_5_V +
                                                    CResponse_Lockdown_V +
                                                    CResponse_BusinessClosures_V +
                                                    CResponse_TravelRestrictions_V +
                                                    CResponse_IsolationCenters_V +
                                                    HDSS_D*Education, family = 'quasipoisson', data = data)
 
# Print the regression model
summary(VisualizationModel)
```

```{r, echo=FALSE}
# Obtain Predicted Values #
newdata2 <- with(data, data.frame(HardshipIndex,
                                  HDSS_D,
                                  Age_2_V=mean(Age_2_V, na.rm = TRUE),
                                  Age_3_V=mean(Age_3_V, na.rm = TRUE),
                                  Age_4_V=mean(Age_4_V, na.rm = TRUE),
                                  Sex_V=mean(Sex_V, na.rm = TRUE),
                                  Ethnicity_Other_V=mean(Ethnicity_Other_V, na.rm = TRUE),
                                  Education,
                                  Occupation_Professional_V=mean(Occupation_Professional_V, na.rm = TRUE),
                                  Occupation_Student_V=mean(Occupation_Student_V, na.rm = TRUE),
                                  Occupation_DailyLaborer_V=mean(Occupation_DailyLaborer_V, na.rm = TRUE),
                                  Occupation_OtherWork_V=mean(Occupation_OtherWork_V, na.rm = TRUE),
                                  Occupation_Unemployed_V=mean(Occupation_Unemployed_V, na.rm = TRUE),
                                  HouseholdSize_2_V=mean(HouseholdSize_2_V, na.rm = TRUE),
                                  HouseholdSize_3_V=mean(HouseholdSize_3_V, na.rm = TRUE),
                                  HouseholdSize_4_V=mean(HouseholdSize_4_V, na.rm = TRUE),
                                  HouseholdSize_5_V=mean(HouseholdSize_5_V, na.rm = TRUE),
                                  Children_Under_5_V=mean(Children_Under_5_V, na.rm = TRUE),
                                  Elderly_V=mean(Elderly_V, na.rm = TRUE),
                                  Income_2_V=mean(Income_2_V, na.rm = TRUE),
                                  Income_3_V=mean(Income_3_V, na.rm = TRUE),
                                  Income_4_V=mean(Income_4_V, na.rm = TRUE),
                                  WealthIndex_2_V=mean(WealthIndex_2_V, na.rm = TRUE),
                                  WealthIndex_3_V=mean(WealthIndex_3_V, na.rm = TRUE),
                                  WealthIndex_4_V=mean(WealthIndex_4_V, na.rm = TRUE),
                                  WealthIndex_5_V=mean(WealthIndex_5_V, na.rm = TRUE),
                                  CResponse_Lockdown_V=mean(CResponse_Lockdown_V, na.rm = TRUE),
                                  CResponse_BusinessClosures_V=mean(CResponse_BusinessClosures_V, na.rm = TRUE),
                                  CResponse_TravelRestrictions_V=mean(CResponse_TravelRestrictions_V, na.rm = TRUE),
                                  CResponse_IsolationCenters_V=mean(CResponse_IsolationCenters_V, na.rm = TRUE)
))

head(newdata2)
```

```{r, echo=FALSE}
newdata3 = NULL
newdata3 <- cbind(newdata2, predict(VisualizationModel, newdata = newdata2, type = c("link"), se.fit = TRUE))

# Obtain Confidence Intervals #
newdata3 <- within(newdata3, {
    PredictedProbability <- exp(fit)
    LL <- exp(fit - (1.96 * se.fit))
    UL <- exp(fit + (1.96 * se.fit))
})

head(newdata3)
newdata3 <- newdata3 %>% 
        drop_na(PredictedProbability)

head(newdata3)

df.Education <- newdata3[c("Education", "HDSS_D", "PredictedProbability", "LL", "UL")]
df.Education$Catchment <- df.Education$HDSS_D
df.Education$Factor <- "Education"
df.Education$Category <- fct_rev(df.Education$Education)
df.Education <- df.Education[c("Factor", "Category", "PredictedProbability", "LL", "UL", "Catchment")]
unique(df.Education)
```

```{r, echo=FALSE}
data$Occupation <- factor(data$Occupation,
                    levels = c(1,2,3,4,5,6),
                    labels = c("Farmer/Domestic", 
                               "Student", 
                               "Professional/Sales",
                               "Daily Laborer",
                               "Other Work",
                               "Unemployed/Retired"))

VisualizationModel <- glm(formula = HardshipIndex ~ Age_2_V +
                                                    Age_3_V +
                                                    Age_4_V +
                                                    Sex_V +
                                                    Ethnicity_Other_V +
                                                    Education_V +
                                                    Occupation +
                                                    HDSS_D +
                                                    HouseholdSize_2_V +
                                                    HouseholdSize_3_V +
                                                    HouseholdSize_4_V +
                                                    HouseholdSize_5_V +
                                                    Children_Under_5_V +
                                                    Elderly_V +
                                                    Income_2_V +
                                                    Income_3_V +
                                                    Income_4_V +
                                                    WealthIndex_2_V +
                                                    WealthIndex_3_V +
                                                    WealthIndex_4_V +
                                                    WealthIndex_5_V +
                                                    CResponse_Lockdown_V +
                                                    CResponse_BusinessClosures_V +
                                                    CResponse_TravelRestrictions_V +
                                                    CResponse_IsolationCenters_V +
                                                    HDSS_D*Occupation, family = 'quasipoisson', data = data)
 
# Print the regression model
summary(VisualizationModel)
```

```{r, echo=FALSE}
# Obtain Predicted Values #
newdata2 <- with(data, data.frame(HardshipIndex,
                                  HDSS_D,
                                  Age_2_V=mean(Age_2_V, na.rm = TRUE),
                                  Age_3_V=mean(Age_3_V, na.rm = TRUE),
                                  Age_4_V=mean(Age_4_V, na.rm = TRUE),
                                  Sex_V=mean(Sex_V, na.rm = TRUE),
                                  Ethnicity_Other_V=mean(Ethnicity_Other_V, na.rm = TRUE),
                                  Education_V=mean(Education_V, na.rm = TRUE),
                                  Occupation,
                                  HouseholdSize_2_V=mean(HouseholdSize_2_V, na.rm = TRUE),
                                  HouseholdSize_3_V=mean(HouseholdSize_3_V, na.rm = TRUE),
                                  HouseholdSize_4_V=mean(HouseholdSize_4_V, na.rm = TRUE),
                                  HouseholdSize_5_V=mean(HouseholdSize_5_V, na.rm = TRUE),
                                  Children_Under_5_V=mean(Children_Under_5_V, na.rm = TRUE),
                                  Elderly_V=mean(Elderly_V, na.rm = TRUE),
                                  Income_2_V=mean(Income_2_V, na.rm = TRUE),
                                  Income_3_V=mean(Income_3_V, na.rm = TRUE),
                                  Income_4_V=mean(Income_4_V, na.rm = TRUE),
                                  WealthIndex_2_V=mean(WealthIndex_2_V, na.rm = TRUE),
                                  WealthIndex_3_V=mean(WealthIndex_3_V, na.rm = TRUE),
                                  WealthIndex_4_V=mean(WealthIndex_4_V, na.rm = TRUE),
                                  WealthIndex_5_V=mean(WealthIndex_5_V, na.rm = TRUE),
                                  CResponse_Lockdown_V=mean(CResponse_Lockdown_V, na.rm = TRUE),
                                  CResponse_BusinessClosures_V=mean(CResponse_BusinessClosures_V, na.rm = TRUE),
                                  CResponse_TravelRestrictions_V=mean(CResponse_TravelRestrictions_V, na.rm = TRUE),
                                  CResponse_IsolationCenters_V=mean(CResponse_IsolationCenters_V, na.rm = TRUE)
))

head(newdata2)
```

```{r, echo=FALSE}
newdata3 = NULL
newdata3 <- cbind(newdata2, predict(VisualizationModel, newdata = newdata2, type = c("link"), se.fit = TRUE))

# Obtain Confidence Intervals #
newdata3 <- within(newdata3, {
    PredictedProbability <- exp(fit)
    LL <- exp(fit - (1.96 * se.fit))
    UL <- exp(fit + (1.96 * se.fit))
})

head(newdata3)
newdata3 <- newdata3 %>% 
        drop_na(PredictedProbability)

head(newdata3)

df.Occupation <- newdata3[c("Occupation", "HDSS_D", "PredictedProbability", "LL", "UL")]
df.Occupation$Catchment <- df.Occupation$HDSS_D
df.Occupation$Factor <- "Occupation"
df.Occupation$Category <- fct_rev(df.Occupation$Occupation)
df.Occupation <- df.Occupation[c("Factor", "Category", "PredictedProbability", "LL", "UL", "Catchment")]
unique(df.Occupation)
```

```{r, echo=FALSE}
data$HouseholdSize <- factor(data$HouseholdSize,
                    levels = c(1,2,3,4,5),
                    labels = c("1-2", "3-4", "5-6", "7-8", "9+"))

VisualizationModel <- glm(formula = HardshipIndex ~ Age_2_V +
                                                    Age_3_V +
                                                    Age_4_V +
                                                    Sex_V +
                                                    Ethnicity_Other_V +
                                                    Education_V +
                                                    Occupation_Professional_V +
                                                    Occupation_Student_V + 
                                                    Occupation_DailyLaborer_V +
                                                    Occupation_OtherWork_V +
                                                    Occupation_Unemployed_V +
                                                    HDSS_D +
                                                    HouseholdSize +
                                                    Elderly_V +
                                                    Income_2_V +
                                                    Income_3_V +
                                                    Income_4_V +
                                                    WealthIndex_2_V +
                                                    WealthIndex_3_V +
                                                    WealthIndex_4_V +
                                                    WealthIndex_5_V +
                                                    CResponse_Lockdown_V +
                                                    CResponse_BusinessClosures_V +
                                                    CResponse_TravelRestrictions_V +
                                                    CResponse_IsolationCenters_V +
                                                    HDSS_D*HouseholdSize, family = 'quasipoisson', data = data)
 
# Print the regression model
summary(VisualizationModel)
```

```{r, echo=FALSE}
# Obtain Predicted Values #
newdata2 <- with(data, data.frame(HardshipIndex,
                                  HDSS_D,
                                  Age_2_V=mean(Age_2_V, na.rm = TRUE),
                                  Age_3_V=mean(Age_3_V, na.rm = TRUE),
                                  Age_4_V=mean(Age_4_V, na.rm = TRUE),
                                  Sex_V=mean(Sex_V, na.rm = TRUE),
                                  Ethnicity_Other_V=mean(Ethnicity_Other_V, na.rm = TRUE),
                                  Education_V=mean(Education_V, na.rm = TRUE),
                                  Occupation_Professional_V=mean(Occupation_Professional_V, na.rm = TRUE),
                                  Occupation_Student_V=mean(Occupation_Student_V, na.rm = TRUE),
                                  Occupation_DailyLaborer_V=mean(Occupation_DailyLaborer_V, na.rm = TRUE),
                                  Occupation_OtherWork_V=mean(Occupation_OtherWork_V, na.rm = TRUE),
                                  Occupation_Unemployed_V=mean(Occupation_Unemployed_V, na.rm = TRUE),
                                  HouseholdSize,
                                  Children_Under_5_V=mean(Children_Under_5_V, na.rm = TRUE),
                                  Elderly_V=mean(Elderly_V, na.rm = TRUE),
                                  Income_2_V=mean(Income_2_V, na.rm = TRUE),
                                  Income_3_V=mean(Income_3_V, na.rm = TRUE),
                                  Income_4_V=mean(Income_4_V, na.rm = TRUE),
                                  WealthIndex_2_V=mean(WealthIndex_2_V, na.rm = TRUE),
                                  WealthIndex_3_V=mean(WealthIndex_3_V, na.rm = TRUE),
                                  WealthIndex_4_V=mean(WealthIndex_4_V, na.rm = TRUE),
                                  WealthIndex_5_V=mean(WealthIndex_5_V, na.rm = TRUE),
                                  CResponse_Lockdown_V=mean(CResponse_Lockdown_V, na.rm = TRUE),
                                  CResponse_BusinessClosures_V=mean(CResponse_BusinessClosures_V, na.rm = TRUE),
                                  CResponse_TravelRestrictions_V=mean(CResponse_TravelRestrictions_V, na.rm = TRUE),
                                  CResponse_IsolationCenters_V=mean(CResponse_IsolationCenters_V, na.rm = TRUE)
))

head(newdata2)
```

```{r, echo=FALSE}
newdata3 = NULL
newdata3 <- cbind(newdata2, predict(VisualizationModel, newdata = newdata2, type = c("link"), se.fit = TRUE))

# Obtain Confidence Intervals #
newdata3 <- within(newdata3, {
    PredictedProbability <- exp(fit)
    LL <- exp(fit - (1.96 * se.fit))
    UL <- exp(fit + (1.96 * se.fit))
})

head(newdata3)
newdata3 <- newdata3 %>% 
        drop_na(PredictedProbability)

head(newdata3)

df.HouseholdSize <- newdata3[c("HouseholdSize", "HDSS_D", "PredictedProbability", "LL", "UL")]
df.HouseholdSize$Catchment <- df.HouseholdSize$HDSS_D
df.HouseholdSize$Factor <- "Household \nSize"
df.HouseholdSize$Category <- fct_rev(df.HouseholdSize$HouseholdSize)
df.HouseholdSize <- df.HouseholdSize[c("Factor", "Category", "PredictedProbability", "LL", "UL", "Catchment")]
unique(df.HouseholdSize)
```


```{r, echo=FALSE}
VisualizationModel <- glm(formula = HardshipIndex ~ Age_2_V +
                                                    Age_3_V +
                                                    Age_4_V +
                                                    Sex_V +
                                                    Ethnicity_Other_V +
                                                    Education_V +
                                                    Occupation_Professional_V +
                                                    Occupation_Student_V + 
                                                    Occupation_DailyLaborer_V +
                                                    Occupation_OtherWork_V +
                                                    Occupation_Unemployed_V +
                                                    HDSS_D +
                                                    HouseholdSize_2_V +
                                                    HouseholdSize_3_V +
                                                    HouseholdSize_4_V +
                                                    HouseholdSize_5_V +
                                                    Elderly_V +
                                                    Income +
                                                    WealthIndex_2_V +
                                                    WealthIndex_3_V +
                                                    WealthIndex_4_V +
                                                    WealthIndex_5_V +
                                                    CResponse_Lockdown_V +
                                                    CResponse_BusinessClosures_V +
                                                    CResponse_TravelRestrictions_V +
                                                    CResponse_IsolationCenters_V +
                                                    HDSS_D*Income, family = 'quasipoisson', data = data)
 
# Print the regression model
summary(VisualizationModel)
```

```{r, echo=FALSE}
# Obtain Predicted Values #
newdata2 <- with(data, data.frame(HardshipIndex,
                                  HDSS_D,
                                  Age_2_V=mean(Age_2_V, na.rm = TRUE),
                                  Age_3_V=mean(Age_3_V, na.rm = TRUE),
                                  Age_4_V=mean(Age_4_V, na.rm = TRUE),
                                  Sex_V=mean(Sex_V, na.rm = TRUE),
                                  Ethnicity_Other_V=mean(Ethnicity_Other_V, na.rm = TRUE),
                                  Education_V=mean(Education_V, na.rm = TRUE),
                                  Occupation_Professional_V=mean(Occupation_Professional_V, na.rm = TRUE),
                                  Occupation_Student_V=mean(Occupation_Student_V, na.rm = TRUE),
                                  Occupation_DailyLaborer_V=mean(Occupation_DailyLaborer_V, na.rm = TRUE),
                                  Occupation_OtherWork_V=mean(Occupation_OtherWork_V, na.rm = TRUE),
                                  Occupation_Unemployed_V=mean(Occupation_Unemployed_V, na.rm = TRUE),
                                  HouseholdSize_2_V=mean(HouseholdSize_2_V, na.rm = TRUE),
                                  HouseholdSize_3_V=mean(HouseholdSize_3_V, na.rm = TRUE),
                                  HouseholdSize_4_V=mean(HouseholdSize_4_V, na.rm = TRUE),
                                  HouseholdSize_5_V=mean(HouseholdSize_5_V, na.rm = TRUE),
                                  Children_Under_5_V=mean(Children_Under_5_V, na.rm = TRUE),
                                  Elderly_V=mean(Elderly_V, na.rm = TRUE),
                                  Income,
                                  WealthIndex_2_V=mean(WealthIndex_2_V, na.rm = TRUE),
                                  WealthIndex_3_V=mean(WealthIndex_3_V, na.rm = TRUE),
                                  WealthIndex_4_V=mean(WealthIndex_4_V, na.rm = TRUE),
                                  WealthIndex_5_V=mean(WealthIndex_5_V, na.rm = TRUE),
                                  CResponse_Lockdown_V=mean(CResponse_Lockdown_V, na.rm = TRUE),
                                  CResponse_BusinessClosures_V=mean(CResponse_BusinessClosures_V, na.rm = TRUE),
                                  CResponse_TravelRestrictions_V=mean(CResponse_TravelRestrictions_V, na.rm = TRUE),
                                  CResponse_IsolationCenters_V=mean(CResponse_IsolationCenters_V, na.rm = TRUE)
))

head(newdata2)
```

```{r, echo=FALSE}
newdata3 = NULL
newdata3 <- cbind(newdata2, predict(VisualizationModel, newdata = newdata2, type = c("link"), se.fit = TRUE))

# Obtain Confidence Intervals #
newdata3 <- within(newdata3, {
    PredictedProbability <- exp(fit)
    LL <- exp(fit - (1.96 * se.fit))
    UL <- exp(fit + (1.96 * se.fit))
})

head(newdata3)
newdata3 <- newdata3 %>% 
        drop_na(PredictedProbability)

head(newdata3)

df.Income <- newdata3[c("Income", "HDSS_D", "PredictedProbability", "LL", "UL")]
df.Income$Catchment <- df.Income$HDSS_D
df.Income$Factor <- "Income"
df.Income$Category <- fct_rev(df.Income$Income)
df.Income <- df.Income[c("Factor", "Category", "PredictedProbability", "LL", "UL", "Catchment")]
unique(df.Income)
```

```{r, echo=FALSE}
VisualizationModel <- glm(formula = HardshipIndex ~ Age_2_V +
                                                    Age_3_V +
                                                    Age_4_V +
                                                    Sex_V +
                                                    Ethnicity_Other_V +
                                                    Education_V +
                                                    Occupation_Professional_V +
                                                    Occupation_Student_V + 
                                                    Occupation_DailyLaborer_V +
                                                    Occupation_OtherWork_V +
                                                    Occupation_Unemployed_V +
                                                    HDSS_D +
                                                    HouseholdSize_2_V +
                                                    HouseholdSize_3_V +
                                                    HouseholdSize_4_V +
                                                    HouseholdSize_5_V +
                                                    Children_Under_5_V +
                                                    Elderly_V +
                                                    Income_2_V +
                                                    Income_3_V +
                                                    Income_4_V +
                                                    WealthIndex +
                                                    CResponse_Lockdown_V +
                                                    CResponse_BusinessClosures_V +
                                                    CResponse_TravelRestrictions_V +
                                                    CResponse_IsolationCenters_V +
                                                    HDSS_D*WealthIndex, family = 'quasipoisson', data = data)
 
# Print the regression model
summary(VisualizationModel)
```

```{r, echo=FALSE}
# Obtain Predicted Values #
newdata2 <- with(data, data.frame(HardshipIndex,
                                  HDSS_D,
                                  Age_2_V=mean(Age_2_V, na.rm = TRUE),
                                  Age_3_V=mean(Age_3_V, na.rm = TRUE),
                                  Age_4_V=mean(Age_4_V, na.rm = TRUE),
                                  Sex_V=mean(Sex_V, na.rm = TRUE),
                                  Ethnicity_Other_V=mean(Ethnicity_Other_V, na.rm = TRUE),
                                  Education_V=mean(Education_V, na.rm = TRUE),
                                  Occupation_Professional_V=mean(Occupation_Professional_V, na.rm = TRUE),
                                  Occupation_Student_V=mean(Occupation_Student_V, na.rm = TRUE),
                                  Occupation_DailyLaborer_V=mean(Occupation_DailyLaborer_V, na.rm = TRUE),
                                  Occupation_OtherWork_V=mean(Occupation_OtherWork_V, na.rm = TRUE),
                                  Occupation_Unemployed_V=mean(Occupation_Unemployed_V, na.rm = TRUE),
                                  HouseholdSize_2_V=mean(HouseholdSize_2_V, na.rm = TRUE),
                                  HouseholdSize_3_V=mean(HouseholdSize_3_V, na.rm = TRUE),
                                  HouseholdSize_4_V=mean(HouseholdSize_4_V, na.rm = TRUE),
                                  HouseholdSize_5_V=mean(HouseholdSize_5_V, na.rm = TRUE),
                                  Children_Under_5_V=mean(Children_Under_5_V, na.rm = TRUE),
                                  Elderly_V=mean(Elderly_V, na.rm = TRUE),
                                  Income_2_V=mean(Income_2_V, na.rm = TRUE),
                                  Income_3_V=mean(Income_3_V, na.rm = TRUE),
                                  Income_4_V=mean(Income_4_V, na.rm = TRUE),
                                  WealthIndex,
                                  CResponse_Lockdown_V=mean(CResponse_Lockdown_V, na.rm = TRUE),
                                  CResponse_BusinessClosures_V=mean(CResponse_BusinessClosures_V, na.rm = TRUE),
                                  CResponse_TravelRestrictions_V=mean(CResponse_TravelRestrictions_V, na.rm = TRUE),
                                  CResponse_IsolationCenters_V=mean(CResponse_IsolationCenters_V, na.rm = TRUE)
))

head(newdata2)
```

```{r, echo=FALSE}
newdata3 = NULL
newdata3 <- cbind(newdata2, predict(VisualizationModel, newdata = newdata2, type = c("link"), se.fit = TRUE))

# Obtain Confidence Intervals #
newdata3 <- within(newdata3, {
    PredictedProbability <- exp(fit)
    LL <- exp(fit - (1.96 * se.fit))
    UL <- exp(fit + (1.96 * se.fit))
})

head(newdata3)
newdata3 <- newdata3 %>% 
        drop_na(PredictedProbability)

head(newdata3)

df.Wealth <- newdata3[c("WealthIndex", "HDSS_D", "PredictedProbability", "LL", "UL")]
df.Wealth$Catchment <- df.Wealth$HDSS_D
df.Wealth$Factor <- "Wealth \nIndex"
df.Wealth$Category <- fct_rev(df.Wealth$WealthIndex)
df.Wealth <- df.Wealth[c("Factor", "Category", "PredictedProbability", "LL", "UL", "Catchment")]
unique(df.Wealth)
```

```{r, echo=FALSE}
data$CResponse_Lockdown <- factor(data$CResponse_Lockdown,
                    levels = c(0,1),
                    labels = c("No", "Yes"))

VisualizationModel <- glm(formula = HardshipIndex ~ Age_2_V +
                                                    Age_3_V +
                                                    Age_4_V +
                                                    Sex_V +
                                                    Ethnicity_Other_V +
                                                    Education_V +
                                                    Occupation_Professional_V +
                                                    Occupation_Student_V + 
                                                    Occupation_DailyLaborer_V +
                                                    Occupation_OtherWork_V +
                                                    Occupation_Unemployed_V +
                                                    HDSS_D +
                                                    HouseholdSize_2_V +
                                                    HouseholdSize_3_V +
                                                    HouseholdSize_4_V +
                                                    HouseholdSize_5_V +
                                                    Children_Under_5_V +
                                                    Elderly_V +
                                                    Income_2_V +
                                                    Income_3_V +
                                                    Income_4_V +
                                                    WealthIndex_2_V +
                                                    WealthIndex_3_V +
                                                    WealthIndex_4_V +
                                                    WealthIndex_5_V +
                                                    CResponse_Lockdown +
                                                    CResponse_BusinessClosures_V +
                                                    CResponse_TravelRestrictions_V +
                                                    CResponse_IsolationCenters_V +
                                                    HDSS_D*CResponse_Lockdown, family = 'quasipoisson', data = data)
 
# Print the regression model
summary(VisualizationModel)

```

```{r, echo=FALSE}
# Obtain Predicted Values #
newdata2 <- with(data, data.frame(HardshipIndex,
                                  HDSS_D,
                                  Age_2_V=mean(Age_2_V, na.rm = TRUE),
                                  Age_3_V=mean(Age_3_V, na.rm = TRUE),
                                  Age_4_V=mean(Age_4_V, na.rm = TRUE),
                                  Sex_V=mean(Sex_V, na.rm = TRUE),
                                  Ethnicity_Other_V=mean(Ethnicity_Other_V, na.rm = TRUE),
                                  Education_V=mean(Education_V, na.rm = TRUE),
                                  Occupation_Professional_V=mean(Occupation_Professional_V, na.rm = TRUE),
                                  Occupation_Student_V=mean(Occupation_Student_V, na.rm = TRUE),
                                  Occupation_DailyLaborer_V=mean(Occupation_DailyLaborer_V, na.rm = TRUE),
                                  Occupation_OtherWork_V=mean(Occupation_OtherWork_V, na.rm = TRUE),
                                  Occupation_Unemployed_V=mean(Occupation_Unemployed_V, na.rm = TRUE),
                                  HouseholdSize_2_V=mean(HouseholdSize_2_V, na.rm = TRUE),
                                  HouseholdSize_3_V=mean(HouseholdSize_3_V, na.rm = TRUE),
                                  HouseholdSize_4_V=mean(HouseholdSize_4_V, na.rm = TRUE),
                                  HouseholdSize_5_V=mean(HouseholdSize_5_V, na.rm = TRUE),
                                  Children_Under_5_V=mean(Children_Under_5_V, na.rm = TRUE),
                                  Elderly_V=mean(Elderly_V, na.rm = TRUE),
                                  Income_2_V=mean(Income_2_V, na.rm = TRUE),
                                  Income_3_V=mean(Income_3_V, na.rm = TRUE),
                                  Income_4_V=mean(Income_4_V, na.rm = TRUE),
                                  WealthIndex_2_V=mean(WealthIndex_2_V, na.rm = TRUE),
                                  WealthIndex_3_V=mean(WealthIndex_3_V, na.rm = TRUE),
                                  WealthIndex_4_V=mean(WealthIndex_4_V, na.rm = TRUE),
                                  WealthIndex_5_V=mean(WealthIndex_5_V, na.rm = TRUE),
                                  CResponse_Lockdown,
                                  CResponse_BusinessClosures_V=mean(CResponse_BusinessClosures_V, na.rm = TRUE),
                                  CResponse_TravelRestrictions_V=mean(CResponse_TravelRestrictions_V, na.rm = TRUE),
                                  CResponse_IsolationCenters_V=mean(CResponse_IsolationCenters_V, na.rm = TRUE)
))

head(newdata2)
```

```{r, echo=FALSE}
newdata3 = NULL
newdata3 <- cbind(newdata2, predict(VisualizationModel, newdata = newdata2, type = c("link"), se.fit = TRUE))

# Obtain Confidence Intervals #
newdata3 <- within(newdata3, {
    PredictedProbability <- exp(fit)
    LL <- exp(fit - (1.96 * se.fit))
    UL <- exp(fit + (1.96 * se.fit))
})

head(newdata3)
newdata3 <- newdata3 %>% 
        drop_na(PredictedProbability)

head(newdata3)

df.CResponse_Lockdown <- newdata3[c("CResponse_Lockdown", "HDSS_D", "PredictedProbability", "LL", "UL")]
df.CResponse_Lockdown$Catchment <- df.CResponse_Lockdown$HDSS_D
df.CResponse_Lockdown$Factor <- "Lockdowns"
df.CResponse_Lockdown$Category <- fct_rev(df.CResponse_Lockdown$CResponse_Lockdown)
df.CResponse_Lockdown <- df.CResponse_Lockdown[c("Factor", "Category", "PredictedProbability", "LL", "UL", "Catchment")]
unique(df.CResponse_Lockdown)
```


```{r, echo=FALSE}
data$CResponse_BusinessClosures <- factor(data$CResponse_BusinessClosures,
                    levels = c(0,1),
                    labels = c("No", "Yes"))

VisualizationModel <- glm(formula = HardshipIndex ~ Age_2_V +
                                                    Age_3_V +
                                                    Age_4_V +
                                                    Sex_V +
                                                    Ethnicity_Other_V +
                                                    Education_V +
                                                    Occupation_Professional_V +
                                                    Occupation_Student_V + 
                                                    Occupation_DailyLaborer_V +
                                                    Occupation_OtherWork_V +
                                                    Occupation_Unemployed_V +
                                                    HDSS_D +
                                                    HouseholdSize_2_V +
                                                    HouseholdSize_3_V +
                                                    HouseholdSize_4_V +
                                                    HouseholdSize_5_V +
                                                    Children_Under_5_V +
                                                    Elderly_V +
                                                    Income_2_V +
                                                    Income_3_V +
                                                    Income_4_V +
                                                    WealthIndex_2_V +
                                                    WealthIndex_3_V +
                                                    WealthIndex_4_V +
                                                    WealthIndex_5_V +
                                                    CResponse_Lockdown_V +
                                                    CResponse_BusinessClosures +
                                                    CResponse_TravelRestrictions_V +
                                                    CResponse_IsolationCenters_V +
                                                    HDSS_D*CResponse_BusinessClosures, family = 'quasipoisson', data = data)
 
# Print the regression model
summary(VisualizationModel)

```

```{r, echo=FALSE}
# Obtain Predicted Values #
newdata2 <- with(data, data.frame(HardshipIndex,
                                  HDSS_D,
                                  Age_2_V=mean(Age_2_V, na.rm = TRUE),
                                  Age_3_V=mean(Age_3_V, na.rm = TRUE),
                                  Age_4_V=mean(Age_4_V, na.rm = TRUE),
                                  Sex_V=mean(Sex_V, na.rm = TRUE),
                                  Ethnicity_Other_V=mean(Ethnicity_Other_V, na.rm = TRUE),
                                  Education_V=mean(Education_V, na.rm = TRUE),
                                  Occupation_Professional_V=mean(Occupation_Professional_V, na.rm = TRUE),
                                  Occupation_Student_V=mean(Occupation_Student_V, na.rm = TRUE),
                                  Occupation_DailyLaborer_V=mean(Occupation_DailyLaborer_V, na.rm = TRUE),
                                  Occupation_OtherWork_V=mean(Occupation_OtherWork_V, na.rm = TRUE),
                                  Occupation_Unemployed_V=mean(Occupation_Unemployed_V, na.rm = TRUE),
                                  HouseholdSize_2_V=mean(HouseholdSize_2_V, na.rm = TRUE),
                                  HouseholdSize_3_V=mean(HouseholdSize_3_V, na.rm = TRUE),
                                  HouseholdSize_4_V=mean(HouseholdSize_4_V, na.rm = TRUE),
                                  HouseholdSize_5_V=mean(HouseholdSize_5_V, na.rm = TRUE),
                                  Children_Under_5_V=mean(Children_Under_5_V, na.rm = TRUE),
                                  Elderly_V=mean(Elderly_V, na.rm = TRUE),
                                  Income_2_V=mean(Income_2_V, na.rm = TRUE),
                                  Income_3_V=mean(Income_3_V, na.rm = TRUE),
                                  Income_4_V=mean(Income_4_V, na.rm = TRUE),
                                  WealthIndex_2_V=mean(WealthIndex_2_V, na.rm = TRUE),
                                  WealthIndex_3_V=mean(WealthIndex_3_V, na.rm = TRUE),
                                  WealthIndex_4_V=mean(WealthIndex_4_V, na.rm = TRUE),
                                  WealthIndex_5_V=mean(WealthIndex_5_V, na.rm = TRUE),
                                  CResponse_Lockdown_V=mean(CResponse_Lockdown_V, na.rm = TRUE),
                                  CResponse_BusinessClosures,
                                  CResponse_TravelRestrictions_V=mean(CResponse_TravelRestrictions_V, na.rm = TRUE),
                                  CResponse_IsolationCenters_V=mean(CResponse_IsolationCenters_V, na.rm = TRUE)
))

head(newdata2)
```

```{r, echo=FALSE}
newdata3 = NULL
newdata3 <- cbind(newdata2, predict(VisualizationModel, newdata = newdata2, type = c("link"), se.fit = TRUE))

# Obtain Confidence Intervals #
newdata3 <- within(newdata3, {
    PredictedProbability <- exp(fit)
    LL <- exp(fit - (1.96 * se.fit))
    UL <- exp(fit + (1.96 * se.fit))
})

head(newdata3)
newdata3 <- newdata3 %>% 
        drop_na(PredictedProbability)

head(newdata3)

df.CResponse_BusinessClosures <- newdata3[c("CResponse_BusinessClosures", "HDSS_D", "PredictedProbability", "LL", "UL")]
df.CResponse_BusinessClosures$Catchment <- df.CResponse_BusinessClosures$HDSS_D
df.CResponse_BusinessClosures$Factor <- "Business \nClosures"
df.CResponse_BusinessClosures$Category <- fct_rev(df.CResponse_BusinessClosures$CResponse_BusinessClosures)
df.CResponse_BusinessClosures <- df.CResponse_BusinessClosures[c("Factor", "Category", "PredictedProbability", "LL", "UL", "Catchment")]
unique(df.CResponse_BusinessClosures)
```

```{r, echo=FALSE}
df <- rbind(df.HDSS, df.Ethnicity, df.Education, df.Occupation, df.HouseholdSize, df.Income, df.Wealth, df.CResponse_Lockdown, df.CResponse_BusinessClosures)
```

```{r, echo=FALSE}

df$Factor <- factor(df$Factor,              
                    levels =  c("Urbanicity", "Ethnicity", "Education", "Occupation", "Household \nSize", "Income", "Wealth \nIndex", "Lockdowns", "Business \nClosures"))

Figure <- ggplot(df, aes(x = Category, y = PredictedProbability, color = Catchment, fill = Catchment)) + 
            #geom_linerange(aes(ymin=LL, ymax=UL), color = "black", width=1, size=3, position = position_dodge(width = 0.90)) +
            geom_linerange(aes(ymin=LL, ymax=UL), width = 1, size = 0.75, position = position_dodge(width = 0.50)) +
            #geom_point(shape = 23, size = 4, color = "black", stroke = 1, position = position_dodge(width = 0.90)) +
            geom_point(shape = 23, size = 1.0, stroke = 0.5, position = position_dodge(width = 0.50)) +
            #geom_point(size = .5, color = "black", position = position_dodge(width = 0.90))
            facet_grid(Factor~Catchment, scales = "free", space = "free", switch = "y", shrink = FALSE)
```

```{r, echo=FALSE}
Figure <- Figure + theme(legend.title.align=0.5)
Figure <- Figure + scale_y_continuous(name="Predicted Number of Hardships", breaks=seq(0, 5, 1))
Figure <- Figure + scale_x_discrete(name="")
Figure <- Figure + theme(legend.position="top")
Figure <- Figure + theme(plot.title = element_text(hjust = 0.5))
Figure <- Figure + theme(text = element_text(size = 9))
Figure <- Figure + scale_color_viridis(name="HDSS Catchment", discrete=TRUE, begin = 0.45, end = 1) 
Figure <- Figure + scale_fill_viridis(name="HDSS Catchment", discrete=TRUE, begin = 0.45, end = 1) 
#Figure <- Figure + theme(legend.position="top")
Figure <- Figure + theme(legend.position="none")
Figure <- Figure + theme(axis.text.x  = element_text(size = 9, color = "black"),
                         axis.text.y  = element_text(size = 9, color = "black"),
                         axis.title.y = element_text(size = 9, color = "black"),
                         axis.title.x = element_text(size = 9, color = "black")) 
#Figure <- Figure + theme(panel.grid.major = element_line(colour = "black", size = .2, linetype = "dashed"))
#Figure <- Figure + theme(panel.grid.minor = element_line(colour = "black", size = .2, linetype = "dashed"))
#Figure <- Figure + theme(axis.line = element_line(colour = "black", size = .75, linetype = "solid"))
#Figure <- Figure + theme(panel.background = element_rect(fill = "white", colour="white"))
Figure <- Figure + annotate("rect", xmin = 1, xmax = 2, ymin = 0, ymax = 5,  alpha = 0)
Figure <- Figure + coord_flip()
Figure <- Figure + theme_dark()
Figure <- Figure + theme(strip.text.y.left = element_text(angle = 0))
Figure

cairo_pdf("../Figures/Predicted Probabilities/Adjusted-Hardship-Catchment-Interactions.pdf", 
      width  = 3.35, 
      height = 4.75,
      fallback_resolution = 300,
      family = "serif"
      )
Figure
dev.off()

agg_tiff("../Figures/Predicted Probabilities/Adjusted-Hardship-Catchment-Interactions.tiff", units="mm", width=85, height=120, res=300)
Figure
dev.off()
```


```{r, echo=FALSE}

Figure <- ggplot(df, aes(x = Category, y = PredictedProbability, color = Catchment, fill = Catchment)) + 
            #geom_linerange(aes(ymin=LL, ymax=UL), color = "black", width=1, size=3, position = position_dodge(width = 0.90)) +
            geom_linerange(aes(ymin=LL, ymax=UL), width = 1, size = 1, position = position_dodge(width = 1)) +
            #geom_point(shape = 23, size = 4, color = "black", stroke = 1, position = position_dodge(width = 0.90)) +
            geom_point(shape = 23, size = 1.25, stroke = 0.5, position = position_dodge(width = 1)) +
            #geom_point(size = .5, color = "black", position = position_dodge(width = 0.90))
            facet_grid(Factor~., scales = "free", space = "free", switch = "y", shrink = FALSE)
```

```{r, echo=FALSE}
Figure <- Figure + theme(legend.title.align=0.5)
Figure <- Figure + scale_y_continuous(name="Predicted Number of Hardships", breaks=seq(0, 5, 1))
Figure <- Figure + scale_x_discrete(name="")
Figure <- Figure + theme(legend.position="top")
Figure <- Figure + theme(plot.title = element_text(hjust = 0.5))
Figure <- Figure + theme(text = element_text(size = 9))
Figure <- Figure + scale_color_viridis(name="", discrete=TRUE, begin = 0.7, end = 1) 
Figure <- Figure + scale_fill_viridis(name="", discrete=TRUE, begin = 0.7, end = 1) 
#Figure <- Figure + theme(legend.position="none")
Figure <- Figure + theme(axis.text.x  = element_text(size = 9, color = "black", family="Roboto Condensed"),
                         axis.text.y  = element_text(size = 9, color = "black", family="Roboto Condensed"),
                         axis.title.y = element_text(size = 9, color = "black", family="Roboto Condensed"),
                         axis.title.x = element_text(size = 9, color = "black", family="Roboto Condensed")) 
#Figure <- Figure + theme(panel.grid.major = element_line(colour = "black", size = .2, linetype = "dashed"))
#Figure <- Figure + theme(panel.grid.minor = element_line(colour = "black", size = .2, linetype = "dashed"))
#Figure <- Figure + theme(axis.line = element_line(colour = "black", size = .75, linetype = "solid"))
#Figure <- Figure + theme(panel.background = element_rect(fill = "white", colour="white"))
Figure <- Figure + annotate("rect", xmin = 1, xmax = 2, ymin = 0, ymax = 5,  alpha = 0)
Figure <- Figure + coord_flip()
Figure <- Figure + theme_dark()
Figure <- Figure + theme(legend.position="none")
Figure <- Figure + theme(strip.text.y.left = element_text(angle = 0))
Figure

cairo_pdf("../Figures/Predicted Probabilities/Adjusted-Hardship-Catchment-Interactions-2.pdf", 
      width  = 3.35, 
      height = 4.75,
      fallback_resolution = 300,
      family = "serif"
      )
Figure
dev.off()

agg_tiff("../Figures/Predicted Probabilities/Adjusted-Hardship-Catchment-Interactions-2.tiff", units="mm", width=85, height=120, res=300)
Figure
dev.off()

```

```{r, echo=FALSE}
Figure <- Figure + theme(legend.title.align=0.5)
Figure <- Figure + scale_y_continuous(name="Predicted Number of Hardships", breaks=seq(0, 5, 1))
Figure <- Figure + scale_x_discrete(name="")
Figure <- Figure + theme(legend.position="top")
Figure <- Figure + theme(plot.title = element_text(hjust = 0.5))
Figure <- Figure + theme(text = element_text(size = 12))
Figure <- Figure + scale_color_viridis(name="", discrete=TRUE, begin = 0.0, end = .5) 
Figure <- Figure + scale_fill_viridis(name="", discrete=TRUE, begin = 0.0, end = .5) 
#Figure <- Figure + theme(legend.position="none")
Figure <- Figure + theme(axis.text.x  = element_text(size = 12, color = "black", family="Roboto Condensed"),
                         axis.text.y  = element_text(size = 12, color = "black", family="Roboto Condensed"),
                         axis.title.y = element_text(size = 12, color = "black", family="Roboto Condensed"),
                         axis.title.x = element_text(size = 12, color = "black", family="Roboto Condensed")) 
#Figure <- Figure + theme(panel.grid.major = element_line(colour = "black", size = .2, linetype = "dashed"))
#Figure <- Figure + theme(panel.grid.minor = element_line(colour = "black", size = .2, linetype = "dashed"))
#Figure <- Figure + theme(axis.line = element_line(colour = "black", size = .75, linetype = "solid"))
#Figure <- Figure + theme(panel.background = element_rect(fill = "white", colour="white"))
Figure <- Figure + annotate("rect", xmin = 1, xmax = 2, ymin = 0, ymax = 5,  alpha = 0)
Figure <- Figure + coord_flip()
Figure <- Figure + theme_bw()
Figure <- Figure + theme(legend.position="none")
Figure <- Figure + theme(strip.text.y.left = element_text(angle = 0))
Figure <- Figure+ theme(plot.margin = margin(2, 2, 2, -2, "mm"))
Figure

cairo_pdf("../Figures/Predicted Probabilities/Adjusted-Hardship-Catchment-Interactions-3.pdf", 
      width  = 6.5, 
      height = 8.5,
      fallback_resolution = 300,
      family = "serif"
      )
Figure
dev.off()

agg_tiff("../Figures/Predicted Probabilities/Adjusted-Hardship-Catchment-Interactions-3.tiff", units="mm", width=85, height=120, res=300, scaling = .75)
Figure
dev.off()

```

                Covid_HH_Response_GOV_Help = govthelp
                
```{r, echo=FALSE}

data$CHHResponse_Sell_Assets <- NULL
data$CHHResponse_Sell_Assets[data$Covid_HH_Response_Sell_Assets == 1]  <- 1
data$CHHResponse_Sell_Assets[data$Covid_HH_Response_Sell_Assets == 0]  <- 0
data$`Sell Assets (Covid Household Response)` <- factor(data$CHHResponse_Sell_Assets,
                    levels = c(0,1),
                    labels = c("No", "Yes"))

tab1(data$`Sell Assets (Covid Household Response)`, sort.group = "decreasing", cum.percent = TRUE)

data$CHHResponse_Sell_Assets_V <- data$CHHResponse_Sell_Assets

data$CHHResponse_Generate_Income <- NULL
data$CHHResponse_Generate_Income[data$Covid_HH_Response_Generate_Income == 1]  <- 1
data$CHHResponse_Generate_Income[data$Covid_HH_Response_Generate_Income == 0]  <- 0
data$`Generate Income (Covid Household Response)` <- factor(data$CHHResponse_Generate_Income,
                    levels = c(0,1),
                    labels = c("No", "Yes"))

tab1(data$`Generate Income (Covid Household Response)`, sort.group = "decreasing", cum.percent = TRUE)

data$CHHResponse_Generate_Income_V <- data$CHHResponse_Generate_Income

data$CHHResponse_FF_Help <- NULL
data$CHHResponse_FF_Help[data$Covid_HH_Response_FF_Help == 1]  <- 1
data$CHHResponse_FF_Help[data$Covid_HH_Response_FF_Help == 0]  <- 0
data$`Family/Friend Help (Covid Household Response)` <- factor(data$CHHResponse_FF_Help,
                    levels = c(0,1),
                    labels = c("No", "Yes"))

tab1(data$`Family/Friend Help (Covid Household Response)`, sort.group = "decreasing", cum.percent = TRUE)

data$CHHResponse_FF_Help_V <- data$CHHResponse_FF_Help

data$CHHResponse_Borrow_Family <- NULL
data$CHHResponse_Borrow_Family[data$Covid_HH_Response_Borrow_Family == 1]  <- 1
data$CHHResponse_Borrow_Family[data$Covid_HH_Response_Borrow_Family == 0]  <- 0
data$`Borrow from Family/Friends (Covid Household Response)` <- factor(data$CHHResponse_Borrow_Family,
                    levels = c(0,1),
                    labels = c("No", "Yes"))

tab1(data$`Borrow from Family/Friends (Covid Household Response)`, sort.group = "decreasing", cum.percent = TRUE)

data$CHHResponse_Borrow_Family_V <- data$CHHResponse_Borrow_Family

data$CHHResponse_Took_Loan <- NULL
data$CHHResponse_Took_Loan[data$Covid_HH_Response_Took_Loan == 1]  <- 1
data$CHHResponse_Took_Loan[data$Covid_HH_Response_Took_Loan == 0]  <- 0
data$`Took Loan (Covid Household Response)` <- factor(data$CHHResponse_Took_Loan,
                    levels = c(0,1),
                    labels = c("No", "Yes"))

tab1(data$`Took Loan (Covid Household Response)`, sort.group = "decreasing", cum.percent = TRUE)

data$CHHResponse_Took_Loan_V <- data$CHHResponse_Took_Loan

data$CHHResponse_Delay_Payment <- NULL
data$CHHResponse_Delay_Payment[data$Covid_HH_Response_Delay_Payment == 1]  <- 1
data$CHHResponse_Delay_Payment[data$Covid_HH_Response_Delay_Payment == 0]  <- 0
data$`Delayed Payments (Covid Household Response)` <- factor(data$CHHResponse_Delay_Payment,
                    levels = c(0,1),
                    labels = c("No", "Yes"))

tab1(data$`Delayed Payments (Covid Household Response)`, sort.group = "decreasing", cum.percent = TRUE)

data$CHHResponse_Delay_Payment_V <- data$CHHResponse_Delay_Payment

data$CHHResponse_Sold_Harvest <- NULL
data$CHHResponse_Sold_Harvest[data$Covid_HH_Response_Sold_Harvest == 1]  <- 1
data$CHHResponse_Sold_Harvest[data$Covid_HH_Response_Sold_Harvest == 0]  <- 0
data$`Sold Harvest (Covid Household Response)` <- factor(data$CHHResponse_Sold_Harvest,
                    levels = c(0,1),
                    labels = c("No", "Yes"))

tab1(data$`Sold Harvest (Covid Household Response)`, sort.group = "decreasing", cum.percent = TRUE)

data$CHHResponse_CHHResponse_Sold_Harvest_V <- data$CHHResponse_CHHResponse_Sold_Harvest

data$CHHResponse_Reduce_Food_Consumption <- NULL
data$CHHResponse_Reduce_Food_Consumption[data$Covid_HH_Response_Reduce_Food_Consumption == 1]  <- 1
data$CHHResponse_Reduce_Food_Consumption[data$Covid_HH_Response_Reduce_Food_Consumption == 0]  <- 0
data$`Reduced Food Consumption (Covid Household Response)` <- factor(data$CHHResponse_Reduce_Food_Consumption,
                    levels = c(0,1),
                    labels = c("No", "Yes"))

tab1(data$`Reduced Food Consumption (Covid Household Response)`, sort.group = "decreasing", cum.percent = TRUE)

data$CHHResponse_Reduce_Food_Consumption_V <- data$CHHResponse_Reduce_Food_Consumption

data$CHHResponse_Reduce_Consumption <- NULL
data$CHHResponse_Reduce_Consumption[data$Covid_HH_Response_Reduce_Consumption == 1]  <- 1
data$CHHResponse_Reduce_Consumption[data$Covid_HH_Response_Reduce_Consumption == 0]  <- 0
data$`Reduced Consumption (Covid Household Response)` <- factor(data$CHHResponse_Reduce_Consumption,
                    levels = c(0,1),
                    labels = c("No", "Yes"))

tab1(data$`Reduced Consumption (Covid Household Response)`, sort.group = "decreasing", cum.percent = TRUE)

data$CHHResponse_Reduce_Consumption_V <- data$CHHResponse_Reduce_Consumption

data$CHHResponse_Relied_Savings <- NULL
data$CHHResponse_Relied_Savings[data$Covid_HH_Response_Relied_Savings == 1]  <- 1
data$CHHResponse_Relied_Savings[data$Covid_HH_Response_Relied_Savings == 0]  <- 0
data$`Relied on Savings (Covid Household Response)` <- factor(data$CHHResponse_Relied_Savings,
                    levels = c(0,1),
                    labels = c("No", "Yes"))

tab1(data$`Relied on Savings (Covid Household Response)`, sort.group = "decreasing", cum.percent = TRUE)

data$CHHResponse_Relied_Savings_V <- data$CHHResponse_Relied_Savings

data$CHHResponse_NGO_Help <- NULL
data$CHHResponse_NGO_Help[data$Covid_HH_Response_NGO_Help== 1]  <- 1
data$CHHResponse_NGO_Help[data$Covid_HH_Response_GOV_Help== 1]  <- 1
data$CHHResponse_NGO_Help[data$Covid_HH_Response_NGO_Help == 0]  <- 0
data$`NGO/GOV Help (Covid Household Response)` <- factor(data$CHHResponse_NGO_Help,
                    levels = c(0,1),
                    labels = c("No", "Yes"))

tab1(data$`NGO/GOV Help (Covid Household Response)`, sort.group = "decreasing", cum.percent = TRUE)

data$CHHResponse_NGO_Help_V <- data$CHHResponse_NGO_Help

data$CHHResponse_GOV_Help <- NULL
data$CHHResponse_GOV_Help[data$Covid_HH_Response_GOV_Help== 1]  <- 1
data$CHHResponse_GOV_Help[data$Covid_HH_Response_GOV_Help == 0]  <- 0
data$`GOV Help (Covid Household Response)` <- factor(data$CHHResponse_GOV_Help,
                    levels = c(0,1),
                    labels = c("No", "Yes"))

tab1(data$`GOV Help (Covid Household Response)`, sort.group = "decreasing", cum.percent = TRUE)

data$CHHResponse_GOV_Help_V <- data$CHHResponse_GOV_Help

data$CHHResponse_Pay_Advance <- NULL
data$CHHResponse_Pay_Advance[data$Covid_HH_Response_Pay_Advance== 1]  <- 1
data$CHHResponse_Pay_Advance[data$Covid_HH_Response_Pay_Advance == 0]  <- 0
data$`Pay Advance (Covid Household Response)` <- factor(data$CHHResponse_Pay_Advance,
                    levels = c(0,1),
                    labels = c("No", "Yes"))

tab1(data$`Pay Advance (Covid Household Response)`, sort.group = "decreasing", cum.percent = TRUE)

data$CHHResponse_Pay_Advance_V <- data$CHHResponse_Pay_Advance

data$CHHResponse_Other <- NULL
data$CHHResponse_Other[data$Covid_HH_Response_Other== 1]  <- 1
data$CHHResponse_Other[data$Covid_HH_Response_Other == 0]  <- 0
data$`Other (Covid Household Response)` <- factor(data$CHHResponse_Other,
                    levels = c(0,1),
                    labels = c("No", "Yes"))

tab1(data$`Other (Covid Household Response)`, sort.group = "decreasing", cum.percent = TRUE)

data$CHHResponse_Other_V <- data$CHHResponse_Other
```

```{r}
data <- data %>% #specify dply::select because MASS also has a select that will give you an error
  dplyr::relocate(c("CHHResponse_Sell_Assets",
                    "CHHResponse_Generate_Income",
                    "CHHResponse_FF_Help",
                    "CHHResponse_Borrow_Family",
                    "CHHResponse_Took_Loan",
                    "CHHResponse_Delay_Payment",
                    "CHHResponse_Sold_Harvest",
                    "CHHResponse_Reduce_Food_Consumption",
                    "CHHResponse_Reduce_Consumption",
                    "CHHResponse_Relied_Savings",
                    "CHHResponse_NGO_Help",
                    "CHHResponse_GOV_Help",
                    "CHHResponse_Pay_Advance",
                    "CHHResponse_Other"), .after=last_col())

dim(data)    
head(data[5, 293:306])

#creating an additive Hardship Index variable- factor
data$CHHResponse <-rowSums(data[,c(293:306)])          
descr(data$CHHResponse)
table(data$CHHResponse)
```

*Adjusted associations with Hardships*

```{r, echo=FALSE, results='hide'}
panels <- list(
  list(width = 0.01),
  list(width = 0.22, display = ~variable, fontface = "bold", heading = "Variable"),
  list(width = 0.15, display = ~level),
  #list(width = 0.05, display = ~n, hjust = 1, heading = "n"),
  list(width = 0.01, item = "vline", hjust = 0.5),
  list(width = 0.32, item = "forest", hjust = 0.5, heading = "Adjusted Odds Ratios", linetype = "dotted", color = "red", line_x = 0),
  list(width = 0.01, item = "vline", hjust = 0.5),
  list(width = 0.12, display = ~ ifelse(reference, "Reference", sprintf("%0.2f (%0.2f, %0.2f)", trans(estimate), trans(conf.low), trans(conf.high))), display_na = NA),
  #list(width = 0.05, display = ~ ifelse(reference, "", format.pval(p.value, digits = 1, eps = 0.001)), display_na = NA, hjust = 1, heading = "p"),
  list(width = 0.01)
)
```

```{r}
write.csv(data, "../Data/Ethiopia Analysis Data.csv")
```

```{r}
data <-data[data$HardshipIndex != 0,]
str(data)
table(data$HardshipIndex)
```

```{r}
# all covariates
FinalModel <- glm(formula = `Sell Assets (Covid Household Response)` ~  `Age (Household Head)` +
                                                                        `Sex (Household Head)` +
                                                                        `Ethnicity (Household Head)` +
                                                                        `Education (Household Head)` +
                                                                        `Occupation (Household Head)` + 
                                                                        #`Residence (Household)`+ 
                                                                        `Urbanicity (Household)` +
                                                                        `Household Size` +
                                                                         #`Dependents (Household)` +
                                                                        `Adults Over Age 60 (Household)` +
                                                                        `Children Under Age 5 (Household)` +
                                                                        `Income (Household)`+
                                                                        `Wealth Index (Household)`+
                                                                        `Job Loss (Household)`+
                                                                        `Nonfarm Business Closure (Household)` +
                                                                        `Farm Disruption (Household)` +
                                                                        `Livestock Disruption (Household)`+
                                                                        `Fishing Disruption (Household)`+
                                                                        `Input Inflation (Household)`+
                                                                        `Output Deflation (Household)`+
                                                                        `Food Price Increase (Household)`+
                                                                        `Illness/Death (Household)`, family = binomial, data = data)
 
# Print the regression model
summary(FinalModel)
```

```{r}
# Produce forest plots
model_list <- list(FinalModel)
multivariate_plots <- forest_model(model_list = model_list, exponentiate = TRUE, format_options = forest_model_format_options(colour = "black", color = NULL, shape = 18, text_size = 12, point_size = 1.25, banded = TRUE), panels = panels, merge_models = TRUE, factor_separate_line = TRUE, recalculate_width = FALSE, recalculate_height = TRUE) 
multivariate_plots <- multivariate_plots + theme(text = element_text(size = 6))
multivariate_plots <- multivariate_plots + geom_segment(x = 0, y = 0, xend = 0, yend = 75.4, linetype="solid", color = "darkred", size=0.5)
multivariate_plots

cairo_pdf("../Figures/Odds Ratios/Responses/Adjusted_Plot_Sell_Assets.pdf", 
      width  = 3.35, 
      height = 4.75,
      fallback_resolution = 300,
      family = "serif"
      )
multivariate_plots
dev.off()

agg_tiff("../Figures/Odds Ratios/Responses/Adjusted_Plot_Sell_Assets.tiff", units="mm", width=85, height=120, res=300)
multivariate_plots
dev.off()

```

```{r}
# all covariates
FinalModel <- glm(formula = `Generate Income (Covid Household Response)` ~  `Age (Household Head)` +
                                                                        `Sex (Household Head)` +
                                                                        `Ethnicity (Household Head)` +
                                                                        `Education (Household Head)` +
                                                                        `Occupation (Household Head)` + 
                                                                        #`Residence (Household)`+ 
                                                                        `Urbanicity (Household)` +
                                                                        `Household Size` +
                                                                         #`Dependents (Household)` +
                                                                        `Adults Over Age 60 (Household)` +
                                                                        `Children Under Age 5 (Household)` +
                                                                        `Income (Household)`+
                                                                        `Wealth Index (Household)`+
                                                                        `Job Loss (Household)`+
                                                                        `Nonfarm Business Closure (Household)` +
                                                                        `Farm Disruption (Household)` +
                                                                        `Livestock Disruption (Household)`+
                                                                        `Fishing Disruption (Household)`+
                                                                        `Input Inflation (Household)`+
                                                                        `Output Deflation (Household)`+
                                                                        `Food Price Increase (Household)`+
                                                                        `Illness/Death (Household)`, family = binomial, data = data)
 
# Print the regression model
summary(FinalModel)
```

```{r}
# Produce forest plots
model_list <- list(FinalModel)
multivariate_plots <- forest_model(model_list = model_list, exponentiate = TRUE, format_options = forest_model_format_options(colour = "black", color = NULL, shape = 18, text_size = 12, point_size = 1.25, banded = TRUE), panels = panels, merge_models = TRUE, factor_separate_line = TRUE, recalculate_width = FALSE, recalculate_height = TRUE, breaks = c(-2.99573227355, -1.38629436112, 0, 1.60943791243, 3.21887582487, 3.91202300543)) 
multivariate_plots <- multivariate_plots + theme(text = element_text(size = 6))
multivariate_plots <- multivariate_plots + geom_segment(x = 0, y = 0, xend = 0, yend = 75.4, linetype="solid", color = "darkred", size=0.5)
multivariate_plots

cairo_pdf("../Figures/Odds Ratios/Responses/Adjusted_Plot_Generate_Income.pdf", 
      width  = 3.35, 
      height = 4.75,
      fallback_resolution = 300,
      family = "serif"
      )
multivariate_plots
dev.off()

agg_tiff("../Figures/Odds Ratios/Responses/Adjusted_Plot_Generate_Income.tiff", units="mm", width=85, height=120, res=300)
multivariate_plots
dev.off()

```


```{r}
# all covariates
FinalModel <- glm(formula = `Family/Friend Help (Covid Household Response)` ~  `Age (Household Head)` +
                                                                        `Sex (Household Head)` +
                                                                        `Ethnicity (Household Head)` +
                                                                        `Education (Household Head)` +
                                                                        `Occupation (Household Head)` + 
                                                                        #`Residence (Household)`+ 
                                                                        `Urbanicity (Household)` +
                                                                        `Household Size` +
                                                                         #`Dependents (Household)` +
                                                                        `Adults Over Age 60 (Household)` +
                                                                        `Children Under Age 5 (Household)` +
                                                                        `Income (Household)`+
                                                                        `Wealth Index (Household)`+
                                                                        `Job Loss (Household)`+
                                                                        `Nonfarm Business Closure (Household)` +
                                                                        `Farm Disruption (Household)` +
                                                                        `Livestock Disruption (Household)`+
                                                                        `Fishing Disruption (Household)`+
                                                                        `Input Inflation (Household)`+
                                                                        `Output Deflation (Household)`+
                                                                        `Food Price Increase (Household)`+
                                                                        `Illness/Death (Household)`, family = binomial, data = data)
 
# Print the regression model
summary(FinalModel)
```

```{r}
# Produce forest plots
model_list <- list(FinalModel)
multivariate_plots <- forest_model(model_list = model_list, exponentiate = TRUE, format_options = forest_model_format_options(colour = "black", color = NULL, shape = 18, text_size = 12, point_size = 1.25, banded = TRUE), panels = panels, merge_models = TRUE, factor_separate_line = TRUE, recalculate_width = FALSE, recalculate_height = TRUE) 
multivariate_plots <- multivariate_plots + theme(text = element_text(size = 6))
multivariate_plots <- multivariate_plots + geom_segment(x = 0, y = 0, xend = 0, yend = 75.4, linetype="solid", color = "darkred", size=0.5)
multivariate_plots

cairo_pdf("../Figures/Odds Ratios/Responses/Adjusted_Plot_FF_Help.pdf", 
      width  = 3.35, 
      height = 4.75,
      fallback_resolution = 300,
      family = "serif"
      )
multivariate_plots
dev.off()

agg_tiff("../Figures/Odds Ratios/Responses/Adjusted_Plot_FF_Help.tiff", units="mm", width=85, height=120, res=300)
multivariate_plots
dev.off()

```

```{r}
# all covariates
FinalModel <- glm(formula = `Borrow from Family/Friends (Covid Household Response)` ~  `Age (Household Head)` +
                                                                        `Sex (Household Head)` +
                                                                        `Ethnicity (Household Head)` +
                                                                        `Education (Household Head)` +
                                                                        `Occupation (Household Head)` + 
                                                                        #`Residence (Household)`+ 
                                                                        `Urbanicity (Household)` +
                                                                        `Household Size` +
                                                                         #`Dependents (Household)` +
                                                                        `Adults Over Age 60 (Household)` +
                                                                        `Children Under Age 5 (Household)` +
                                                                        `Income (Household)`+
                                                                        `Wealth Index (Household)`+
                                                                        `Job Loss (Household)`+
                                                                        `Nonfarm Business Closure (Household)` +
                                                                        `Farm Disruption (Household)` +
                                                                        `Livestock Disruption (Household)`+
                                                                        `Fishing Disruption (Household)`+
                                                                        `Input Inflation (Household)`+
                                                                        `Output Deflation (Household)`+
                                                                        `Food Price Increase (Household)`+
                                                                        `Illness/Death (Household)`, family = binomial, data = data)
 
# Print the regression model
summary(FinalModel)
```

```{r}
# Produce forest plots
model_list <- list(FinalModel)
multivariate_plots <- forest_model(model_list = model_list, exponentiate = TRUE, format_options = forest_model_format_options(colour = "black", color = NULL, shape = 18, text_size = 12, point_size = 1.25, banded = TRUE), panels = panels, merge_models = TRUE, factor_separate_line = TRUE, recalculate_width = FALSE, recalculate_height = TRUE) 
multivariate_plots <- multivariate_plots + theme(text = element_text(size = 6))
multivariate_plots <- multivariate_plots + geom_segment(x = 0, y = 0, xend = 0, yend = 75.4, linetype="solid", color = "darkred", size=0.5)
multivariate_plots

cairo_pdf("../Figures/Odds Ratios/Responses/Adjusted_Plot_FF_Borrow.pdf", 
      width  = 3.35, 
      height = 4.75,
      fallback_resolution = 300,
      family = "serif"
      )
multivariate_plots
dev.off()

agg_tiff("../Figures/Odds Ratios/Responses/Adjusted_Plot_FF_Borrow.tiff", units="mm", width=85, height=120, res=300)
multivariate_plots
dev.off()

```

```{r}
# all covariates
FinalModel <- glm(formula = `Reduced Food Consumption (Covid Household Response)` ~    `Age (Household Head)` +
                                                                        `Sex (Household Head)` +
                                                                        `Ethnicity (Household Head)` +
                                                                        `Education (Household Head)` +
                                                                        `Occupation (Household Head)` + 
                                                                        #`Residence (Household)`+ 
                                                                        `Urbanicity (Household)` +
                                                                        `Household Size` +
                                                                         #`Dependents (Household)` +
                                                                        `Adults Over Age 60 (Household)` +
                                                                        `Children Under Age 5 (Household)` +
                                                                        `Income (Household)`+
                                                                        `Wealth Index (Household)`+
                                                                        `Job Loss (Household)`+
                                                                        `Nonfarm Business Closure (Household)` +
                                                                        `Farm Disruption (Household)` +
                                                                        `Livestock Disruption (Household)`+
                                                                        `Fishing Disruption (Household)`+
                                                                        `Input Inflation (Household)`+
                                                                        `Output Deflation (Household)`+
                                                                        `Food Price Increase (Household)`+
                                                                        `Illness/Death (Household)`, family = binomial, data = data)
 
# Print the regression model
summary(FinalModel)
```

```{r}
# Produce forest plots
model_list <- list(FinalModel)
multivariate_plots <- forest_model(model_list = model_list, exponentiate = TRUE, format_options = forest_model_format_options(colour = "black", color = NULL, shape = 18, text_size = 12, point_size = 1.25, banded = TRUE), panels = panels, merge_models = TRUE, factor_separate_line = TRUE, recalculate_width = FALSE, recalculate_height = TRUE) 
multivariate_plots <- multivariate_plots + theme(text = element_text(size = 6))
multivariate_plots <- multivariate_plots + geom_segment(x = 0, y = 0, xend = 0, yend = 75.4, linetype="solid", color = "darkred", size=0.5)
multivariate_plots

cairo_pdf("../Figures/Odds Ratios/Responses/Adjusted_Plot_Reduced_Food_Consumption.pdf", 
      width  = 3.35, 
      height = 4.75,
      fallback_resolution = 300,
      family = "serif"
      )
multivariate_plots
dev.off()

agg_tiff("../Figures/Odds Ratios/Responses/Adjusted_Plot_Reduced_Food_Consumption.tiff", units="mm", width=85, height=120, res=300)
multivariate_plots
dev.off()

```

```{r}
# all covariates
FinalModel <- glm(formula = `Reduced Consumption (Covid Household Response)` ~    `Age (Household Head)` +
                                                                        `Sex (Household Head)` +
                                                                        `Ethnicity (Household Head)` +
                                                                        `Education (Household Head)` +
                                                                        `Occupation (Household Head)` + 
                                                                        #`Residence (Household)`+ 
                                                                        `Urbanicity (Household)` +
                                                                        `Household Size` +
                                                                         #`Dependents (Household)` +
                                                                        `Adults Over Age 60 (Household)` +
                                                                        `Children Under Age 5 (Household)` +
                                                                        `Income (Household)`+
                                                                        `Wealth Index (Household)`+
                                                                        `Job Loss (Household)`+
                                                                        `Nonfarm Business Closure (Household)` +
                                                                        `Farm Disruption (Household)` +
                                                                        `Livestock Disruption (Household)`+
                                                                        `Fishing Disruption (Household)`+
                                                                        `Input Inflation (Household)`+
                                                                        `Output Deflation (Household)`+
                                                                        `Food Price Increase (Household)`+
                                                                        `Illness/Death (Household)`, family = binomial, data = data)
 
# Print the regression model
summary(FinalModel)
```

```{r}
# Produce forest plots
model_list <- list(FinalModel)
multivariate_plots <- forest_model(model_list = model_list, exponentiate = TRUE, format_options = forest_model_format_options(colour = "black", color = NULL, shape = 18, text_size = 12, point_size = 1.25, banded = TRUE), panels = panels, merge_models = TRUE, factor_separate_line = TRUE, recalculate_width = FALSE, recalculate_height = TRUE) 
multivariate_plots <- multivariate_plots + theme(text = element_text(size = 6))
multivariate_plots <- multivariate_plots + geom_segment(x = 0, y = 0, xend = 0, yend = 75.4, linetype="solid", color = "darkred", size=0.5)
multivariate_plots

cairo_pdf("../Figures/Odds Ratios/Responses/Adjusted_Plot_Reduced_Consumption.pdf", 
      width  = 3.35, 
      height = 4.75,
      fallback_resolution = 300,
      family = "serif"
      )
multivariate_plots
dev.off()

agg_tiff("../Figures/Odds Ratios/Responses/Adjusted_Plot_Reduced_Consumption.tiff", units="mm", width=85, height=120, res=300)
multivariate_plots
dev.off()

```

```{r}
# all covariates
FinalModel <- glm(formula = `Relied on Savings (Covid Household Response)` ~    `Age (Household Head)` +
                                                                        `Sex (Household Head)` +
                                                                        `Ethnicity (Household Head)` +
                                                                        `Education (Household Head)` +
                                                                        `Occupation (Household Head)` + 
                                                                        #`Residence (Household)`+ 
                                                                        `Urbanicity (Household)` +
                                                                        `Household Size` +
                                                                         #`Dependents (Household)` +
                                                                        `Adults Over Age 60 (Household)` +
                                                                        `Children Under Age 5 (Household)` +
                                                                        `Income (Household)`+
                                                                        `Wealth Index (Household)`+
                                                                        `Job Loss (Household)`+
                                                                        `Nonfarm Business Closure (Household)` +
                                                                        `Farm Disruption (Household)` +
                                                                        `Livestock Disruption (Household)`+
                                                                        `Fishing Disruption (Household)`+
                                                                        `Input Inflation (Household)`+
                                                                        `Output Deflation (Household)`+
                                                                        `Food Price Increase (Household)`+
                                                                        `Illness/Death (Household)`, family = binomial, data = data)
 
# Print the regression model
summary(FinalModel)
```

```{r}
# Produce forest plots
model_list <- list(FinalModel)
multivariate_plots <- forest_model(model_list = model_list, exponentiate = TRUE, format_options = forest_model_format_options(colour = "black", color = NULL, shape = 18, text_size = 12, point_size = 1.25, banded = TRUE), panels = panels, merge_models = TRUE, factor_separate_line = TRUE, recalculate_width = FALSE, recalculate_height = TRUE) 
multivariate_plots <- multivariate_plots + theme(text = element_text(size = 6))
multivariate_plots <- multivariate_plots + geom_segment(x = 0, y = 0, xend = 0, yend = 75.4, linetype="solid", color = "darkred", size=0.5)
multivariate_plots

pdf("../Figures/Odds Ratios/Responses/Adjusted_Plot_Relied_Savings.pdf", width = 3.5, height = 4.75)
multivariate_plots
dev.off()
```

```{r}
# all covariates
FinalModel <- glm(formula = `GOV Help (Covid Household Response)` ~    `Age (Household Head)` +
                                                                        `Sex (Household Head)` +
                                                                        `Ethnicity (Household Head)` +
                                                                        `Education (Household Head)` +
                                                                        `Occupation (Household Head)` + 
                                                                        #`Residence (Household)`+ 
                                                                        `Urbanicity (Household)` +
                                                                        `Household Size` +
                                                                         #`Dependents (Household)` +
                                                                        `Adults Over Age 60 (Household)` +
                                                                        `Children Under Age 5 (Household)` +
                                                                        `Income (Household)`+
                                                                        `Wealth Index (Household)`+
                                                                        `Job Loss (Household)`+
                                                                        `Nonfarm Business Closure (Household)` +
                                                                        `Farm Disruption (Household)` +
                                                                        `Livestock Disruption (Household)`+
                                                                        `Fishing Disruption (Household)`+
                                                                        `Input Inflation (Household)`+
                                                                        `Output Deflation (Household)`+
                                                                        `Food Price Increase (Household)`+
                                                                        `Illness/Death (Household)`, family = binomial, data = data)
 
# Print the regression model
summary(FinalModel)
```

```{r}
# Produce forest plots
model_list <- list(FinalModel)
multivariate_plots <- forest_model(model_list = model_list, exponentiate = TRUE, format_options = forest_model_format_options(colour = "black", color = NULL, shape = 18, text_size = 12, point_size = 1.25, banded = TRUE), panels = panels, merge_models = TRUE, factor_separate_line = TRUE, recalculate_width = FALSE, recalculate_height = TRUE) 
multivariate_plots <- multivariate_plots + theme(text = element_text(size = 6))
multivariate_plots <- multivariate_plots + geom_segment(x = 0, y = 0, xend = 0, yend = 75.4, linetype="solid", color = "darkred", size=0.5)
multivariate_plots

pdf("../Figures/Odds Ratios/Responses/Adjusted_Plot_GOV_Help.pdf", width = 3.5, height = 4.75)
multivariate_plots
dev.off()
```

```{r}

#data <- as.data.frame(data)

data <- data %>% #specify dply::select because MASS also has a select that will give you an error
  dplyr::relocate(c("Covid_HH_Response_Sell_Assets",
                    "Covid_HH_Response_Generate_Income",
                    "Covid_HH_Response_FF_Help",
                    "Covid_HH_Response_Borrow_Family",
                    "Covid_HH_Response_Took_Loan",
                    "Covid_HH_Response_Delay_Payment",
                    "Covid_HH_Response_Sold_Harvest",
                    "Covid_HH_Response_Reduce_Food_Consumption",
                    "Covid_HH_Response_Reduce_Consumption",
                    "Covid_HH_Response_Relied_Savings",
                    "Covid_HH_Response_NGO_Help",
                    "Covid_HH_Response_GOV_Help",
                    "Covid_HH_Response_Pay_Advance",
                    "Covid_HH_Response_Other"), .after=last_col())

dim(data)    

data$"id" <- seq.int(nrow(data))

descr(data$id)

dat.1 <- data %>% 
  dplyr::select(c(
    "id",
    "Covid_HH_Response_Sell_Assets",
    "Covid_HH_Response_Generate_Income",
    "Covid_HH_Response_FF_Help",
    "Covid_HH_Response_Borrow_Family",
    "Covid_HH_Response_Took_Loan",
    "Covid_HH_Response_Delay_Payment",
    "Covid_HH_Response_Sold_Harvest",
    "Covid_HH_Response_Reduce_Food_Consumption",
    "Covid_HH_Response_Reduce_Consumption",
    "Covid_HH_Response_Relied_Savings",
    "Covid_HH_Response_NGO_Help",
    "Covid_HH_Response_GOV_Help",
    "Covid_HH_Response_Pay_Advance",
    "Covid_HH_Response_Other")) %>%
  rename(id="id") 

dat.1$COUNT <- rowSums(dat.1[c(2:ncol(dat.1))])
```

```{r}
# waffle  plot
cairo_pdf("../Figures/Household Responses/Response_Index_Plot_1.pdf", 
      width  = 6.5, 
      height = 4.75,
      fallback_resolution = 300,
      family = "serif"
      )
dat.1 %>%
  dplyr::select(id,COUNT) %>%
  melt(id='id') %>%
  count(value) %>%
  rename(`Number of hardships reported`=value) %>%
  
  ggplot(aes(fill = `Number of hardships reported`, values = n)) +
  geom_waffle(color = "white", size = .25, n_rows = 20, flip = F) +
  scale_y_discrete() +
  scale_x_continuous(labels = function(x) x * 20, # make this multiplyer the same as n_rows
                     expand = c(0,0)) +
  scale_fill_manual(values=(viridis(n=11)))+
  coord_equal() +
  labs(
    title = "Number of Responses Reported",
    # x = "Age group",
  ) +
  theme_minimal() +
  theme(
    axis.title=element_blank(),
    panel.grid = element_blank(),
    legend.title=element_blank(),
    legend.position = "right",
    legend.text = element_text(size=8.8, family="Times"),
    legend.key.size = unit(.55, "cm"),
    plot.title = element_text(face="bold", size=11, family="Times"),
    axis.ticks.y = element_line()) +
  guides(fill = guide_legend(reverse = TRUE))
dev.off()
```

```{r}
# forest plot
cairo_pdf("../Figures/Household Responses/Response_Index_Plot_2.pdf", 
      width  = 6.5, 
      height = 4.75,
      fallback_resolution = 300,
      family = "serif"
      )
data %>% 
  dplyr::select(c(
    "id",
    "Covid_HH_Response_Sell_Assets",
    "Covid_HH_Response_Generate_Income",
    "Covid_HH_Response_FF_Help",
    "Covid_HH_Response_Borrow_Family",
    "Covid_HH_Response_Took_Loan",
    "Covid_HH_Response_Delay_Payment",
    "Covid_HH_Response_Sold_Harvest",
    "Covid_HH_Response_Reduce_Food_Consumption",
    "Covid_HH_Response_Reduce_Consumption",
    "Covid_HH_Response_Relied_Savings",
    "Covid_HH_Response_NGO_Help",
    "Covid_HH_Response_GOV_Help",
    "Covid_HH_Response_Pay_Advance",
    "Covid_HH_Response_Other")) %>%
  rename(id="id") %>%
  melt(id='id') %>%
  group_by(variable) %>%
  count(value) %>%
  filter(value==1) %>%
  rowwise() %>%
  
  mutate(
    PROP = round(n/nrow(data)*100, 1),
    L.CI = round(prop.test(n, nrow(data), conf.level=0.95)$conf.int[1]*100, 1),
    U.CI = round(prop.test(n, nrow(data), conf.level=0.95)$conf.int[2]*100, 1),
  ) %>%
  mutate(LABEL=paste(
    format(round(PROP, digits=1), nsmall = 1), " (",
    format(round(L.CI, digits=1), nsmall = 1), ", ",
    format(round(U.CI, digits=1), nsmall = 1), ")", sep =""),
    variable = gsub("_"," ",variable)) %>%
  #mutate(variable = ifelse(variable=='Illness Death','Illness or Death',variable)) %>%

  ggplot(aes(y=reorder(variable,PROP), x=PROP))+
  theme_ipsum_rc() +
  labs(y="Household Responses to COVID-19 Related Hardships\n")+
  geom_pointrange(
    size=.33,
    aes(xmin=L.CI, xmax=U.CI)) +
  geom_text(
    family="Times",
    aes(y=variable,label=LABEL,x = 41),
    hjust = 1,size = 3.1,show.legend = FALSE,parse = F) +
  
  theme(
    legend.position = "none",
    legend.title = element_blank(),
    title= element_blank(),
    axis.text = element_text(size=9, family="Times"),
    axis.title.y = element_text(face="bold", size=10.5, family="Times", hjust = 0.5),
    axis.title.x = element_blank(),
    plot.margin = unit(c(0.5,6.5,0.5,0.5), "lines")
  ) +
  scale_x_continuous(labels = function(x) paste0(x, "%"),expand = c(0, 0)) +
  scale_y_discrete('', labels = c( "Requested a Pay Advance",
                               "Sold Harvest",
                               "Other",
                               "Delayed Payments",
                               "NGO Help",
                               "Reduced Non-food Consumption",
                               "Government Help",
                               "Took Out a Loan",
                               "Relied on Savings",
                               "Borrowed from Family or Friends",
                               "Help from Family or Friends",
                               "Generate Additional Income",
                               "Sold Assets",
                               "Reduced Food Consumption"
                                    )) +
  coord_cartesian(clip = "off", xlim=c(0,30))+
  annotate("rect", xmin = 0, xmax = 50, ymin = 1, ymax = 13,  alpha = 0)

dev.off()  

```

